!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("adSmartLibModule",[],t):"object"==typeof exports?exports.adSmartLibModule=t():e.adSmartLibModule=t()}("undefined"!=typeof self?self:global,(function(){return(("undefined"!=typeof self?self:global).webpackChunkSmartLibModule=("undefined"!=typeof self?self:global).webpackChunkSmartLibModule||[]).push([[321],{2604:function(e,t){!function(e){"use strict";var t,i,n,s={CREATE_SESSION:"createSession",RESOLVE:"resolve",REJECT:"reject"},r={DURATION_CHANGE:"Media:durationchange",ENDED:"Media:ended",ERROR:"Media:error",PAUSE:"Media:pause",PLAY:"Media:play",PLAYING:"Media:playing",SEEKED:"Media:seeked",SEEKING:"Media:seeking",STALLED:"Media:stalled",TIME_UPDATE:"Media:timeupdate",VOLUME_CHANGE:"Media:volumechange"},a={AD_SKIPPED:"Player:adSkipped",AD_STOPPED:"Player:adStopped",FATAL_ERROR:"Player:fatalError",INIT:"Player:init",KEY_DOWN:"Player:keyDown",LOG:"Player:log",RESIZE:"Player:resize",START_CREATIVE:"Player:startCreative"},o={DURATION_CHANGE:"durationchange",ENDED:"ended",ERROR:"error",PAUSE:"pause",PLAY:"play",PLAYING:"playing",SEEKED:"seeked",SEEKING:"seeking",STALLED:"stalled",TIME_UPDATE:"timeupdate",VOLUME_CHANGE:"volumechange"},d={CLICK_THRU:"Creative:clickThru",EXPAND_NONLINEAR:"Creative:expandNonlinear",COLLAPSE_NONLINEAR:"Creative:collapseNonlinear",FATAL_ERROR:"Creative:fatalError",GET_MEDIA_STATE:"Creative:getMediaState",LOG:"Creative:log",READY:"Creative:Ready",REPORT_TRACKING:"Creative:reportTracking",REQUEST_FULL_SCREEN:"Creative:requestFullScreen",REQUEST_SKIP:"Creative:requestSkip",REQUEST_STOP:"Creative:requestStop",REQUEST_PAUSE:"Creative:requestPause",REQUEST_PLAY:"Creative:requestPlay",REQUEST_RESIZE:"Creative:requestResize",REQUEST_VOLUME:"Creative:requestVolume",REQUEST_TRACKING:"Creative:reportTracking",REQUEST_CHANGE_AD_DURATION:"Creative:requestChangeAdDuration",REQUEST_VIDEO_LOCATION:"Creative:requestVideoLocation"},u=[d.CLICK_THRU,d.GET_MEDIA_STATE,d.READY,d.REPORT_TRACKING,d.REQUEST_CHANGE_AD_DURATION,d.REQUEST_FULL_SCREEN,d.REQUEST_PAUSE,d.REQUEST_PLAY,d.REQUEST_RESIZE,d.REQUEST_SKIP,d.REQUEST_STOP,d.REQUEST_VIDEO_LOCATION,d.REQUEST_VOLUME,a.AD_SKIPPED,a.AD_STOPPED,a.FATAL_ERROR,a.INIT,a.START_CREATIVE,s.CREATE_SESSION],h={UNSPECIFIED:1100,CANNOT_LOAD_RESOURCE:1101,PLAYBACK_AREA_UNUSABLE:1102,INCORRECT_VERSION:1103,TECHNICAL_ERROR:1104,EXPAND_NOT_POSSIBLE:1105,PAUSE_NOT_HONORED:1106,PLAYMODE_NOT_ADEQUATE:1107,CREATIVE_INTERNAL_ERROR:1108,DEVICE_NOT_SUPPORTED:1109,MESSAGES_NOT_FOLLOWING_SPEC:1110,PLAYER_RESPONSE_TIMEOUT:1111},l={UNSPECIFIED:1200,WRONG_VERSION:1201,UNSUPPORTED_TIME:1202,UNSUPPORTED_FUNCTIONALITY_REQUEST:1203,UNSUPPORTED_ACTIONS:1204,POSTMESSAGE_CHANNEL_OVERLOADED:1205,VIDEO_COULD_NOT_LOAD:1206,VIDEO_TIME_OUT:1207,RESPONSE_TIMEOUT:1208,MEDIA_NOT_SUPPORTED:1209,SPEC_NOT_FOLLOWED_ON_INIT:1210,SPEC_NOT_FOLLOWED_ON_MESSAGES:1211},c={UNSPECIFIED:0,USER_INITIATED:1,MEDIA_PLAYBACK_COMPLETE:2,PLAYER_INITATED:3,CREATIVE_INITIATED:4,NON_LINEAR_DURATION_COMPLETE:5};(function(e){e.PLAYER_HANDLES="playerHandles",e.AD_HANDLES="adHandles",e.NOT_SKIPPABLE="notSkippable"})(t||(t={})),function(e){e.AD_HANDLES="adHandles",e.PLAYER_HANDLES="playerHandles",e.NOT_SUPPORTED="notSupported"}(i||(i={})),function(e){e.AD_HANDLES="adHandles",e.PLAYER_HANDLES="playerHandles"}(n||(n={}));var f="SIMID:",p=function(){function e(e){this._type=e,this._listeners=new Map,this._sessionId="",this._nextMessageId=1,this._target=window.parent,this._responseListeners=new Map,window.addEventListener("message",this.receiveMessage.bind(this),!1)}return e.prototype.sendMessage=function(e,t){var i=this;console.log("[SIMID][".concat(this._type,"] S"),e,t||{});var n=this._nextMessageId++,r=e===s.CREATE_SESSION?e:f+e,a={sessionId:this._sessionId,messageId:n,type:r,timestamp:Date.now(),args:t};return u.includes(e)?new Promise((function(e,t){i._addResponseListener(n,e,t),i._target.postMessage(JSON.stringify(a),"*")})):new Promise((function(e,t){i._target.postMessage(JSON.stringify(a),"*"),e()}))},e.prototype.addMessageListener=function(e,t){this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)},e.prototype.reset=function(){this._listeners.clear(),this._sessionId="",this._nextMessageId=1,this._responseListeners.clear()},e.prototype.setMessageTarget=function(e){this._target=e},e.prototype.receiveMessage=function(e){if(e&&e.data){var t;try{t=JSON.parse(e.data)}catch(e){return}if(t){var i=t.sessionId,n=t.type,r=""===this._sessionId&&n===s.CREATE_SESSION,a=this._sessionId===i;if((r||a)&&null!=n)if(Object.values(s).includes(n))this._handleProtocolMessage(t);else if(n.startsWith(f)){t.type=n.substring(6),console.log("[SIMID][".concat(this._type,"] R"),t.type,t.args||{});var o=this._listeners.get(t.type);o&&o.forEach((function(e){return e(t)}))}}}},e.prototype.resolveMessage=function(e,t){var i=this._nextMessageId++,n={messageId:e.messageId,value:t},r={sessionId:this._sessionId,messageId:i,type:s.RESOLVE,timestamp:Date.now(),args:n};this._target.postMessage(JSON.stringify(r),"*")},e.prototype.rejectMessage=function(e,t){var i=this._nextMessageId++,n={messageId:e.messageId,value:t},r={sessionId:this._sessionId,messageId:i,type:s.REJECT,timestamp:Date.now(),args:n};this._target.postMessage(JSON.stringify(r),"*")},e.prototype._addResponseListener=function(e,t,i){var n=function(e){e.type===s.RESOLVE?t(e.args):e.type===s.REJECT&&i(e.args)};this._responseListeners.set(e,n.bind(this))},e.prototype._handleProtocolMessage=function(e){switch(e.type){case s.CREATE_SESSION:this._sessionId=e.sessionId,this.resolveMessage(e);var t=this._listeners.get(e.type);t&&t.forEach((function(t){return t(e)}));break;case s.RESOLVE:case s.REJECT:var i=e.args.messageId,n=this._responseListeners.get(i);n&&(n(e),this._responseListeners.delete(i))}},e}(),v=function(e,t){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},v(e,t)};function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function E(e,t,i,n){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,r){function a(e){try{d(n.next(e))}catch(e){r(e)}}function o(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){e.done?i(e.value):s(e.value).then(a,o)}d((n=n.apply(e,t||[])).next())}))}function m(e,t){var i,n,s,r,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(e){return function(t){return d([e,t])}}function d(o){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,o[0]&&(a=0)),a;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}"function"==typeof SuppressedError&&SuppressedError;var g=function(e){function t(){var t=e.call(this,"Creative")||this;return t.simidVersion="",t._addMessageListeners(),t}return y(t,e),t.prototype.createSession=function(e){this._sessionId=e||this._generateSessionId(),this.sendMessage(s.CREATE_SESSION).then((function(){console.log("Session created.")}),(function(){console.log("Session creation was rejected.")}))},t.prototype._addMessageListeners=function(){var e=this;Object.values(a).forEach((function(t){e.addMessageListener(t,(function(t){return e.onPlayerMessage(t)}))})),Object.values(r).forEach((function(t){e.addMessageListener(t,(function(t){return e.onMediaMessage(t)}))}))},t.prototype.onPlayerMessage=function(e){var t=void 0;switch(e.type){case a.AD_STOPPED:case a.AD_SKIPPED:case a.FATAL_ERROR:break;case a.INIT:t=this._onPlayerInit(e);break;case a.KEY_DOWN:this.onPlayerKeyDown(e);break;case a.LOG:break;case a.RESIZE:t=this._onPlayerResize(e);case a.START_CREATIVE:}u.includes(e.type)&&(t?this.rejectMessage(e,t):this.resolveMessage(e))},t.prototype.onMediaMessage=function(e){switch(e.type){case r.DURATION_CHANGE:break;case r.ENDED:this.videoState.ended=!0;break;case r.ERROR:break;case r.PAUSE:this.videoState.paused=!0;break;case r.PLAY:case r.PLAYING:this.videoState.paused=!1;break;case r.SEEKED:case r.SEEKING:case r.STALLED:break;case r.TIME_UPDATE:this.videoState.currentTime=e.args.currentTime;break;case r.VOLUME_CHANGE:var t=e.args;this.videoState.volume=t.volume,this.videoState.muted=t.muted}},t.prototype.onPlayerInit=function(e){},t.prototype.onPlayerKeyDown=function(e){},t.prototype.onPlayerResize=function(e){},t.prototype.sendRequestResize=function(e,t){return E(this,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.sendMessage(d.REQUEST_RESIZE,{mediaDimensions:e,creativeDimensions:t})];case 1:return i.sent(),this.environmentData.videoDimensions=e,this.environmentData.creativeDimensions=t,[3,3];case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},t.prototype._onPlayerInit=function(e){var t=e.args;return this.environmentData=t.environmentData,this.creativeData=t.creativeData,this.onPlayerInit(e)},t.prototype._onPlayerResize=function(e){var t=e.args;return this.environmentData.creativeDimensions=t.creativeDimensions,this.environmentData.videoDimensions=t.videoDimensions,this.environmentData.fullscreen=t.fullscreen,this.onPlayerResize(e)},t.prototype._generateSessionId=function(){var e=new Uint8Array(16);window.crypto.getRandomValues(e);var t=Array.from(Array(32).keys()).map((function(t){var i=t%2==0,n=e[Math.floor(t/2)];return i?n>>4:15&n}));t[12]=4,t[16]=8|3&t[16];var i=t.map((function(e){return e.toString(16)}));return[i.slice(0,8).join(""),i.slice(8,12).join(""),i.slice(12,16).join(""),i.slice(16,20).join(""),i.slice(20).join("")].join("-")},t}(p),k=0,A=-2,S=function(e){function i(t,i,n,s,r,a){void 0===s&&(s=function(){}),void 0===r&&(r=""),void 0===a&&(a=k);var o=e.call(this,"Player")||this;return o._addCreativeMessageListeners(),o._mainVideoElement=t,o._mainVideoDimensions=t.getBoundingClientRect(),o._creativeUri=i,o._adParams=r,o._isLinearAd=n,o._adComplete=s,o._playerContainerElement=o._mainVideoElement.parentElement,o._adVideoElement=void 0,o._simidIframe=void 0,o._nonLinearStartTime=void 0,o._requestedDuration=a,o._nonLinearDimensions=void 0,o._durationInterval=NaN,o._addMainVideoEventListeners(),o._hideAdPlayer(),document.addEventListener("keydown",(function(e){return o._onKeyDown(e)})),o}return y(i,e),i.prototype.load=function(){this._simidIframe=this._createSimidIframe()},i.prototype.reset=function(){this._stopAd()},i.prototype._addCreativeMessageListeners=function(){var e=this;this.addMessageListener(s.CREATE_SESSION,(function(t){return e.onCreateSession(t)})),this.addMessageListener(d.COLLAPSE_NONLINEAR,(function(t){return e.onCreativeCollapseNonLinear(t)})),this.addMessageListener(d.EXPAND_NONLINEAR,(function(t){return e.onCreativeExpandNonLinear(t)})),this.addMessageListener(d.FATAL_ERROR,(function(t){return e.onCreativeFatalError(t)})),this.addMessageListener(d.GET_MEDIA_STATE,(function(t){return e.onCreativeGetMediaState(t)})),this.addMessageListener(d.REQUEST_RESIZE,(function(t){return e.onCreativeRequestResize(t)})),this.addMessageListener(d.REQUEST_SKIP,(function(t){return e.onCreativeRequestSkip(t)})),this.addMessageListener(d.REQUEST_STOP,(function(t){return e.onCreativeRequestStop(t)}))},i.prototype.onCreateSession=function(e){this.resolveMessage(e),this._sendInitMessage()},i.prototype.onCreativeCollapseNonLinear=function(e){if(this._isLinearAd)this.rejectMessage(e,{errorCode:l.UNSPECIFIED,message:"Cannot collapse linear ads"});else{var t=this._getNonlinearDimensions();this._isValidDimensions(t)||this.rejectMessage(e,{errorCode:l.UNSPECIFIED,message:"Unable to collapse to dimensions bigger than the player. Please modify dimensions to a smaller size"}),this._setSimidIframeDimensions(t),this._simidIframe.style.position="absolute",this._mainVideoElement.play(),this.resolveMessage(e)}},i.prototype.onCreativeExpandNonLinear=function(e){if(this._isLinearAd)this.rejectMessage(e);else{var t=this._getFullDimensions(this._mainVideoElement);this._setSimidIframeDimensions(t),this._mainVideoElement.pause();var i={creativeDimensions:t};this.resolveMessage(e,i)}},i.prototype.onCreativeFatalError=function(e){this.resolveMessage(e),this._stopAd(c.CREATIVE_INITIATED)},i.prototype.onCreativeGetMediaState=function(e){var t={currentSrc:this._adVideoElement?this._adVideoElement.currentSrc:"",currentTime:this._adVideoElement?this._adVideoElement.currentTime:0,duration:this._adVideoElement?this._adVideoElement.duration:0,ended:!this._adVideoElement||this._adVideoElement.ended,muted:!!this._adVideoElement&&this._adVideoElement.muted,paused:!this._adVideoElement||this._adVideoElement.paused,volume:this._adVideoElement?this._adVideoElement.volume:0,fullscreen:!!this._adVideoElement&&this._adVideoElement.fullscreen};this.resolveMessage(e,t)},i.prototype.onCreativeRequestSkip=function(e){this.resolveMessage(e),this._skipAd()},i.prototype.onCreativeRequestStop=function(e){this.resolveMessage(e),this._stopAd(c.CREATIVE_INITIATED)},i.prototype.onCreativeRequestResize=function(e){var t=e.args;this._isLinearAd?this.rejectMessage(e,{errorCode:h.EXPAND_NOT_POSSIBLE,message:"Linear resize not yet supported."}):this._isValidDimensions(t.creativeDimensions)?(this._nonLinearDimensions=t.creativeDimensions,this._setSimidIframeDimensions(t.creativeDimensions),this._setElementDimensions(this._mainVideoElement,t.mediaDimensions),this.resolveMessage(e)):this.rejectMessage(e,{errorCode:h.EXPAND_NOT_POSSIBLE,message:"Unable to resize a non-linear ad with dimensions bigger than the player. Please modify dimensions to a smaller size."})},i.prototype._sendInitMessage=function(){return E(this,void 0,void 0,(function(){var e,i,n,s,r,o;return m(this,(function(d){switch(d.label){case 0:e=this._getFullDimensions(this._mainVideoElement),i=this._isLinearAd?this._getFullDimensions(this._mainVideoElement):this._getNonlinearDimensions(),n={videoDimensions:e,creativeDimensions:i,fullscreen:!1,fullscreenAllowed:!0,variableDurationAllowed:!0,skippableState:t.AD_HANDLES,version:"",siteUrl:document.location.host,appId:"",useragent:"",deviceId:"",muted:!!this._adVideoElement&&this._adVideoElement.muted,volume:this._adVideoElement?this._adVideoElement.volume:1},s={adParameters:this._adParams,clickThruUrl:""},r={environmentData:n,creativeData:s},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.sendMessage(a.INIT,r)];case 2:return d.sent(),this._startCreative(),[3,4];case 3:return o=d.sent(),console.error("[PLAYER] Init failed",o),this._stopSession(),[3,4];case 4:return[2]}}))}))},i.prototype._stopSession=function(){this._stopAdPlayer(),this._hideAdPlayer(),this._destroySimidIframe(),this._setElementDimensions(this._mainVideoElement,this._mainVideoDimensions),this._removeAdVideoEventListeners(),this._removeMainVideoEventListeners(),this._adComplete(),this._mainVideoElement.play()},i.prototype._createSimidIframe=function(){var e=this,t=document.createElement("iframe");return t.style.display="none",t.setAttribute("allowFullScreen",""),t.setAttribute("allow","geolocation"),this._isLinearAd,t.src=this._creativeUri,t.onfocus=function(){e._playerContainerElement.focus()},this._playerContainerElement.appendChild(t),this.setMessageTarget(t.contentWindow),t},i.prototype._destroySimidIframe=function(){this._simidIframe&&(this._simidIframe.remove(),this._simidIframe=null,this.reset())},i.prototype._showSimidIFrame=function(){this._simidIframe&&(this._simidIframe.style.display="block")},i.prototype._hideSimidIFrame=function(){this._simidIframe&&(this._simidIframe.style.display="none")},i.prototype._setSimidIframeDimensions=function(e){this._simidIframe&&this._setElementDimensions(this._simidIframe,e)},i.prototype._startCreative=function(){return E(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:this._isLinearAd?this._playLinearVideoAd():(this._nonLinearStartTime=this._mainVideoElement.currentTime,this._mainVideoElement.play()),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendMessage(a.START_CREATIVE)];case 2:return t.sent(),this._showSimidIFrame(),[3,4];case 3:return e=t.sent(),console.error("[PLAYER] Failed to start creative",e),[3,4];case 4:return[2]}}))}))},i.prototype._stopAd=function(e){return void 0===e&&(e=c.PLAYER_INITATED),E(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this._simidIframe?(this._hideSimidIFrame(),[4,this.sendMessage(a.AD_STOPPED,{code:e})]):[3,2];case 1:t.sent(),this._stopSession(),t.label=2;case 2:return[2]}}))}))},i.prototype._skipAd=function(){return E(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return this._hideSimidIFrame(),[4,this.sendMessage(a.AD_SKIPPED)];case 1:return e.sent(),this._stopSession(),[2]}}))}))},i.prototype._playLinearVideoAd=function(){this._adVideoElement&&(this._mainVideoElement.pause(),this._showAdPlayer(),this._loadAdPlayer())},i.prototype._loadAdPlayer=function(){this._adVideoElement&&(this._adVideoElement.src=document.getElementById("video_url").value,this._adVideoElement.play())},i.prototype._pauseAdPlayer=function(){this._adVideoElement&&this._adVideoElement.pause()},i.prototype._playAdPlayer=function(){this._adVideoElement&&this._adVideoElement.play()},i.prototype._stopAdPlayer=function(){this._adVideoElement&&(this._adVideoElement.src="")},i.prototype._showAdPlayer=function(){this._adVideoElement&&(this._adVideoElement.style.display="block")},i.prototype._hideAdPlayer=function(){this._adVideoElement&&(this._adVideoElement.style.display="none")},i.prototype._addAdVideoEventListeners=function(){var e=this;this._adVideoElement&&Object.values(o).forEach((function(t){e._adVideoElement.addEventListener(t,(function(t){return e._onAdVideoEvent(t)}),!0)}))},i.prototype._removeAdVideoEventListeners=function(){var e=this;this._adVideoElement&&Object.values(o).forEach((function(t){e._adVideoElement.removeEventListener(t,(function(t){return e._onAdVideoEvent(t)}),!0)}))},i.prototype._onAdVideoEvent=function(e){switch(console.log("[PLAYER] Ad video event:",e.type),e.type){case o.DURATION_CHANGE:this.sendMessage(r.DURATION_CHANGE,{duration:this._adVideoElement.duration});break;case o.ENDED:this._onAdVideoEnded();break;case o.ERROR:var t=e;this.sendMessage(r.ERROR,{error:t.error,message:t.message});break;case o.TIME_UPDATE:this.sendMessage(r.TIME_UPDATE,{currentTime:this._adVideoElement.currentTime});break;case o.VOLUME_CHANGE:this.sendMessage(r.VOLUME_CHANGE,{muted:this._adVideoElement.muted,volume:this._adVideoElement.volume});break;default:this.sendMessage("Media:"+e.type)}},i.prototype._onAdVideoEnded=function(){var e=this;if(this.sendMessage(r.ENDED),this._requestedDuration===k)this._stopAd(c.MEDIA_PLAYBACK_COMPLETE);else if(this._requestedDuration!=A){var t=1e3*(this._requestedDuration-this._adVideoElement.duration);setTimeout((function(){e._stopAd(c.CREATIVE_INITIATED)}),t)}},i.prototype._addMainVideoEventListeners=function(){var e=this;Object.values(o).forEach((function(t){e._mainVideoElement.addEventListener(t,(function(t){return e._onMainVideoEvent(t)}),!0)}))},i.prototype._removeMainVideoEventListeners=function(){var e=this;Object.values(o).forEach((function(t){e._mainVideoElement.removeEventListener(t,(function(t){return e._onMainVideoEvent(t)}),!0)}))},i.prototype._onMainVideoEvent=function(e){console.log("[PLAYER] Main video event:",e.type),e.type===o.TIME_UPDATE&&this._nonLinearStartTime&&this._mainVideoElement.currentTime-this._nonLinearStartTime>this._requestedDuration&&this._stopAd(c.NON_LINEAR_DURATION_COMPLETE)},i.prototype._onKeyDown=function(e){console.log("### KEY_DOWN",e),this.sendMessage(a.KEY_DOWN,{key:e.key,code:e.keyCode}),e.preventDefault()},i.prototype._getFullDimensions=function(e){var t=e.getBoundingClientRect();return{x:0,y:0,width:t.width,height:t.height}},i.prototype._isValidDimensions=function(e){var t=this._playerContainerElement.getBoundingClientRect(),i=e.y+e.height<=t.height,n=e.x+e.width<=t.width;return i&&n},i.prototype._getNonlinearDimensions=function(){return this._nonLinearDimensions?this._nonLinearDimensions:this._getFullDimensions(this._playerContainerElement)},i.prototype._displayNonlinearCreative=function(){var e=this._getNonlinearDimensions();this._isValidDimensions(e)?(this._setSimidIframeDimensions(e),this._simidIframe.style.position="absolute",this._mainVideoElement.play(),this._requestedDuration=10):console.log("Unable to play a non-linear ad with dimensions bigger than the player. Please modify dimensions to a smaller size.")},i.prototype._setElementDimensions=function(e,t){e.style.height="".concat(t.height),e.style.width="".concat(t.width),e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px")},i.prototype._sendLog=function(e){this.sendMessage(a.LOG,{message:e})},i}(p);e.CreativeErrorCode=h,e.CreativeMessage=d,e.MediaMessage=r,e.PlayerErrorCode=l,e.PlayerMessage=a,e.SimidComponent=p,e.SimidCreative=g,e.SimidPlayer=S,e.StopCode=c,Object.defineProperty(e,"__esModule",{value:!0})}(t)},4717:function(e,t,i){"use strict";i.r(t),i.d(t,{AdBreakTracker:function(){return L},AdDataTracker:function(){return T},AdEventTracker:function(){return O},AdFriendlyObstructionPurpose:function(){return x.nb},AdManager:function(){return x.Vv},AdMetrics:function(){return d},AdMetricsBuilder:function(){return u},AdMetricsManager:function(){return q},AdSession:function(){return H.J},AdTracker:function(){return R},AdTrackingManager:function(){return V},AdViewState:function(){return x.S0},InternalAdManager:function(){return Y.Z},OMSDKManager:function(){return te},OMSessionHandler:function(){return ue}});i(429),i(9373),i(9903),i(9749),i(6544),i(228),i(9288);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function r(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,i){return(t=o(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;n(this,e),a(this,"adSkippable",void 0),a(this,"adSkipped",void 0),a(this,"adProgress",void 0),a(this,"adDuration",void 0),a(this,"stallsNumber",void 0),a(this,"stallsDuration",void 0),a(this,"layerSwitchesNumber",void 0),a(this,"averageBitrate",void 0),a(this,"sessionToken",void 0),a(this,"creativeId",void 0),a(this,"adId",void 0),void 0===t?(this.adSkippable=!1,this.adSkipped=!1,this.adProgress=-1,this.adDuration=0,this.stallsNumber=0,this.stallsDuration=0,this.layerSwitchesNumber=0,this.averageBitrate=0,this.sessionToken="",this.creativeId="",this.adId=""):(this.adSkippable=t.adSkippable,this.adSkipped=t.adSkipped,this.adProgress=t.adProgress,this.adDuration=t.adDuration,this.stallsNumber=t.stallsNumber,this.stallsDuration=t.stallsDuration,this.layerSwitchesNumber=t.layerSwitchesNumber,this.averageBitrate=t.averageBitrate,this.sessionToken=t.sessionToken,this.creativeId=t.creativeId,this.adId=t.adId)}return r(e,[{key:"toString",value:function(){return"\n{ adSkippable="+this.adSkippable+"\n  adSkipped="+this.adSkipped+"\n  adProgress="+this.adProgress+"\n  adDuration="+this.adDuration+"\n  stallsNumber="+this.stallsNumber+"\n  stallsDuration="+this.stallsDuration+"\n  layerSwitchesNumber="+this.layerSwitchesNumber+"\n  averageBitrate="+this.averageBitrate+"\n  sessionToken='"+this.sessionToken+"'\n  creativeId='"+this.creativeId+"'\n  adId='"+this.adId+"' }"}}],[{key:"merge",value:function(t){if(void 0!==t&&t.length>0){var i=new e,n=t[t.length-1];i.adSkippable=n.adSkippable,i.adSkipped=n.adSkipped,i.adProgress=n.adProgress,i.sessionToken=n.sessionToken,i.creativeId=n.creativeId,i.adId=n.adId;for(var s=0,r=0,a=0;a<t.length;a++){var o=t[a];i.adDuration+=o.adDuration,i.stallsNumber+=o.stallsNumber,i.stallsDuration+=o.stallsDuration,i.layerSwitchesNumber+=o.layerSwitchesNumber,s+=o.averageBitrate*o.adDuration,r+=o.adDuration}return 0!==r&&(i.averageBitrate=Math.round(s/r)),i}}}]),e}(),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;n(this,e),a(this,"adMetrics",void 0),a(this,"timeSpentPerLayer",void 0),a(this,"quartiles",void 0),void 0===t&&void 0===i&&void 0===s?(this.timeSpentPerLayer={},this.quartiles={},this.reset()):(this.adMetrics=t,this.timeSpentPerLayer=i,this.quartiles=s)}return r(e,[{key:"import",value:function(e){if(void 0!==e){this.adMetrics=e,this.timeSpentPerLayer={},this.timeSpentPerLayer[e.averageBitrate]=e.adDuration,this.quartiles={};for(var t=0;t<=e.adProgress/25;t++)this.quartiles[25*t]=!0}return this}},{key:"setAdSkippable",value:function(e){return this.adMetrics.adSkippable=e,this}},{key:"setAdSkipped",value:function(e){return this.adMetrics.adSkipped=e,this}},{key:"addProgress",value:function(e){return this.quartiles[e]=!0,this.adMetrics.adProgress=25*Object.keys(this.quartiles).length-25,this}},{key:"setSessionToken",value:function(e){return this.adMetrics.sessionToken=e,this}},{key:"setCreativeId",value:function(e){return this.adMetrics.creativeId=e,this}},{key:"setAdId",value:function(e){return this.adMetrics.adId=e,this}},{key:"addTimeSpentPerLayer",value:function(e,t){(e=Math.round(e))>0&&(void 0!==this.timeSpentPerLayer[e]?this.timeSpentPerLayer[e]+=t:this.timeSpentPerLayer[e]=t);return this}},{key:"addLayerSwitch",value:function(){return this.adMetrics.layerSwitchesNumber++,this}},{key:"addStall",value:function(e){return this.adMetrics.stallsNumber++,this.adMetrics.stallsDuration+=e,this}},{key:"reset",value:function(){return this.adMetrics=new d,this.timeSpentPerLayer={},this.quartiles={},this}},{key:"clone",value:function(){return new e(new d(this.adMetrics),Object.assign({},this.timeSpentPerLayer),Object.assign({},this.quartiles))}},{key:"build",value:function(){var e=0,t=0;for(var i in this.timeSpentPerLayer){var n=this.timeSpentPerLayer[i];e+=i*n,t+=n}return 0!==t&&(this.adMetrics.averageBitrate=Math.round(e/t)),this.adMetrics.adDuration=t,this.adMetrics}}]),e}(),h=(i(7522),i(6466),i(2826),i(6138)),l=i(795),c=i(292),f=(i(8077),i(886),i(6801),i(3843),i(2506),i(5728),i(9772),i(5137),i(7195),i(8324),i(4796)),p=i(5750);i(9730),i(278),i(8052),i(6034),i(50),i(2349),i(1919);function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(arguments.length<3?e:i):s.value}},v.apply(this,arguments)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=k(e);if(t){var s=k(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}(this,i)}}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,b(n.key),n)}}function _(e,t,i){return t&&S(e.prototype,t),i&&S(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function P(e,t,i){return(t=b(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function b(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var D="BpkAdTracker",I=function(){function e(){A(this,e),P(this,"proceeded",void 0),this.proceeded={}}return _(e,[{key:"canProcess",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=void 0===this.proceeded[e];return t&&(this.proceeded[e]=Date.now()),t}},{key:"resetProcess",value:function(){this.proceeded={}}}]),e}(),T=function(){function e(t,i,n){A(this,e),P(this,"adTrackingManager",void 0),P(this,"sessionToken",void 0),P(this,"timeReference",void 0),P(this,"adBreaks",void 0),this.adTrackingManager=t,this.sessionToken=i,this.timeReference=n,this.adBreaks=[]}return _(e,[{key:"hasRemainingAdBreaks",value:function(e){return void 0!==this.adBreaks.find((function(t){return e<t.position+t.duration}))}},{key:"resetProgression",value:function(e){this.adBreaks.forEach((function(t){return t.resetProgression(e)}))}}]),e}(),L=function(e){y(i,e);var t=m(i);function i(e,n,s,r,a){var o;return A(this,i),P(g(o=t.call(this)),"adData",void 0),P(g(o),"id",void 0),P(g(o),"position",void 0),P(g(o),"duration",void 0),P(g(o),"live",void 0),P(g(o),"ads",void 0),o.adData=e,o.id=n,o.position=s,o.duration=r,o.live=a,o.ads=[],o}return _(i,[{key:"resetProgression",value:function(e){e<=this.position&&this.resetProcess(),this.ads.forEach((function(t){return t.resetProgression(e)}))}},{key:"processBegin",value:function(){var e;if(this.canProcess(0)){var t=this.adData.adTrackingManager;h.o.d(D,"Processing ad break begin...",t.handler.id),h.o.d(D,"Duration: "+this.duration+"ms",t.handler.id),t.notifyAdBreakData(this),t.notifyAdBreakBegin(this.adData.sessionToken);var i=null===(e=t.handler.adSession)||void 0===e?void 0:e.adEventsListener;null==i||i.onAdBreakBegin(this.toData())}}},{key:"processEnd",value:function(){var e;if(this.canProcess(1)){var t=this.adData.adTrackingManager;h.o.d(D,"Processing ad break end...",t.handler.id),t.notifyAdBreakEnd(this.adData.sessionToken);var i=null===(e=t.handler.adSession)||void 0===e?void 0:e.adEventsListener;null==i||i.onAdBreakEnd(this.toData()),this.resetProcess()}}},{key:"resetProcess",value:function(){v(k(i.prototype),"resetProcess",this).call(this),this.ads.forEach((function(e){return e.resetProcess()}))}},{key:"toData",value:function(){return{id:this.id,startPosition:this.position||0,duration:!0===this.live?-1:this.duration,ads:this.ads.map((function(e){return e.toData()})),adCount:!0===this.live?-1:this.ads.length}}}]),i}(I),R=function(e){y(i,e);var t=m(i);function i(e,n,s,r,a,o,d,u,h,l,c){var f;return A(this,i),P(g(f=t.call(this)),"adBreak",void 0),P(g(f),"index",void 0),P(g(f),"position",void 0),P(g(f),"duration",void 0),P(g(f),"skippablePosition",void 0),P(g(f),"skippable",void 0),P(g(f),"creativeId",void 0),P(g(f),"adId",void 0),P(g(f),"events",void 0),P(g(f),"clickable",void 0),P(g(f),"verifications",void 0),P(g(f),"watched",void 0),P(g(f),"progression",void 0),P(g(f),"nonLinearAd",void 0),f.adBreak=e,f.index=n,f.position=s,f.duration=r,f.skippable=a,f.skippablePosition=o,f.creativeId=d,f.adId=u,f.events=[],f.clickable=h,f.verifications=l,f.watched=[],f.progression=0,f.nonLinearAd=c,f}return _(i,[{key:"flatWatched",value:function(){var e=JSON.parse(JSON.stringify(this.watched)).slice(0),t=[],i=null;e=e.sort((function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0})),t.push(e[0]);for(var n=1;n<e.length;n++)(i=t[t.length-1])[1]<e[n][0]?t.push(e[n]):i[1]<e[n][1]&&(i[1]=e[n][1],t.pop(),t.push(i));this.watched=t}},{key:"resetProgression",value:function(e){e<=this.position&&(this.watched=[],this.progression=0,this.resetProcess()),this.events.forEach((function(t){return t.resetProgression(e)}))}},{key:"updateProgression",value:function(e,t){if(!(e>t||e<this.position||t<this.position||e>this.position+this.duration||t>this.position+this.duration)){var i=this.watched.reduce((function(e,t){return e+(t[1]-t[0])}),0)/this.duration;this.watched.push([e-this.position,t-this.position]),this.flatWatched();var n=this.watched.reduce((function(e,t){return e+(t[1]-t[0])}),0)/this.duration;this.progression=n;var s=this.adBreak.adData,r=s.adTrackingManager;i<=.25&&n>=.25&&r.notifyAdProgress(s.sessionToken,this,25),i<=.5&&n>=.5&&r.notifyAdProgress(s.sessionToken,this,50),i<=.75&&n>=.75&&r.notifyAdProgress(s.sessionToken,this,75),this.events.forEach((function(e){return e.processEvents(i,n)})),h.o.d(D,"Ad progressed from "+Math.floor(1e5*i)/1e3+"% to "+Math.floor(1e5*n)/1e3+"%",r.handler.id)}}},{key:"processBegin",value:function(){var e;if(this.canProcess(0)){var t=this.adBreak.adData,i=t.adTrackingManager;h.o.d(D,"Processing ad begin "+this.adId+"...",i.handler.id),h.o.d(D,"Start: "+this.position+"ms",i.handler.id),h.o.d(D,"End  : "+(this.position+this.duration)+"ms",i.handler.id),h.o.d(D,"Duration: "+this.duration+"ms",i.handler.id),i.notifyAdData(this),i.notifyAdBegin(t.sessionToken,this),!0===this.skippable&&i.notifyAdSkippable(t.sessionToken,this.skippablePosition,this.position+this.duration,this.adBreak.position+this.adBreak.duration),i.notifyAdProgress(t.sessionToken,this,0);var n=null===(e=i.handler.adSession)||void 0===e?void 0:e.adEventsListener,s=this.toData(),r=this.adBreak.toData();null==n||n.onAdBegin(s,r),!0===this.skippable&&(null==n||n.onAdSkippable(s,r,this.skippablePosition,this.position+this.duration,this.adBreak.position+this.adBreak.duration))}}},{key:"processEnd",value:function(){var e;if(this.canProcess(1)){var t=this.adBreak.adData,i=t.adTrackingManager;h.o.d(D,"Processing ad end "+this.adId+"...",i.handler.id),this.progression>=.95&&(this.updateProgression(this.position,this.position+this.duration),i.notifyAdProgress(t.sessionToken,this,100)),i.notifyAdEnd(t.sessionToken,this);var n=null===(e=i.handler.adSession)||void 0===e?void 0:e.adEventsListener;null==n||n.onAdEnd(this.toData(),this.adBreak.toData())}}},{key:"toData",value:function(){return{index:this.index,creativeId:this.creativeId,adId:this.adId,startPosition:this.position,skipPosition:this.skippablePosition,duration:this.duration,clickURL:this.clickable.uri,nonLinearAd:this.nonLinearAd}}}]),i}(I),O=function(e){y(i,e);var t=m(i);function i(e,n,s,r,a){var o;return A(this,i),P(g(o=t.call(this)),"ad",void 0),P(g(o),"type",void 0),P(g(o),"url",void 0),P(g(o),"offset",void 0),P(g(o),"position",void 0),P(g(o),"progression",void 0),o.ad=e,o.type=n,o.url=s,o.offset=r,o.position=a,o.progression=0,o.processProgression(),o}return _(i,[{key:"resetProgression",value:function(e){e<=this.ad.position&&this.resetProcess()}},{key:"processProgression",value:function(){switch(void 0!==this.type?this.type.toLowerCase():void 0){case void 0:this.progression=(this.position-this.ad.position)/this.ad.duration;break;case"start":this.progression=0;break;case"firstquartile":this.progression=.25;break;case"midpoint":this.progression=.5;break;case"thirdquartile":this.progression=.75;break;case"complete":this.progression=1;break;case"progress":this.progression=this.offset/this.ad.duration;break;case"impression":this.progression=0}}},{key:"processEvents",value:function(e,t){var i=this.ad.adBreak.adData.adTrackingManager;if(e<=this.progression&&this.progression<=t){if(!this.canProcess())return!1;h.o.d(D,"Processing "+(this.type||"timed event")+" ("+Math.floor(100*this.progression)+"%)...",i.handler.id),void 0!==this.url&&this.url.length>0&&(h.o.d(D,"Requesting "+this.url,i.handler.id),p.Z.getInstance().adEvent(i.handler,this.url))}return!0}}]),i}(I),M=i(2604);function N(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,B(n.key),n)}}function w(e,t,i){return(t=B(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function B(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var C="BpkAdTrackingMgr",V=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,"handler",void 0),w(this,"playerAdapter",void 0),w(this,"listeners",void 0),w(this,"simidPlayer",void 0),w(this,"adData",void 0),w(this,"adList",void 0),w(this,"updatePositionJob",void 0),w(this,"updateSessionJob",void 0),w(this,"started",void 0),w(this,"paused",void 0),w(this,"buffering",void 0),w(this,"lastPosition",void 0),w(this,"lastPositionBeforePause",void 0),w(this,"lastPositionAfterSeek",void 0),w(this,"firstImageDate",void 0),w(this,"currentAdTracker",void 0),w(this,"currentAdBreakTracker",void 0),w(this,"currentAdData",void 0),w(this,"currentAdBreakData",void 0),w(this,"adPalSession",void 0),w(this,"bkYouSession",void 0),w(this,"sessionToken",void 0),w(this,"baseURL",void 0),w(this,"nonce",void 0),w(this,"adPalSessionRequest",void 0),w(this,"firstFileReceived",void 0),w(this,"firstFileProceeded",void 0),w(this,"podsSentNumber",void 0),w(this,"sessionUpdateInterval",void 0),this.handler=t,this.playerAdapter=i,this.listeners=[],this.simidPlayer=void 0,this.adData=void 0,this.adList=[],this.updatePositionJob=void 0,this.updateSessionJob=void 0,this.started=!1,this.paused=!1,this.buffering=!1,this.lastPosition=0,this.lastPositionBeforePause=0,this.lastPositionAfterSeek=0,this.bkYouSession=!1,this.baseURL=void 0,this.nonce=void 0,this.adPalSessionRequest=void 0,this.firstFileReceived=!1,this.firstFileProceeded=!1,this.podsSentNumber=0,this.sessionUpdateInterval=e.SESSION_UPDATE_INTERVAL}var t,i,n;return t=e,i=[{key:"initBkYouSession",value:function(e,t,i,n,s){this.baseURL=e,this.sessionToken=t,this.bkYouSession=!0,void 0!==n&&(this.adPalSession=n,this.nonce=s),this.parseAdPods(i),h.o.d(C,"BkYou session initialized",this.handler.id)}},{key:"updateBkYouSession",value:function(){var e=this;if(!0!==this.handler.stopped&&!0===this.bkYouSession){h.o.d(C,"Updating ad tracking file...",this.handler.id);var t=this.baseURL,i={userAgent:this.handler.smartLib.getParameters().userAgent};p.Z.getInstance().adTracking(this.handler,i,t,!0).then((function(t){if(!0!==e.handler.stopped)if(void 0!==e.updateSessionJob&&f.Z.getInstance().cancel(e.updateSessionJob),t.httpStatus>=200&&t.httpStatus<300){var i;try{i=JSON.parse(t.content)}catch(t){return h.o.d(C,"Ad tracking updated file unreadable",e.handler.id),void(!0===e.firstFileReceived&&(e.updateSessionJob=f.Z.getInstance().asyncDelay(e.sessionUpdateInterval,(function(){e.updateSessionJob=void 0,e.updateBkYouSession()}))))}e.firstFileReceived=!0,e.parseAdPods(i),e.isLive()?e.updateSessionJob=f.Z.getInstance().asyncDelay(e.sessionUpdateInterval,(function(){e.updateSessionJob=void 0,e.updateBkYouSession()})):h.o.d(C,"Stopping ad tracking file update (VOD stream)...",e.handler.id)}else h.o.d(C,"Stopping ad tracking file update (status code "+t.httpStatus+")",e.handler.id)}))}}},{key:"fixAdBreak",value:function(e){var t;e.ads.forEach((function(i,n){var s=e.ads[n+1];void 0!==s&&s.position<i.position+i.duration&&(s.position=i.position+i.duration,s.events.filter((function(e){return e.position<s.position})).forEach((function(e){e.position=s.position}))),t=i})),void 0!==t&&(e.duration=t.position+t.duration-e.position)}},{key:"parseAdPods",value:function(t){var i=this,n=t.sessiontoken||"",s=t.timereference_ms||0,r=t.refresh_delay_ms||e.SESSION_UPDATE_INTERVAL;r>=2e3&&r<=e.SESSION_UPDATE_INTERVAL?(this.sessionUpdateInterval=r,h.o.d(C,"Setting refresh delay to "+this.sessionUpdateInterval+"ms",this.handler.id)):h.o.d(C,"Setting refresh delay to "+e.SESSION_UPDATE_INTERVAL+"ms (default value)",this.handler.id);var a=new T(this,n,s),o=t.adpods;Array.isArray(o)&&(o.forEach((function(e){var t=e.id||"",n=e.starttime_ms+s,r=e.duration_ms||0,o=e.ads,d=new L(a,t,n,r,i.isLive());Array.isArray(o)&&o.forEach((function(e,t){var i=e.starttime_ms+s,n=e.duration_ms,r=e.trackingevents,a=e.nonLinearAd,o=!0;if(Array.isArray(r)&&r.length>0&&(o=i>0&&r[0].time_ms>0||0===i),void 0!==i&&void 0!==n&&!0===o){var u,h,l,c=e.skippable_ms+s||0,f=0!==c&&null!=c,p=e.creativeid||"",v=e.adid+"-"+i||"",y={uri:(null===(u=e.videoclicks)||void 0===u?void 0:u.clickthroughurl)||"",trackers:(null===(h=e.videoclicks)||void 0===h?void 0:h.clicktracking)||[],customClick:(null===(l=e.videoclicks)||void 0===l?void 0:l.customclick)||[]},E=e.adverifications||[],m=[];E.forEach((function(e){m.push({vendor:e.vendor||"",javascriptResources:e.javascriptresources||[],executableResources:e.executableresources||[],trackingEvents:e.trackingevents||[],verificationParameters:e.verificationparameters||""})}));var g=new R(d,t,i,n,f,c,p,v,y,m,a);d.ads.push(g),Array.isArray(r)&&r.forEach((function(e){var t=e.callbackurl;if(void 0!==t){var n=e.type,r=e.offset_ms,a=e.time_ms+s||i,o=new O(g,n,t,r,a);g.events.push(o)}}))}})),d.ads.length>0&&a.adBreaks.push(d)})),a.adBreaks.forEach((function(e){i.fixAdBreak(e)})));var d=this.mergeEvents(a);this.adList=this.adData.adBreaks.map((function(e){return e.toData()})),this.notifyAdDataListener(d)}},{key:"start",value:function(){var t=this;void 0===this.updatePositionJob&&(this.updatePositionJob=f.Z.getInstance().asyncDelay(e.POSITION_UPDATE_INTERVAL,(function(){t.updatePositionJob=void 0,t.onPositionUpdated(t.playerAdapter.getPosition())})))}},{key:"stop",value:function(){void 0!==this.updatePositionJob&&(h.o.d(C,"Ad tracking paused (player event)",this.handler.id),f.Z.getInstance().cancel(this.updatePositionJob),this.updatePositionJob=void 0)}},{key:"isLive",value:function(){return void 0!==this.firstImageDate&&this.playerAdapter.getDuration()<=0}},{key:"mergeEvents",value:function(e){var t=this,i=!1;if(void 0===this.adData)this.adData=e,h.o.d(C,e.adBreaks.length+" ad break(s) parsed",this.handler.id),i=!0;else{var n=0,s=0;this.adData.sessionToken=e.sessionToken,this.adData.timeReference=e.timeReference;var r=e.adBreaks.map((function(e){return e.id}));this.adData.adBreaks.forEach((function(e,n,a){var o;r.includes(e.id)||(null===(o=t.currentAdTracker)||void 0===o?void 0:o.adBreak.id)===e.id||(a.splice(n,1),s++,i=!0)})),e.adBreaks.forEach((function(e,s){e.adData=t.adData;var r=t.adData.adBreaks.find((function(t){return t.id===e.id}));if(void 0!==r){e.ads.filter((function(e){return void 0===r.ads.find((function(t){return t.adId===e.adId}))})).forEach((function(e){var t=r.ads.findIndex((function(t){return t.position>e.position}));-1===t?r.ads.push(e):r.ads.splice(t,0,e),n++,i=!0}));var a=r.duration;t.fixAdBreak(r),a!==r.duration&&h.o.d(C,"Ad break "+(s+1)+"/"+t.adData.adBreaks.length+": updated duration from "+a+" to "+r.duration,t.handler.id)}else t.adData.adBreaks.push(e),n+=e.ads.length,i=!0})),h.o.d(C,this.adData.adBreaks.length+" ad break(s) in total, "+e.adBreaks.length+" ad break(s) parsed, "+n+" new ad(s), "+s+" deleted ad(s)",this.handler.id)}if(this.notifyAdsUpdated(this.adData),this.started&&!this.paused&&!this.buffering){var a=this.playerAdapter.getPosition();void 0===this.updatePositionJob&&this.adData.hasRemainingAdBreaks(a)>0&&(h.o.d(C,"Ad tracking resumed",this.handler.id),this.lastPosition=a),this.checkStart(),this.isLive()&&this.checkAdBreakEnded(a)}return i}},{key:"onPositionUpdated",value:function(t){var i=this.lastPosition!==t?this.lastPosition:t-1,n=t;if(!0===this.firstFileReceived&&!1===this.firstFileProceeded){this.firstFileProceeded=!0;var s=4e3;if(Date.now()-this.firstImageDate<=s&&n-i>0){h.o.d(C,"Processing all events since first image...",this.handler.id);var r=this.adData.adBreaks.find((function(e){return i-s<=e.position&&e.position<i})),a=null==r?void 0:r.ads.find((function(e){return i-s<=e.position&&e.position<i}));this.currentAdData=null==a?void 0:a.toData(),this.currentAdBreakData=null==r?void 0:r.toData(),null==r||r.processBegin(),null==a||a.processBegin(),null==a||a.updateProgression(a.position,i),this.currentAdTracker=a,this.currentAdBreakTracker=r}}if(i<n&&n-i<e.POSITION_SEEK_ERROR_DELTA){var o,d,u=null===(o=this.adData)||void 0===o?void 0:o.adBreaks.find((function(e){return e.position<=n&&n<e.position+e.duration})),l=null==u?void 0:u.ads.find((function(e){return e.position<=n&&n<e.position+e.duration}));if(void 0!==l){if(void 0===this.currentAdTracker){h.o.d(C,"Entering ad "+l.adId+"...",this.handler.id);var c=i-l.position>=e.POSITION_SEEK_ERROR_DELTA;c||(h.o.d(C,"Update position start from "+i+" to "+l.position,this.handler.id),i=l.position),this.currentAdData=l.toData(),this.currentAdBreakData=u.toData(),u.processBegin(),l.processBegin(),l.updateProgression(i,n),c&&this.notifyAdSkipped(this.adData.sessionToken,l)}else this.currentAdTracker===l?l.updateProgression(i,n):this.currentAdTracker!==l&&(h.o.d(C,"Changing from ad "+this.currentAdTracker.adId+" to "+l.adId+"...",this.handler.id),l.adBreak.id===this.currentAdTracker.adBreak.id&&this.currentAdTracker.updateProgression(i,this.currentAdTracker.position+this.currentAdTracker.duration),this.currentAdTracker.processEnd(),l.adBreak.id!==this.currentAdTracker.adBreak.id?(this.currentAdTracker.adBreak.processEnd(),this.currentAdData=l.toData(),this.currentAdBreakData=u.toData(),u.processBegin()):this.currentAdData=l.toData(),l.processBegin(),n-l.position>=e.POSITION_UPDATE_INTERVAL?this.notifyAdSkipped(this.adData.sessionToken,l):l.updateProgression(l.position,n));this.currentAdTracker=l,this.currentAdBreakTracker=u}else void 0!==this.currentAdTracker&&(h.o.d(C,"Exiting ad "+this.currentAdTracker.adId+"...",this.handler.id),n-(this.currentAdTracker.position+this.currentAdTracker.duration)<e.POSITION_UPDATE_INTERVAL&&(n=this.currentAdTracker.position+this.currentAdTracker.duration),i>=this.currentAdTracker.position&&this.currentAdTracker.updateProgression(i,n),this.currentAdTracker.progression<1&&this.notifyAdSkipped(this.adData.sessionToken,this.currentAdTracker),this.currentAdTracker.processEnd(),void 0!==u||this.isLive()||(this.currentAdBreakTracker.processEnd(),this.currentAdBreakTracker=void 0,this.currentAdBreakData=void 0),this.currentAdTracker=void 0,this.currentAdData=void 0);this.lastPosition=t,null!==(d=this.adData)&&void 0!==d&&d.hasRemainingAdBreaks(n)?this.paused||this.buffering?h.o.d(C,"Ad tracking paused (playback paused, onPositionUpdated)",this.handler.id):this.start():h.o.d(C,"Ad tracking paused (no more event, onPositionUpdated)",this.handler.id)}else{var f;h.o.d(C,"Processing trackers from "+i+"ms to "+n+"ms, resuming tracking...",this.handler.id),null!==(f=this.adData)&&void 0!==f&&f.hasRemainingAdBreaks(n)&&(this.paused||this.buffering||this.start())}}},{key:"checkStart",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.playerAdapter.getPosition();(null===(e=this.adData)||void 0===e?void 0:e.hasRemainingAdBreaks(t))>0?this.onPositionUpdated(t):h.o.d(C,"Ad tracking paused (no more event, checkStart)",this.handler.id)}},{key:"checkAdBreakEnded",value:function(t){var i=this.lastPosition!==t?this.lastPosition:t-1,n=t;if(i<n&&n-i<e.POSITION_SEEK_ERROR_DELTA){var s,r=null===(s=this.adData)||void 0===s?void 0:s.adBreaks.find((function(e){return e.position<=n&&n<e.position+e.duration}));void 0!==this.currentAdBreakTracker&&(void 0===r?(void 0!==this.currentAdTracker&&this.currentAdTracker.position+this.currentAdTracker.duration-n<e.POSITION_SEEK_ERROR_DELTA&&(this.currentAdTracker.updateProgression(this.currentAdTracker.position,this.currentAdTracker.position+this.currentAdTracker.duration),this.currentAdTracker.processEnd(),this.currentAdTracker=void 0,this.currentAdData=void 0),this.currentAdBreakTracker.processEnd(),this.currentAdBreakTracker=void 0,this.currentAdBreakData=void 0,h.o.d(C,"Ad break end detected",this.handler.id)):h.o.d(C,"Ad break not yet ended",this.handler.id))}}},{key:"adUserInteraction",value:function(e){var t,i=this;null===(t=this.currentAdTracker)||void 0===t||null===(t=t.clickable)||void 0===t||t.trackers.forEach((function(e){h.o.d(C,"Requesting click tracker "+e.clickurl,i.handler.id),p.Z.getInstance().adEvent(i.handler,e.clickurl)}))}},{key:"getCurrentAd",value:function(){return this.currentAdData}},{key:"getCurrentAdBreak",value:function(){return this.currentAdBreakData}},{key:"getPositionForBookmark",value:function(){if(this.playerAdapter.getDuration()>0){var e=this.playerAdapter.getPosition(),t=this.adList.find((function(t){return t.startPosition<e&&e<=t.startPosition+t.duration}));return void 0!==t&&(e=t.startPosition),this.adList.filter((function(t){return t.startPosition+t.duration<e})).forEach((function(t){e-=t.duration})),e}return-1}},{key:"getPositionForPlayback",value:function(e){for(var t=e,i=this.adList.sort((function(e,t){return e.startPosition-t.startPosition})),n=0;n<i.length;n++){var s=i[n];if(s.startPosition>t)break;(s.startPosition+s.duration<t||s.startPosition<=t&&t<=s.startPosition+s.duration)&&(t+=s.duration)}return t}},{key:"onFirstImage",value:function(e,t){var i,n=this;this.started=!0,this.paused=!1,this.buffering=!1,this.lastPosition=t,this.firstImageDate=Date.now(),h.o.d(C,"Ad tracking enabled (live:"+this.isLive()+")",this.handler.id),void 0!==this.adData&&(this.adList=this.adData.adBreaks.map((function(e){return e.live=n.isLive(),e.toData()}))),this.checkStart(t),this.updateBkYouSession(),this.isLive()&&this.playerAdapter.getPosition()<12623004e5&&h.o.e(C,"The player position does not return a position as a timestamp in millis. The ad tracking might not work.",this.handler.id),null===(i=this.adPalSession)||void 0===i||i.sendPlaybackStart()}},{key:"onPause",value:function(){this.paused=!0,this.stop();var e=this.playerAdapter.getPosition();this.lastPosition!==e?this.onPositionUpdated(e):h.o.d(C,"Ignoring player position "+e+", already proceeded...",this.handler.id),this.lastPosition=e,this.lastPositionBeforePause=this.lastPosition}},{key:"onResume",value:function(){this.paused=!1,this.buffering||(this.lastPosition=this.playerAdapter.getPosition(),Math.abs(this.lastPosition-this.lastPositionBeforePause)<1e3&&(h.o.d(C,"Reverting position because of bad position when resuming...",this.handler.id),this.lastPosition=this.lastPositionBeforePause,this.lastPositionBeforePause=0),this.checkStart())}},{key:"onBufferingStart",value:function(){this.buffering=!0,this.stop();var e=this.playerAdapter.getPosition();this.lastPosition!==e?this.onPositionUpdated(e):h.o.d(C,"Ignoring player position "+e+", already proceeded...",this.handler.id),this.lastPosition=e}},{key:"onBufferingEnd",value:function(e){if(this.buffering=!1,!this.paused){var t=this.playerAdapter.getPosition();this.lastPosition!==t&&(h.o.d(C,"Position updated during buffering, period switch ?",this.handler.id),this.onPositionUpdated(t)),Math.abs(this.lastPosition-this.lastPositionAfterSeek)<1e3&&(h.o.d(C,"Reverting position because of seek...",this.handler.id),this.lastPosition=this.lastPositionAfterSeek,this.lastPositionAfterSeek=0),this.checkStart()}}},{key:"onSeek",value:function(t,i){var n,s;if(t<this.lastPosition&&this.lastPosition-t<e.POSITION_SEEK_ERROR_DELTA&&(h.o.d(C,"Updating seek start position from "+t+" to "+this.lastPosition,this.handler.id),t=this.lastPosition),this.buffering?(this.lastPositionAfterSeek=i,s=this.lastPosition):(Math.abs(this.lastPosition-t)<e.POSITION_SEEK_ERROR_DELTA&&(this.onPositionUpdated(t),this.lastPosition=t),s=t,this.lastPositionAfterSeek=0),this.lastPosition=i,Math.abs(i-t)<e.POSITION_SEEK_ERROR_DELTA){if(h.o.d(C,"Seek detected, proceeding events...",this.handler.id),i<t&&t-i<2e3)return h.o.d(C,"Ignoring seek...",this.handler.id),this.lastPosition=t,void this.onPositionUpdated(t);var r,a,o;t<i?(r=s,a=i):(r=i,a=s<t?t:s),i-t<0&&(a=i);for(var d=r;d<=a;d+=e.POSITION_UPDATE_INTERVAL){var u=Math.min(d+e.POSITION_UPDATE_INTERVAL,a);h.o.d(C,"Between "+d+" and "+u,this.handler.id),this.lastPosition=d,this.onPositionUpdated(u)}h.o.d(C,"Seek processed start:"+r+" end:"+a,this.handler.id),i-t<0&&(h.o.d(C,"Reset ad trackers with position "+a,this.handler.id),null===(o=this.adData)||void 0===o||o.resetProgression(a))}else void 0!==this.currentAdTracker&&this.notifyAdSkipped(this.adData.sessionToken,this.currentAdTracker),this.onPositionUpdated(i),h.o.d(C,"Reset ad trackers with position "+i,this.handler.id),null===(n=this.adData)||void 0===n||n.resetProgression(i)}},{key:"onStop",value:function(e){var t;this.stop(),this.lastPosition=this.playerAdapter.getPosition(),this.onPositionUpdated(this.lastPosition),this.stop(),void 0!==this.updateSessionJob&&f.Z.getInstance().cancel(this.updateSessionJob),null===(t=this.adPalSession)||void 0===t||t.sendPlaybackEnd()}},{key:"addListener",value:function(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"notifyEvent",value:function(e,t,i,n,s,r){"function"==typeof e[t]&&e[t](i,n,s,r)}},{key:"notifyAdBreakData",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakData",e)}))}},{key:"notifyAdBreakBegin",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakBegin",e)}))}},{key:"notifyAdData",value:function(e){var t,i=this;this.listeners.forEach((function(t){i.notifyEvent(t,"onAdData",e)}));var n=null===(t=this.handler.adSession)||void 0===t||null===(t=t.adParameters)||void 0===t?void 0:t.adsExtData;n&&n[e.creativeId]&&n[e.creativeId].nonLinearAd&&(e.nonLinearAd=n[e.creativeId].nonLinearAd),e.nonLinearAd&&this.loadNonLinearInteractiveAd(e.nonLinearAd,e.duration)}},{key:"notifyAdBegin",value:function(e,t){var i,n=this;this.listeners.forEach((function(i){n.notifyEvent(i,"onAdBegin",e,t.creativeId,t.adId)})),null===(i=this.adPalSession)||void 0===i||i.sendAdImpression()}},{key:"notifyAdSkippable",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdSkippable",e)}))}},{key:"notifyAdProgress",value:function(e,t,i){var n=this;this.listeners.forEach((function(s){n.notifyEvent(s,"onAdProgress",e,t.creativeId,t.adId,i)}))}},{key:"notifyAdSkipped",value:function(e,t){var i=this,n=[];t.adBreak.ads.forEach((function(e){e.position>t.position&&e.position<i.lastPosition&&n.push(e.adId)})),this.listeners.forEach((function(s){i.notifyEvent(s,"onAdSkipped",e,t.creativeId,t.adId,n)}))}},{key:"notifyAdEnd",value:function(e,t){var i=this;this.isLive()&&(void 0!==this.updateSessionJob&&f.Z.getInstance().cancel(this.updateSessionJob),this.updateBkYouSession()),this.listeners.forEach((function(n){i.notifyEvent(n,"onAdEnd",e,t.creativeId,t.adId)}))}},{key:"notifyAdBreakEnd",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdBreakEnd",e)}))}},{key:"notifyAdsUpdated",value:function(e){var t=this;this.listeners.forEach((function(i){t.notifyEvent(i,"onAdsUpdated",e)}))}},{key:"notifyAdDataListener",value:function(e){var t,i=this.firstImageDate||Date.now(),n=0===this.podsSentNumber&&!1===this.firstFileProceeded&&Date.now()-i<=4e3;h.o.d(C,"On ad data (firstData: "+n+", dataUpdated: "+e+")",this.handler.id),(!0===n||!0===e)&&(this.podsSentNumber=this.adList.length,h.o.d(C,"On ad data (length: "+this.podsSentNumber+")",this.handler.id),null===(t=this.handler.adSession)||void 0===t||null===(t=t.adDataListener)||void 0===t||t.onAdData(this.adList))}},{key:"loadNonLinearInteractiveAd",value:function(e,t){var i=this,n=this.playerAdapter.getMediaElement?this.playerAdapter.getMediaElement():void 0;if(n&&"simid"===e.apiFramework.toLowerCase()){var s=e.iframeResource,r=e.adParams,a=t/1e3-2;h.o.d(C,"Load non-linear interactive ad from uri"+s),this.simidPlayer=new M.SimidPlayer(n,s,!1,(function(){return i.unloadNonLinearInteractiveAd()}),JSON.stringify(r),a),this.simidPlayer.load()}}},{key:"unloadNonLinearInteractiveAd",value:function(){this.simidPlayer&&(h.o.d(C,"Unload non-linear interactive ad"),this.simidPlayer.reset(),this.simidPlayer=void 0)}}],i&&N(t.prototype,i),n&&N(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function U(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,F(n.key),n)}}function j(e,t,i){return(t=F(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function F(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}w(V,"POSITION_UPDATE_INTERVAL",1e3),w(V,"POSITION_SEEK_ERROR_DELTA",6e3),w(V,"SESSION_UPDATE_INTERVAL",5e3);var K="BpkAdMetricsMgr",q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j(this,"handler",void 0),j(this,"timeline",void 0),j(this,"builder",void 0),j(this,"adMetrics",void 0),j(this,"firstImage",void 0),j(this,"lastLayerBitrate",void 0),j(this,"adBreakPlaying",void 0),j(this,"adPlaying",void 0),j(this,"adSkipped",void 0),j(this,"adLastLayerSwitchDate",void 0),j(this,"adLastBufferingStartDate",void 0),this.handler=t,this.timeline=this.handler.sessionReport.timeline,this.builder=new u,this.adMetrics={}}var t,i,n;return t=e,(i=[{key:"onStart",value:function(){this.adMetrics={},this.adLastLayerSwitchDate=0,this.firstImage=!1,this.lastLayerBitrate=0,this.adLastBufferingStartDate=-1,this.adBreakPlaying=!1,this.adPlaying=!1,this.adSkipped=!1}},{key:"onFirstImage",value:function(e,t){this.lastLayerBitrate=e,this.adLastLayerSwitchDate=Date.now(),this.firstImage=!0}},{key:"onLayerSwitch",value:function(e){this.adBreakPlaying&&this.firstImage&&(this.builder.addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate),this.adLastLayerSwitchDate=Date.now(),this.lastLayerBitrate!==e&&this.builder.addLayerSwitch()),this.lastLayerBitrate=e}},{key:"onBufferingStart",value:function(){this.adBreakPlaying&&(this.adLastBufferingStartDate=Date.now())}},{key:"onStallEnd",value:function(){this.adBreakPlaying&&this.adLastBufferingStartDate>=0&&this.builder.addStall(Date.now()-this.adLastBufferingStartDate),this.adLastBufferingStartDate=-1}},{key:"onRebufferingEnd",value:function(){this.adLastBufferingStartDate=-1}},{key:"onSeek",value:function(e,t){this.adBreakPlaying&&(h.o.d(K,"Ad seeked from "+l.Z.formatTime(e)+" to "+l.Z.formatTime(t)),Math.abs(t-e)<V.POSITION_SEEK_ERROR_DELTA?h.o.d(K,"Ignoring seek < "+V.POSITION_SEEK_ERROR_DELTA+"ms"):this.adSkipped=!0)}},{key:"onStop",value:function(e){this.adBreakPlaying&&(this.adSkipped=!0,this.handleAdEnd(),this.adBreakPlaying=!1)}},{key:"onAdBreakBegin",value:function(e){var t;this.adBreakPlaying=!0,void 0!==this.timeline&&this.timeline.pushEvent(null===(t=c.Z.analyticsModule)||void 0===t?void 0:t.SessionTrackerEvents.AdBreakStart)}},{key:"onAdBegin",value:function(e,t,i){this.adSkipped&&this.handleAdEnd(),this.adSkipped=!1,this.adLastLayerSwitchDate=Date.now(),this.builder.reset().import(this.adMetrics[i]).setSessionToken(e).setCreativeId(t).setAdId(i),this.adPlaying=!0}},{key:"onAdSkippable",value:function(e){this.builder.setAdSkippable(!0)}},{key:"onAdSkipped",value:function(e,t,i,n){var s=this;this.adSkipped=!0,n.length>0&&(h.o.d(K,"Ad break skipped"),n.forEach((function(e){s.adMetrics[e].adSkipped=!0})))}},{key:"onAdProgress",value:function(e,t,i,n){this.builder.addProgress(n),n>0&&void 0===this.builder.quartiles[n-25]&&(this.adSkipped=!0)}},{key:"onAdEnd",value:function(e,t,i){this.handleAdEnd(),this.adPlaying=!1}},{key:"onAdBreakEnd",value:function(e){var t;!0===this.adPlaying&&(this.builder.setAdSkipped(!0),this.handleAdEnd()),this.adBreakPlaying=!1,void 0!==this.timeline&&this.timeline.pushEventProgress(null===(t=c.Z.analyticsModule)||void 0===t?void 0:t.SessionTrackerEvents.AdBreakStop,this.adMetrics.adProgress)}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){if(this.adBreakPlaying){var t=this.builder.clone().addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);this.adLastBufferingStartDate>=0&&t.addStall(Date.now()-this.adLastBufferingStartDate);var i=t.build();i.adId.length>0&&(this.adMetrics[i.adId]=i)}e.adMetrics=Object.values(this.adMetrics)}},{key:"onEndSessionReportUpdateRequested",value:function(e){e.adMetrics=Object.values(this.adMetrics)}},{key:"handleAdEnd",value:function(){this.builder.setAdSkipped(this.adSkipped).addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);var e=this.builder.build();e.adId.length>0&&(this.adMetrics[e.adId]=e),h.o.d(K,"Ad metrics : "+e.toString()),this.builder.reset(),this.adSkipped=!1}},{key:"onAdsUpdated",value:function(e){var t=this;e.adBreaks.forEach((function(i){i.ads.forEach((function(i){if(void 0===t.adMetrics[i.adId]){var n,s=new u;t.adMetrics[i.adId]=s.setSessionToken(e.sessionToken).setCreativeId(i.creativeId).setAdId(i.adId).build(),h.o.d(K,"Adding ad metrics report for ad id "+i.adId,null===(n=t.handler)||void 0===n?void 0:n.id)}}))}))}}])&&U(t.prototype,i),n&&U(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),x=i(9275),H=i(2239),Y=i(1221);function G(e,t,i,n){return Z(e,t),Q(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,n),n}function J(e,t,i){return Z(e,t),Q(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function Q(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Z(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$(n.key),n)}}function X(e,t,i){return t&&W(e.prototype,t),i&&W(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function $(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var ee="BpkOMSDKMgr",te=function(){function e(){var t,i,n;z(this,e),t=this,n=void 0,(i=$(i="smartLib"))in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n}return X(e,[{key:"init",value:function(){h.o.d(ee,"Initializing OM SDK manager...")}},{key:"release",value:function(){}},{key:"attachInstance",value:function(e){this.smartLib=e}},{key:"attachHandler",value:function(e){h.o.d(ee,"Attaching OM SDK handler..."),this.omsdkHandler=e}},{key:"isEnabled",value:function(){return void 0!==this.omsdkHandler&&null!==this.omsdkHandler}}],[{key:"getInstance",value:function(){return J(e,e,ie)||G(e,e,ie,new e),J(e,e,ie)}}]),e}(),ie={writable:!0,value:void 0};i(4254),i(752),i(1694),i(6265),i(7722),i(4043),i(7409);function ne(e){return function(e){if(Array.isArray(e))return se(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return se(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return se(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function re(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oe(n.key),n)}}function ae(e,t,i){return(t=oe(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function oe(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var de="BpkOMSessionHandler",ue=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae(this,"handler",void 0),ae(this,"adSession",void 0),ae(this,"playerAdapter",void 0),ae(this,"internalAdManager",void 0),ae(this,"omsdkHandler",void 0),ae(this,"omAdSession",void 0),ae(this,"firstImageDate",void 0),ae(this,"adBreakPosition",void 0),ae(this,"pause",void 0),ae(this,"buffering",void 0),this.handler=t,this.adSession=t.adSession,this.playerAdapter=i,this.internalAdManager=this.handler.smartLib.internalAdManager,this.omsdkHandler=te.getInstance().omsdkHandler,this.firstImageDate=0,this.adBreakPosition="midroll",this.pause=!1,this.buffering=!1}var t,i,n;return t=e,(i=[{key:"onStart",value:function(){}},{key:"onRedirectionEnd",value:function(){}},{key:"onFirstImage",value:function(e,t){this.firstImageDate=Date.now()}},{key:"onLayerSwitch",value:function(e){}},{key:"onPause",value:function(){var e;!1===this.pause&&(null===(e=this.omAdSession)||void 0===e||e.pause()),this.pause=!0}},{key:"onResume",value:function(){var e;!0===this.pause&&(null===(e=this.omAdSession)||void 0===e||e.resume()),this.pause=!1}},{key:"onBufferingStart",value:function(){var e;!1===this.buffering&&(null===(e=this.omAdSession)||void 0===e||e.bufferStart()),this.buffering=!0}},{key:"onBufferingEnd",value:function(e){var t;!0===this.buffering&&(null===(t=this.omAdSession)||void 0===t||t.bufferFinish()),this.buffering=!1}},{key:"onStallEnd",value:function(){}},{key:"onRebufferingEnd",value:function(){}},{key:"onSeek",value:function(e,t){var i;void 0!==this.adData&&Math.abs(t-e)>=1e3&&(t>=this.adData.position+this.adData.duration||t<this.adData.position)&&(null===(i=this.omAdSession)||void 0===i||i.skipped())}},{key:"onStop",value:function(e){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onStartSessionReportUpdateRequested",value:function(e){}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(e){}},{key:"onEndSessionReportUpdateRequested",value:function(e){}},{key:"onAdBreakData",value:function(e){Math.abs(e.position+e.duration-this.playerAdapter.getDuration())<1e4?this.adBreakPosition="postroll":Date.now()-this.firstImageDate<3e3?this.adBreakPosition="preroll":this.adBreakPosition="midroll",h.o.d(de,"Ad break position is "+this.adBreakPosition,this.handler.id)}},{key:"onAdBreakBegin",value:function(e){}},{key:"onAdData",value:function(e){var t,i,n,s,r,a,o,d=this;void 0!==this.adData&&(null===(a=this.omAdSession)||void 0===a||a.finish(),this.omAdSession=void 0),this.adData=e,o=void 0!==(null===(t=this.adSession)||void 0===t?void 0:t.adVerificationData)?ne(this.adSession.adVerificationData):[],this.adData.verifications.forEach((function(e){var t=e.javascriptResources.find((function(e){return"omid"===e.apiframework}));o.push({verificationVendor:e.vendor,verificationURL:t.url,verificationParameters:e.verificationParameters})})),this.omAdSession=this.omsdkHandler.createOMAdSession(this.internalAdManager.omPartnerName,this.internalAdManager.omPartnerVersion,null===(i=this.adSession)||void 0===i?void 0:i.adCustomReference,o),void 0!==(null===(n=this.adSession)||void 0===n?void 0:n.adView)&&this.omAdSession.setAdView(this.adSession.adView),(null===(s=this.adSession)||void 0===s?void 0:s.adFriendlyObstructionViews.length)>0&&this.adSession.adFriendlyObstructionViews.forEach((function(e){d.omAdSession.registerAdFriendlyObstructionView(e.view,e.purpose,e.reason)})),this.omAdSession.start(),void 0!==(null===(r=this.adSession)||void 0===r?void 0:r.adViewState)&&this.omAdSession.setAdViewState(this.adSession.adViewState),!0===e.skippable?this.omAdSession.loaded(e.skippablePosition-e.position,e.duration,this.adBreakPosition,this.playerAdapter.getVolume()):this.omAdSession.loaded(-1,e.duration,this.adBreakPosition,this.playerAdapter.getVolume())}},{key:"onAdBegin",value:function(e,t,i){}},{key:"onAdSkippable",value:function(e){}},{key:"onAdProgress",value:function(e,t,i,n){var s;null===(s=this.omAdSession)||void 0===s||s.progress(n)}},{key:"onAdEnd",value:function(e,t,i){var n;this.adData=void 0,null===(n=this.omAdSession)||void 0===n||n.finish(),this.omAdSession=void 0}},{key:"onAdBreakEnd",value:function(e){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onVolumeChanged",value:function(e){var t;h.o.d(de,"Volume is now "+e,this.handler.id),null===(t=this.omAdSession)||void 0===t||t.volumeChange(e)}},{key:"onPlayerError",value:function(e,t){var i;h.o.e(de,"Broadpeak status code "+e,this.handler.id),h.o.e(de,"Player error code "+t,this.handler.id),null===(i=this.omAdSession)||void 0===i||i.error(e,t)}}])&&re(t.prototype,i),n&&re(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();c.Z.adModule={AdMetrics:d,AdMetricsBuilder:u,AdMetricsManager:q,AdTrackingManager:V,AdDataTracker:T,AdBreakTracker:L,AdTracker:R,AdEventTracker:O,AdManager:x.Vv,AdViewState:x.S0,AdFriendlyObstructionPurpose:x.nb,AdSession:H.J,InternalAdManager:Y.Z,OMSDKManager:te,OMSessionHandler:ue}},9419:function(e,t,i){"use strict";var n=i(7697),s=i(3689),r=i(8844),a=i(1868),o=i(300),d=i(5290),u=r(i(9556).f),h=r([].push),l=n&&s((function(){var e=Object.create(null);return e[2]=2,!u(e,2)})),c=function(e){return function(t){for(var i,s=d(t),r=o(s),c=l&&null===a(s),f=r.length,p=0,v=[];f>p;)i=r[p++],n&&!(c?i in s:u(s,i))||h(v,e?[i,s[i]]:s[i]);return v}};e.exports={entries:c(!0),values:c(!1)}},9772:function(e,t,i){"use strict";var n=i(9989),s=i(2960).findIndex,r=i(7370),a="findIndex",o=!0;a in[]&&Array(1)[a]((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{findIndex:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),r(a)},5728:function(e,t,i){"use strict";var n=i(9989),s=i(2960).find,r=i(7370),a="find",o=!0;a in[]&&Array(1)[a]((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),r(a)},278:function(e,t,i){"use strict";var n=i(9989),s=i(8820).left,r=i(6834),a=i(3615);n({target:"Array",proto:!0,forced:!i(806)&&a>79&&a<83||!r("reduce")},{reduce:function(e){var t=arguments.length;return s(this,e,t,t>1?arguments[1]:void 0)}})},6466:function(e,t,i){"use strict";var n=i(9989),s=i(9419).values;n({target:"Object",stat:!0},{values:function(e){return s(e)}})}},function(e){return e.O(0,[142],(function(){return t=4717,e(e.s=t);var t})),e.O()}])}));