"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("shakaSmartLibModule",[],t):"object"==typeof exports?exports.shakaSmartLibModule=t():e.shakaSmartLibModule=t()}("undefined"!=typeof self?self:global,(function(){return(("undefined"!=typeof self?self:global).webpackChunkSmartLibModule=("undefined"!=typeof self?self:global).webpackChunkSmartLibModule||[]).push([[515],{634:function(e,t,i){i.r(t),i.d(t,{ShakaPlayerAdapter:function(){return m}});i(2675),i(9463),i(2259),i(5700),i(8706),i(5276),i(3792),i(9572),i(2892),i(875),i(6099),i(825),i(7764),i(3772),i(2953);var r=i(8636),n=i(3575),o=i(5329);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function l(e,t,i){return t=u(t),function(e,t){if(t&&("object"==a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,i||[],u(e).constructor):t.apply(e,i))}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(h=function(){return!!e})()}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function y(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function c(e,t,i){return(t=f(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function f(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}function v(e,t,i){return e.set(g(e,t),i),i}function p(e,t){return e.get(g(e,t))}function g(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var b="BpkShakaPlayerAdapter",P=new WeakMap,E=new WeakMap,m=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return y(e=l(this,t,[].concat(r)),P,void 0),y(e,E,void 0),c(e,"loading",void 0),c(e,"started",void 0),c(e,"bitrate",void 0),c(e,"playingEventReceived",void 0),c(e,"requestedURLReceived",void 0),c(e,"redirectedURLReceived",void 0),c(e,"loadingError",void 0),c(e,"playerStateManager",void 0),c(e,"playerListeners",void 0),c(e,"manifestType",void 0),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(t,e),i=t,a=[{key:"attachLibrary",value:function(e){void 0!==e.util&&void 0!==e.Player?(r.gD.d(b,"Shaka Player library attached"),t.library=e):r.gD.e(b,"Try to attach a library, but it is not recognized")}},{key:"checkPlayer",value:function(e,i){if("undefined"!=typeof window&&void 0!==window.shaka&&(t.library=window.shaka),"function"==typeof e.getConfiguration){var r=e.getConfiguration();if(void 0!==r.manifest&&void 0!==r.streaming)return!0}return!1}}],(n=[{key:"onPlayEvent",value:function(){this.started&&this.notifyResume()}},{key:"onPlayingEvent",value:function(){this.playingEventReceived=!0,this.started||(p(P,this).isBuffering()?r.gD.d(b,"Player is still buffering, first image event not yet triggered"):(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage()))}},{key:"onPauseEvent",value:function(){this.notifyPause()}},{key:"onBuffering",value:function(){var e=p(P,this).isBuffering();if(!0===r.x6.getInstance().isAnalyticsInitialized()&&!1===this.requestedURLReceived){this.requestedURLReceived=!0;var t,i=p(P,this).getAssetUri();null!=i?(r.gD.d(b,"Requested URL: "+i),this.setCustomParameter("report.requestedURL",i)):(r.gD.d(b,"Playback not started"),void 0!==this.loadingError&&(t=this.getErrorCode(this.loadingError),this.setPlayerErrorCode(this.loadingError.code)),this.notifyPlayerError(t,this.loadingError.code),this.notifyClose(t))}this.started?e?(void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallStart()):(this.notifyStallEnd(),this.setStatusCode(r.x6.BPSessionEndsNormally),this.setPlayerErrorCode("")):!e&&this.playingEventReceived&&(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage())}},{key:"onLayerSwitchEvent",value:function(){var e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}},{key:"onVariantChanged",value:function(){this.onLayerSwitchEvent()}},{key:"onLoadingEvent",value:function(){!1===this.loading&&(this.loading=!0,this.notifyLoading())}},{key:"onStateChangeEvent",value:function(e){"unload"===e.state&&this.notifyClose()}},{key:"onNetworkResponseEvent",value:function(e,t){0===e&&!0===r.x6.getInstance().isAnalyticsInitialized()&&!1===this.redirectedURLReceived&&(this.redirectedURLReceived=!0,r.gD.d(b,"Resolved redirected URL: "+t.uri),this.setCustomParameter("report.redirectedURL",t.uri))}},{key:"handleSeek",value:function(e,t){this.notifySeek(e,t)}},{key:"onErrorEvent",value:function(e){if(e.detail.severity===t.library.util.Error.Severity.CRITICAL){var i=this.getErrorCode(e.detail),n=e.detail.code;r.gD.e(b,"On player error : "+n),this.setStatusCode(i),this.setPlayerErrorCode(n),this.notifyPlayerError(i,n)}}},{key:"onVolumeChange",value:function(){this.notifyVolumeChanged(this.getVolume())}},{key:"getVolume",value:function(){return void 0!==p(P,this)?!0===p(P,this).getMediaElement().muted?0:p(P,this).getMediaElement().volume:1}},{key:"getName",value:function(){return"Shaka Player"}},{key:"getVersion",value:function(){var e=t.library.Player.version.substring(0,32),i=e.indexOf(" ");return i>=0?e.substring(0,i):e}},{key:"getBitrate",value:function(){if(void 0!==p(P,this))for(var e=p(P,this).getVariantTracks(),t=0;t<e.length;t++){var i=e[t];if(!0===i.active)return Math.round(i.bandwidth/1e3)}return 0}},{key:"getPosition",value:function(){return void 0!==p(P,this)?"DASH"===this.getManifestType()?1e3*p(P,this).getMediaElement().currentTime:Math.round(p(P,this).isLive()?p(P,this).getPlayheadTimeAsDate().getTime():1e3*p(P,this).getMediaElement().currentTime):0}},{key:"getDuration",value:function(){return void 0===p(P,this)||p(P,this).isLive()?0:Math.round(1e3*p(P,this).getMediaElement().duration)}},{key:"getCapabilities",value:function(){return{adTracking:!0}}},{key:"getErrorCode",value:function(e){switch(e.category){case t.library.util.Error.Category.NETWORK:return r.x6.BPNetworkingError;case t.library.util.Error.Category.TEXT:case t.library.util.Error.Category.MEDIA:case t.library.util.Error.Category.MANIFEST:return r.x6.BPFormatNotSupportedError;case t.library.util.Error.Category.STREAMING:return r.x6.BPDecodingError;case t.library.util.Error.Category.DRM:return r.x6.BPAccessRightError;case t.library.util.Error.Category.PLAYER:case t.library.util.Error.Category.CAST:case t.library.util.Error.Category.STORAGE:default:return r.x6.BPUnspecifiedError}}},{key:"setLoadingError",value:function(e){this.loadingError=e}},{key:"initSessionPlayerObjects",value:function(){this.loading=!1,this.started=!1,this.bitrate=0,this.playingEventReceived=!1,this.requestedURLReceived=!1,this.redirectedURLReceived=!1,this.loadingError=void 0,void 0!==p(P,this)&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new o.A(this,this),this.playerListeners=[this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onBuffering.bind(this),this.onLayerSwitchEvent.bind(this),this.onErrorEvent.bind(this),this.onPlayingEvent.bind(this),this.onVariantChanged.bind(this),this.onLoadingEvent.bind(this),this.onStateChangeEvent.bind(this),this.onNetworkResponseEvent.bind(this),this.onVolumeChange.bind(this)],p(P,this).getMediaElement().addEventListener("play",this.playerListeners[0]),p(P,this).getMediaElement().addEventListener("pause",this.playerListeners[1]),p(P,this).addEventListener("buffering",this.playerListeners[2]),p(P,this).addEventListener("adaptation",this.playerListeners[3]),p(P,this).addEventListener("error",this.playerListeners[4]),p(P,this).getMediaElement().addEventListener("playing",this.playerListeners[5]),p(P,this).addEventListener("variantchanged",this.playerListeners[6]),p(P,this).addEventListener("loading",this.playerListeners[7]),p(P,this).addEventListener("onstatechange",this.playerListeners[8]),p(P,this).getNetworkingEngine().registerResponseFilter(this.playerListeners[9]),p(P,this).getMediaElement().addEventListener("volumechange",this.playerListeners[10]))}},{key:"releaseSessionPlayerObjects",value:function(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==p(P,this)&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(p(P,this).getMediaElement().removeEventListener("play",this.playerListeners[0]),p(P,this).getMediaElement().removeEventListener("pause",this.playerListeners[1]),p(P,this).removeEventListener("buffering",this.playerListeners[2]),p(P,this).removeEventListener("adaptation",this.playerListeners[3]),p(P,this).removeEventListener("error",this.playerListeners[4]),p(P,this).getMediaElement().removeEventListener("playing",this.playerListeners[5]),p(P,this).removeEventListener("variantchanged",this.playerListeners[6]),p(P,this).removeEventListener("loading",this.playerListeners[7]),p(P,this).removeEventListener("onstatechange",this.playerListeners[8]),p(P,this).getNetworkingEngine().unregisterResponseFilter(this.playerListeners[9]),p(P,this).getMediaElement().removeEventListener("volumechange",this.playerListeners[10]))}},{key:"attachPlayer",value:function(e,i){return!!t.checkPlayer(e,i)&&(void 0===t.library&&r.gD.e(b,"Player library not attached to the adapter, please call ShakaPlayerAdapter.attachLibrary(shaka) before attachPlayer"),v(P,this,e),v(E,this,i),!0)}},{key:"detachPlayer",value:function(){this.releaseSessionPlayerObjects(),v(P,this,void 0),v(E,this,void 0)}},{key:"getManifestType",value:function(){if(!this.manifestType){var e=p(P,this).getManifest();e&&(this.manifestType=e.type)}return this.manifestType}}])&&s(i.prototype,n),a&&s(i,a),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,n,a}(n.nm);c(m,"library",void 0),i(3557).A.shakaModule={ShakaPlayerAdapter:m}},5329:function(e,t,i){i.d(t,{A:function(){return l}});i(2675),i(9463),i(2259),i(5700),i(3792),i(9572),i(2892),i(6099),i(7764),i(2953);var r=i(8636);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function a(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var l=function(){return e=function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"playerAdapter",void 0),a(this,"listener",void 0),a(this,"pollPeriod",void 0),a(this,"pollLastDate",void 0),a(this,"pollPlayerInterval",void 0),a(this,"lastPosition",void 0),a(this,"expectedPosition",void 0),a(this,"pollBitrate",void 0),a(this,"lastBitrate",void 0),this.playerAdapter=t,this.listener=i,this.pollPeriod=e.POLLING_PERIOD,this.pollPlayerInterval=null,this.expectedPosition=0,this.pollLastDate=0,this.pollBitrate=r},(t=[{key:"start",value:function(){var e=this;this.lastPosition=this.playerAdapter.getPosition(),this.lastBitrate=this.playerAdapter.getBitrate(),this.expectedPosition=this.lastPosition+this.pollPeriod,this.pollLastDate=Date.now(),null!==this.pollPlayerInterval&&clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=setInterval((function(){e.pollPlayerPosition(),!0===e.pollBitrate&&e.pollPlayerBitrate()}),this.pollPeriod)}},{key:"stop",value:function(){null!==this.pollPlayerInterval&&(clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=null)}},{key:"forcePollPlayerPosition",value:function(){this.expectedPosition=this.expectedPosition-this.pollPeriod+(Date.now()-this.pollLastDate),this.pollPlayerPosition()}},{key:"pollPlayerPosition",value:function(){this.lastPosition=this.playerAdapter.getPosition();var e=this.expectedPosition+2*this.pollPeriod,t=this.expectedPosition-2*this.pollPeriod;(this.lastPosition<t||this.lastPosition>e)&&void 0!==this.listener&&"function"==typeof this.listener.handleSeek&&!0===this.listener.handleSeek(this.expectedPosition,this.lastPosition)&&r.gD.d("BpkPlayerStateManager","Player is seeking ("+r.Em.formatTime(this.expectedPosition)+" to "+r.Em.formatTime(this.lastPosition)+")"),this.expectedPosition=this.lastPosition+this.pollPeriod,void 0!==this.listener&&"function"==typeof this.listener.handlePoll&&this.listener.handlePoll(),this.pollLastDate=Date.now()}},{key:"pollPlayerBitrate",value:function(){var e=this.playerAdapter.getBitrate();e!==this.lastBitrate&&(void 0!==this.listener&&"function"==typeof this.listener.handleBitrateChange&&this.listener.handleBitrateChange(e),this.lastBitrate=e)}},{key:"getPositionBeforeSeek",value:function(){return this.lastPosition}}])&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}();a(l,"POLLING_PERIOD",500)}},function(e){return e.O(0,[153],(function(){return t=634,e(e.s=t);var t})),e.O()}])}));