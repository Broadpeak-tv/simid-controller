"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("shakaSmartLibModule",[],t):"object"==typeof exports?exports.shakaSmartLibModule=t():e.shakaSmartLibModule=t()}("undefined"!=typeof self?self:global,(function(){return(("undefined"!=typeof self?self:global).webpackChunkSmartLibModule=("undefined"!=typeof self?self:global).webpackChunkSmartLibModule||[]).push([[515],{3740:function(e,t,i){i.d(t,{A:function(){return s}});var r=i(1262);class s{static POLLING_PERIOD=500;playerAdapter;listener;pollPeriod;pollLastDate;pollPlayerInterval;lastPosition;expectedPosition;pollBitrate;lastBitrate;constructor(e,t,i=!1){this.playerAdapter=e,this.listener=t,this.pollPeriod=s.POLLING_PERIOD,this.pollPlayerInterval=null,this.expectedPosition=0,this.pollLastDate=0,this.pollBitrate=i}start(){this.lastPosition=this.playerAdapter.getPosition(),this.lastBitrate=this.playerAdapter.getBitrate(),this.expectedPosition=this.lastPosition+this.pollPeriod,this.pollLastDate=Date.now(),null!==this.pollPlayerInterval&&clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=setInterval((()=>{this.pollPlayerPosition(),!0===this.pollBitrate&&this.pollPlayerBitrate()}),this.pollPeriod)}stop(){null!==this.pollPlayerInterval&&(clearInterval(this.pollPlayerInterval),this.pollPlayerInterval=null)}forcePollPlayerPosition(){this.expectedPosition=this.expectedPosition-this.pollPeriod+(Date.now()-this.pollLastDate),this.pollPlayerPosition()}pollPlayerPosition(){this.lastPosition=this.playerAdapter.getPosition();const e=this.expectedPosition+2*this.pollPeriod,t=this.expectedPosition-2*this.pollPeriod;if((this.lastPosition<t||this.lastPosition>e)&&void 0!==this.listener&&"function"==typeof this.listener.handleSeek){!0===this.listener.handleSeek(this.expectedPosition,this.lastPosition)&&r.gD.d("BpkPlayerStateManager","Player is seeking ("+r.Em.formatTime(this.expectedPosition)+" to "+r.Em.formatTime(this.lastPosition)+")")}this.expectedPosition=this.lastPosition+this.pollPeriod,void 0!==this.listener&&"function"==typeof this.listener.handlePoll&&this.listener.handlePoll(),this.pollLastDate=Date.now()}pollPlayerBitrate(){const e=this.playerAdapter.getBitrate();e!==this.lastBitrate&&(void 0!==this.listener&&"function"==typeof this.listener.handleBitrateChange&&this.listener.handleBitrateChange(e),this.lastBitrate=e)}getPositionBeforeSeek(){return this.lastPosition}}},6185:function(e,t,i){i.r(t),i.d(t,{ShakaPlayerAdapter:function(){return l}});var r=i(1262),s=i(5207),a=i(3740);const n="BpkShakaPlayerAdapter";class l extends s.nm{static library;#e;#t;loading;started;bitrate;playingEventReceived;requestedURLReceived;redirectedURLReceived;loadingError;playerStateManager;playerListeners;onPlayEvent(){this.started&&this.notifyResume()}onPlayingEvent(){if(this.playingEventReceived=!0,!this.started){this.#e.isBuffering()?r.gD.d(n,"Player is still buffering, first image event not yet triggered"):(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage())}}onPauseEvent(){this.notifyPause()}onBuffering(){const e=this.#e.isBuffering();if(!0===r.x6.getInstance().isAnalyticsInitialized()&&!1===this.requestedURLReceived){this.requestedURLReceived=!0;const e=this.#e.getAssetUri();if(null!=e)r.gD.d(n,"Requested URL: "+e),this.setCustomParameter("report.requestedURL",e);else{let e;r.gD.d(n,"Playback not started"),void 0!==this.loadingError&&(e=this.getErrorCode(this.loadingError),this.setPlayerErrorCode(this.loadingError.code)),this.notifyPlayerError(e,this.loadingError.code),this.notifyClose(e)}}this.started?e?(void 0!==this.playerStateManager&&this.playerStateManager.forcePollPlayerPosition(),this.notifyStallStart()):(this.notifyStallEnd(),this.setStatusCode(r.x6.BPSessionEndsNormally),this.setPlayerErrorCode("")):!e&&this.playingEventReceived&&(this.started=!0,this.playerStateManager.start(),this.notifyFirstImage())}onLayerSwitchEvent(){const e=this.getBitrate();e!==this.bitrate&&(this.bitrate=e,this.notifyLayerSwitch(e))}onVariantChanged(){this.onLayerSwitchEvent()}onLoadingEvent(){!1===this.loading&&(this.loading=!0,this.notifyLoading())}onStateChangeEvent(e){"unload"===e.state&&this.notifyClose()}onNetworkResponseEvent(e,t){0===e&&!0===r.x6.getInstance().isAnalyticsInitialized()&&!1===this.redirectedURLReceived&&(this.redirectedURLReceived=!0,r.gD.d(n,"Resolved redirected URL: "+t.uri),this.setCustomParameter("report.redirectedURL",t.uri))}handleSeek(e,t){this.notifySeek(e,t)}onErrorEvent(e){if(e.detail.severity===l.library.util.Error.Severity.CRITICAL){const t=this.getErrorCode(e.detail),i=e.detail.code;r.gD.e(n,"On player error : "+i),this.setStatusCode(t),this.setPlayerErrorCode(i),this.notifyPlayerError(t,i)}}onVolumeChange(){this.notifyVolumeChanged(this.getVolume())}getVolume(){return void 0!==this.#e?!0===this.#e.getMediaElement().muted?0:this.#e.getMediaElement().volume:1}getName(){return"Shaka Player"}getVersion(){const e=l.library.Player.version.substring(0,32),t=e.indexOf(" ");return t>=0?e.substring(0,t):e}getBitrate(){if(void 0!==this.#e){const e=this.#e.getVariantTracks();for(let t=0;t<e.length;t++){const i=e[t];if(!0===i.active)return Math.round(i.bandwidth/1e3)}}return 0}getPosition(){return void 0!==this.#e?1e3*this.#e.getMediaElement().currentTime:0}getDuration(){return void 0===this.#e||this.#e.isLive()?0:Math.round(1e3*this.#e.getMediaElement().duration)}getCapabilities(){return{adTracking:!0}}getErrorCode(e){switch(e.category){case l.library.util.Error.Category.NETWORK:return r.x6.BPNetworkingError;case l.library.util.Error.Category.TEXT:case l.library.util.Error.Category.MEDIA:case l.library.util.Error.Category.MANIFEST:return r.x6.BPFormatNotSupportedError;case l.library.util.Error.Category.STREAMING:return r.x6.BPDecodingError;case l.library.util.Error.Category.DRM:return r.x6.BPAccessRightError;case l.library.util.Error.Category.PLAYER:case l.library.util.Error.Category.CAST:case l.library.util.Error.Category.STORAGE:default:return r.x6.BPUnspecifiedError}}setLoadingError(e){this.loadingError=e}initSessionPlayerObjects(){this.loading=!1,this.started=!1,this.bitrate=0,this.playingEventReceived=!1,this.requestedURLReceived=!1,this.redirectedURLReceived=!1,this.loadingError=void 0,void 0!==this.#e&&(void 0!==this.playerStateManager&&this.playerStateManager.stop(),this.playerStateManager=new a.A(this,this),this.playerListeners=[this.onPlayEvent.bind(this),this.onPauseEvent.bind(this),this.onBuffering.bind(this),this.onLayerSwitchEvent.bind(this),this.onErrorEvent.bind(this),this.onPlayingEvent.bind(this),this.onVariantChanged.bind(this),this.onLoadingEvent.bind(this),this.onStateChangeEvent.bind(this),this.onNetworkResponseEvent.bind(this),this.onVolumeChange.bind(this)],this.#e.getMediaElement().addEventListener("play",this.playerListeners[0]),this.#e.getMediaElement().addEventListener("pause",this.playerListeners[1]),this.#e.addEventListener("buffering",this.playerListeners[2]),this.#e.addEventListener("adaptation",this.playerListeners[3]),this.#e.addEventListener("error",this.playerListeners[4]),this.#e.getMediaElement().addEventListener("playing",this.playerListeners[5]),this.#e.addEventListener("variantchanged",this.playerListeners[6]),this.#e.addEventListener("loading",this.playerListeners[7]),this.#e.addEventListener("onstatechange",this.playerListeners[8]),this.#e.getNetworkingEngine().registerResponseFilter(this.playerListeners[9]),this.#e.getMediaElement().addEventListener("volumechange",this.playerListeners[10]))}releaseSessionPlayerObjects(){void 0!==this.playerStateManager&&(this.playerStateManager.stop(),this.playerStateManager=void 0),void 0!==this.#e&&void 0!==this.playerListeners&&this.playerListeners.length>0&&(this.#e.getMediaElement().removeEventListener("play",this.playerListeners[0]),this.#e.getMediaElement().removeEventListener("pause",this.playerListeners[1]),this.#e.removeEventListener("buffering",this.playerListeners[2]),this.#e.removeEventListener("adaptation",this.playerListeners[3]),this.#e.removeEventListener("error",this.playerListeners[4]),this.#e.getMediaElement().removeEventListener("playing",this.playerListeners[5]),this.#e.removeEventListener("variantchanged",this.playerListeners[6]),this.#e.removeEventListener("loading",this.playerListeners[7]),this.#e.removeEventListener("onstatechange",this.playerListeners[8]),this.#e.getNetworkingEngine().unregisterResponseFilter(this.playerListeners[9]),this.#e.getMediaElement().removeEventListener("volumechange",this.playerListeners[10]))}static attachLibrary(e){void 0!==e.util&&void 0!==e.Player?(r.gD.d(n,"Shaka Player library attached"),l.library=e):r.gD.e(n,"Try to attach a library, but it is not recognized")}static checkPlayer(e,t){if("undefined"!=typeof window&&void 0!==window.shaka&&(l.library=window.shaka),"function"==typeof e.getConfiguration){const t=e.getConfiguration();if(void 0!==t.manifest&&void 0!==t.streaming)return!0}return!1}attachPlayer(e,t){return!!l.checkPlayer(e,t)&&(void 0===l.library&&r.gD.e(n,"Player library not attached to the adapter, please call ShakaPlayerAdapter.attachLibrary(shaka) before attachPlayer"),this.#e=e,this.#t=t,!0)}detachPlayer(){this.releaseSessionPlayerObjects(),this.#e=void 0,this.#t=void 0}}i(8100).A.shakaModule={ShakaPlayerAdapter:l}}},function(e){return e.O(0,[153],(function(){return t=6185,e(e.s=t);var t})),e.O()}])}));