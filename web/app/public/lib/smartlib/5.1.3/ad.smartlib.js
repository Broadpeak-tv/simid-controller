"use strict";!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("adSmartLibModule",[],i):"object"==typeof exports?exports.adSmartLibModule=i():t.adSmartLibModule=i()}("undefined"!=typeof self?self:global,(function(){return(("undefined"!=typeof self?self:global).webpackChunkSmartLibModule=("undefined"!=typeof self?self:global).webpackChunkSmartLibModule||[]).push([[256],{113:function(t,i,e){var n=e(6518),r=e(9213).find,a=e(6469),s="find",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(s)},116:function(t,i,e){var n=e(6518),r=e(2652),a=e(9306),s=e(8551),o=e(1767);n({target:"Iterator",proto:!0,real:!0},{find:function(t){s(this),a(t);var i=o(this),e=0;return r(i,(function(i,n){if(t(i,e++))return n(i)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},2357:function(t,i,e){var n=e(3724),r=e(9039),a=e(9504),s=e(2787),o=e(1072),d=e(5397),u=a(e(8773).f),h=a([].push),l=n&&r((function(){var t=Object.create(null);return t[2]=2,!u(t,2)})),c=function(t){return function(i){for(var e,r=d(i),a=o(r),c=l&&null===s(r),f=a.length,v=0,p=[];f>v;)e=a[v++],n&&!(c?e in r:u(r,e))||h(p,t?[e,r[e]]:r[e]);return p}};t.exports={entries:c(!0),values:c(!1)}},2577:function(t,i,e){e(116)},2712:function(t,i,e){var n=e(6518),r=e(926).left,a=e(4598),s=e(9519);n({target:"Array",proto:!0,forced:!e(6193)&&s>79&&s<83||!a("reduce")},{reduce:function(t){var i=arguments.length;return r(this,t,i,i>1?arguments[1]:void 0)}})},5795:function(t,i,e){e.r(i),e.d(i,{AdBreakTracker:function(){return L},AdDataTracker:function(){return O},AdEventTracker:function(){return M},AdFriendlyObstructionPurpose:function(){return _.D6},AdManager:function(){return _.X2},AdMetrics:function(){return h},AdMetricsBuilder:function(){return l},AdMetricsManager:function(){return Y},AdSession:function(){return z.A},AdTracker:function(){return R},AdTrackingManager:function(){return H},AdType:function(){return _.eQ},AdViewState:function(){return _.up},InternalAdManager:function(){return Q.A},OMSDKManager:function(){return it},OMSessionHandler:function(){return ht}});e(2675),e(9463),e(2259),e(5700),e(3792),e(9572),e(2892),e(9085),e(6099),e(7764),e(2953);var n=e(4836);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function a(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function s(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function o(t,i,e){return i&&s(t.prototype,i),e&&s(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,i,e){return(i=u(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function u(t){var i=function(t,i){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,i||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==r(i)?i:i+""}var h=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;a(this,t),d(this,"adSkippable",void 0),d(this,"adSkipped",void 0),d(this,"adProgress",void 0),d(this,"adDuration",void 0),d(this,"stallsNumber",void 0),d(this,"stallsDuration",void 0),d(this,"layerSwitchesNumber",void 0),d(this,"averageBitrate",void 0),d(this,"creativeId",void 0),d(this,"adId",void 0),d(this,"adIndex",void 0),d(this,"adCount",void 0),d(this,"adFormat",void 0),d(this,"impressionDate",void 0),void 0===i?(this.adSkippable=!1,this.adSkipped=!1,this.adProgress=-1,this.adDuration=0,this.stallsNumber=0,this.stallsDuration=0,this.layerSwitchesNumber=0,this.averageBitrate=0,this.creativeId="",this.adId="",this.adIndex=-1,this.adCount=-1,this.adFormat="",this.impressionDate=-1):(this.adSkippable=i.adSkippable,this.adSkipped=i.adSkipped,this.adProgress=i.adProgress,this.adDuration=i.adDuration,this.stallsNumber=i.stallsNumber,this.stallsDuration=i.stallsDuration,this.layerSwitchesNumber=i.layerSwitchesNumber,this.averageBitrate=i.averageBitrate,this.creativeId=i.creativeId,this.adId=i.adId,this.adIndex=i.adIndex,this.adCount=i.adCount,this.adFormat=i.adFormat,this.impressionDate=i.impressionDate)}return o(t,[{key:"toString",value:function(){return"\n{ adSkippable="+this.adSkippable+"\n  adSkipped="+this.adSkipped+"\n  adProgress="+this.adProgress+"\n  adDuration="+this.adDuration+"\n  stallsNumber="+this.stallsNumber+"\n  stallsDuration="+this.stallsDuration+"\n  layerSwitchesNumber="+this.layerSwitchesNumber+"\n  averageBitrate="+this.averageBitrate+"\n  creativeId='"+this.creativeId+"'\n  adId='"+this.adId+"'\n  adIndex="+this.adIndex+"\n  adCount="+this.adCount+"\n  adFormat='"+this.adFormat+"'\n  impressionDate="+this.impressionDate+" ("+n.A.formatTime(this.impressionDate)+")\n}"}}],[{key:"merge",value:function(i){if(void 0!==i&&i.length>0){var e=new t,n=i[i.length-1];e.adSkippable=n.adSkippable,e.adSkipped=n.adSkipped,e.adProgress=n.adProgress,e.creativeId=n.creativeId,e.adId=n.adId;for(var r=0,a=0,s=0;s<i.length;s++){var o=i[s];e.adDuration+=o.adDuration,e.stallsNumber+=o.stallsNumber,e.stallsDuration+=o.stallsDuration,e.layerSwitchesNumber+=o.layerSwitchesNumber,r+=o.averageBitrate*o.adDuration,a+=o.adDuration}return 0!==a&&(e.averageBitrate=Math.round(r/a)),e}}}])}(),l=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;a(this,t),d(this,"adMetrics",void 0),d(this,"timeSpentPerLayer",void 0),d(this,"quartiles",void 0),void 0===i&&void 0===e&&void 0===n?(this.timeSpentPerLayer={},this.quartiles={},this.reset()):(this.adMetrics=i,this.timeSpentPerLayer=e,this.quartiles=n)}return o(t,[{key:"isInitialized",value:function(){return""!==this.adMetrics.adId}},{key:"import",value:function(t){return void 0!==t&&1===t.length&&t[0].impressionDate<=0&&(this.adMetrics=t[0]),this.adMetrics.impressionDate=Date.now(),this}},{key:"setAdSkippable",value:function(t){return this.adMetrics.adSkippable=t,this}},{key:"setAdSkipped",value:function(t){return this.adMetrics.adSkipped=t,this}},{key:"addProgress",value:function(t){return this.quartiles[t]=!0,this.adMetrics.adProgress=Math.max(this.adMetrics.adProgress,t),this}},{key:"init",value:function(t,i,e){return this.adMetrics.adFormat=t,this.adMetrics.adIndex=i,this.adMetrics.adCount=e,this}},{key:"setCreativeId",value:function(t){return this.adMetrics.creativeId=t,this}},{key:"setAdId",value:function(t){return this.adMetrics.adId=t,this}},{key:"addTimeSpentPerLayer",value:function(t,i){(t=Math.round(t))>0&&(void 0!==this.timeSpentPerLayer[t]?this.timeSpentPerLayer[t]+=i:this.timeSpentPerLayer[t]=i);return this}},{key:"addLayerSwitch",value:function(){return this.adMetrics.layerSwitchesNumber++,this}},{key:"addStall",value:function(t){return this.adMetrics.stallsNumber++,this.adMetrics.stallsDuration+=t,this}},{key:"reset",value:function(){return this.adMetrics=new h,this.timeSpentPerLayer={},this.quartiles={},this}},{key:"clone",value:function(){return new t(new h(this.adMetrics),Object.assign({},this.timeSpentPerLayer),Object.assign({},this.quartiles))}},{key:"build",value:function(){var t=0,i=0;for(var e in this.timeSpentPerLayer){var n=this.timeSpentPerLayer[e];t+=e*n,i+=n}return 0!==i&&(this.adMetrics.averageBitrate=Math.round(t/i)),this.adMetrics.adDuration=i,this.adMetrics}}])}(),c=(e(8980),e(6034),e(8781),e(8992),e(3949),e(3500),e(3914)),f=e(8140),v=(e(2008),e(113),e(4423),e(5276),e(2062),e(6910),e(4554),e(1699),e(4520),e(2577),e(1454),e(977)),p=e(2913);e(2712),e(4782),e(3110),e(3851),e(875),e(825),e(888),e(5472),e(8872);function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function y(t,i,e){return i=b(i),function(t,i){if(i&&("object"==k(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,g()?Reflect.construct(i,e||[],b(t).constructor):i.apply(t,e))}function g(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(g=function(){return!!t})()}function A(){return A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,e){var n=function(t,i){for(;!{}.hasOwnProperty.call(t,i)&&null!==(t=b(t)););return t}(t,i);if(n){var r=Object.getOwnPropertyDescriptor(n,i);return r.get?r.get.call(arguments.length<3?t:e):r.value}},A.apply(null,arguments)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}function m(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),i&&S(t,i)}function S(t,i){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},S(t,i)}function P(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function D(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,I(n.key),n)}}function E(t,i,e){return i&&D(t.prototype,i),e&&D(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t,i,e){return(i=I(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function I(t){var i=function(t,i){if("object"!=k(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,i||"default");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==k(i)?i:i+""}var B="BpkAdTracker",w=function(){return E((function t(){P(this,t),T(this,"proceeded",void 0),this.proceeded={},this.prepared=!1}),[{key:"canProcess",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=void 0===this.proceeded[t];return i&&(this.proceeded[t]=Date.now()),i}},{key:"resetProcess",value:function(){this.proceeded={}}}])}(),O=function(){return E((function t(i,e,n){P(this,t),T(this,"adTrackingManager",void 0),T(this,"sessionToken",void 0),T(this,"timeReference",void 0),T(this,"adBreaks",void 0),this.adTrackingManager=i,this.sessionToken=e,this.timeReference=n,this.adBreaks=[]}),[{key:"hasRemainingAdBreaks",value:function(t){return void 0!==this.adBreaks.find((function(i){return t<i.position+i.duration}))}},{key:"resetProgression",value:function(t){this.adBreaks.forEach((function(i){return i.resetProgression(t)}))}}])}(),L=function(t){function i(t,e,n,r,a){var s;return P(this,i),T(s=y(this,i),"adData",void 0),T(s,"id",void 0),T(s,"position",void 0),T(s,"duration",void 0),T(s,"live",void 0),T(s,"ads",void 0),s.adData=t,s.id=e,s.position=n,s.duration=r,s.live=a,s.ads=[],s}return m(i,t),E(i,[{key:"resetProgression",value:function(t){t<=this.position&&this.resetProcess(),this.ads.forEach((function(i){return i.resetProgression(t)}))}},{key:"processPrepare",value:function(){var t,i=null===(t=this.adData.adTrackingManager.handler.adSession)||void 0===t?void 0:t.adEventsListener;!1===this.prepared&&void 0!==(null==i?void 0:i.onPrepareAdBreak)&&(i.onPrepareAdBreak(this.toData()),this.prepared=!0)}},{key:"processBegin",value:function(){var t;if(this.canProcess(0)){var i=this.adData.adTrackingManager;c.g.d(B,"Processing ad break begin...",i.handler.id),c.g.d(B,"Duration: "+this.duration+"ms",i.handler.id),i.notifyAdBreakData(this),i.notifyAdBreakBegin(this.adData.sessionToken);var e=null===(t=i.handler.adSession)||void 0===t?void 0:t.adEventsListener;this.processPrepare(),null==e||e.onAdBreakBegin(this.toData())}}},{key:"processEnd",value:function(){var t;if(this.canProcess(1)){var i=this.adData.adTrackingManager;c.g.d(B,"Processing ad break end...",i.handler.id),i.notifyAdBreakEnd(this.adData.sessionToken);var e=null===(t=i.handler.adSession)||void 0===t?void 0:t.adEventsListener;null==e||e.onAdBreakEnd(this.toData()),this.resetProcess(),this.prepared=!1}}},{key:"resetProcess",value:function(){var t,e,n,r,a;(t=i,e="resetProcess",n=this,a=A(b(1&(r=3)?t.prototype:t),e,n),2&r&&"function"==typeof a?function(t){return a.apply(n,t)}:a)([]),this.ads.forEach((function(t){return t.resetProcess()}))}},{key:"toData",value:function(){return{id:this.id,startPosition:this.position||0,duration:!0===this.live?-1:this.duration,ads:this.ads.map((function(t){return t.toData()})),adCount:!0===this.live?-1:this.ads.length}}}])}(w),R=function(t){function i(t,e,n,r,a,s,o,d,u,h,l,c,f){var v;return P(this,i),T(v=y(this,i),"adType",void 0),T(v,"adBreak",void 0),T(v,"index",void 0),T(v,"position",void 0),T(v,"duration",void 0),T(v,"skippablePosition",void 0),T(v,"skippable",void 0),T(v,"creativeId",void 0),T(v,"adId",void 0),T(v,"events",void 0),T(v,"clickable",void 0),T(v,"verifications",void 0),T(v,"watched",void 0),T(v,"progression",void 0),T(v,"nonLinearInfo",void 0),T(v,"errorURL",void 0),v.adType=t,v.adBreak=e,v.index=n,v.position=r,v.duration=a,v.skippable=s,v.skippablePosition=o,v.creativeId=d,v.adId=u,v.events=[],v.clickable=h,v.verifications=l,v.watched=[],v.progression=0,v.nonLinearInfo=c,v.errorURL=f,v}return m(i,t),E(i,[{key:"flatWatched",value:function(){var t=JSON.parse(JSON.stringify(this.watched)).slice(0),i=[],e=null;t=t.sort((function(t,i){return t[0]>i[0]?1:t[0]<i[0]?-1:0})),i.push(t[0]);for(var n=1;n<t.length;n++)(e=i[i.length-1])[1]<t[n][0]?i.push(t[n]):e[1]<t[n][1]&&(e[1]=t[n][1],i.pop(),i.push(e));this.watched=i}},{key:"resetProgression",value:function(t){t<=this.position&&(this.watched=[],this.progression=0,this.resetProcess()),this.events.forEach((function(i){return i.resetProgression(t)}))}},{key:"updateProgression",value:function(t,i){if(!(t>i||t<this.position||i<this.position||t>this.position+this.duration||i>this.position+this.duration)){var e=this.watched.reduce((function(t,i){return t+(i[1]-i[0])}),0)/this.duration;this.watched.push([t-this.position,i-this.position]),this.flatWatched();var n=this.watched.reduce((function(t,i){return t+(i[1]-i[0])}),0)/this.duration;this.progression=n;var r=this.adBreak.adData,a=r.adTrackingManager;e<=.25&&n>=.25&&a.notifyAdProgress(r.sessionToken,this,25),e<=.5&&n>=.5&&a.notifyAdProgress(r.sessionToken,this,50),e<=.75&&n>=.75&&a.notifyAdProgress(r.sessionToken,this,75),this.events.forEach((function(t){return t.processEvents(e,n)})),1===e&&1===n?c.g.d(B,"Ad already seen (100%)",a.handler.id):c.g.d(B,"Ad progressed from "+Math.floor(1e5*e)/1e3+"% to "+Math.floor(1e5*n)/1e3+"%",a.handler.id)}}},{key:"processPrepare",value:function(){var t,i=null===(t=this.adBreak.adData.adTrackingManager.handler.adSession)||void 0===t?void 0:t.adEventsListener;!1===this.prepared&&void 0!==(null==i?void 0:i.onPrepareAd)&&(i.onPrepareAd(this.toData(),this.adBreak.toData()),this.prepared=!0)}},{key:"processBegin",value:function(){var t;if(this.canProcess(0)){var i=this.adBreak.adData,e=i.adTrackingManager;c.g.d(B,"Processing ad begin "+this.adId+"...",e.handler.id),c.g.d(B,"Start: "+this.position+"ms",e.handler.id),c.g.d(B,"End  : "+(this.position+this.duration)+"ms",e.handler.id),c.g.d(B,"Duration: "+this.duration+"ms",e.handler.id),c.g.d(B,"Type: "+this.adType,e.handler.id),e.notifyAdData(this),e.notifyAdBegin(i.sessionToken,this),!0===this.skippable&&e.notifyAdSkippable(i.sessionToken,this.skippablePosition,this.position+this.duration,this.adBreak.position+this.adBreak.duration),e.notifyAdProgress(i.sessionToken,this,0);var n=null===(t=e.handler.adSession)||void 0===t?void 0:t.adEventsListener,r=this.toData(),a=this.adBreak.toData();this.processPrepare(),null==n||n.onAdBegin(r,a),!0===this.skippable&&(null==n||n.onAdSkippable(r,a,this.skippablePosition,this.position+this.duration,this.adBreak.position+this.adBreak.duration))}}},{key:"processEnd",value:function(){var t;if(this.canProcess(1)){var i=this.adBreak.adData,e=i.adTrackingManager;c.g.d(B,"Processing ad end "+this.adId+"...",e.handler.id),this.progression>=.95&&(this.updateProgression(this.position,this.position+this.duration),e.notifyAdProgress(i.sessionToken,this,100)),e.notifyAdEnd(i.sessionToken,this);var n=null===(t=e.handler.adSession)||void 0===t?void 0:t.adEventsListener;null==n||n.onAdEnd(this.toData(),this.adBreak.toData()),this.resetProcess(),this.prepared=!1}}},{key:"getNonLinearResources",value:function(t){return this.nonLinearInfo.filter((function(i){return""!==i[t]})).map((function(i){return{url:i[t],parameters:i.adParameters}}))}},{key:"toData",value:function(){return{adType:this.adType,index:this.index,creativeId:this.creativeId,adId:this.adId,startPosition:this.position,skipPosition:this.skippablePosition,duration:this.duration,clickURL:this.clickable.uri,nonLinearIframeResources:this.getNonLinearResources("iframeResource"),nonLinearStaticResources:this.getNonLinearResources("staticResource")}}}])}(w),M=function(t){function i(t,e,n,r,a){var s;return P(this,i),T(s=y(this,i),"ad",void 0),T(s,"type",void 0),T(s,"url",void 0),T(s,"offset",void 0),T(s,"position",void 0),T(s,"progression",void 0),s.ad=t,s.type=e,s.url=n,s.offset=r,s.position=a,s.progression=0,s.processProgression(),s}return m(i,t),E(i,[{key:"resetProgression",value:function(t){t<=this.ad.position&&this.resetProcess()}},{key:"processProgression",value:function(){switch(void 0!==this.type?this.type.toLowerCase():void 0){case void 0:this.progression=(this.position-this.ad.position)/this.ad.duration;break;case"start":this.progression=0;break;case"firstquartile":this.progression=.25;break;case"midpoint":this.progression=.5;break;case"thirdquartile":this.progression=.75;break;case"complete":this.progression=1;break;case"progress":this.progression=this.offset/this.ad.duration;break;case"impression":this.progression=0}}},{key:"processEvents",value:function(t,i){var e=this.ad.adBreak.adData.adTrackingManager;if(t<=this.progression&&this.progression<=i){if(!this.canProcess())return!1;c.g.d(B,"Processing "+(this.type||"timed event")+" ("+Math.floor(100*this.progression)+"%)...",e.handler.id),void 0!==this.url&&this.url.length>0&&(c.g.d(B,"Requesting "+this.url,e.handler.id),p.A.getInstance().adEvent(e.handler,this.url))}return!0}}])}(w),_=e(9637);function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function U(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,F(n.key),n)}}function j(t,i,e){return(i=F(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function F(t){var i=function(t,i){if("object"!=N(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,i||"default");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==N(i)?i:i+""}var x="BpkAdTrackingMgr",H=function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,"handler",void 0),j(this,"playerAdapter",void 0),j(this,"listeners",void 0),j(this,"adData",void 0),j(this,"adList",void 0),j(this,"updatePositionJob",void 0),j(this,"updateSessionJob",void 0),j(this,"started",void 0),j(this,"paused",void 0),j(this,"buffering",void 0),j(this,"lastPosition",void 0),j(this,"lastPositionBeforePause",void 0),j(this,"lastPositionAfterSeek",void 0),j(this,"firstImageDate",void 0),j(this,"currentAdTracker",void 0),j(this,"currentAdBreakTracker",void 0),j(this,"currentAdData",void 0),j(this,"currentAdBreakData",void 0),j(this,"adPalSession",void 0),j(this,"bkYouSession",void 0),j(this,"sessionToken",void 0),j(this,"baseURL",void 0),j(this,"nonce",void 0),j(this,"adPalSessionRequest",void 0),j(this,"firstFileReceived",void 0),j(this,"firstFileProceeded",void 0),j(this,"podsSentNumber",void 0),j(this,"sessionUpdateInterval",void 0),j(this,"positionHistory",void 0),this.handler=i,this.playerAdapter=e,this.listeners=[],this.adData=void 0,this.adList=[],this.updatePositionJob=void 0,this.updateSessionJob=void 0,this.started=!1,this.paused=!1,this.buffering=!1,this.lastPosition=0,this.lastPositionBeforePause=0,this.lastPositionAfterSeek=0,this.bkYouSession=!1,this.baseURL=void 0,this.nonce=void 0,this.adPalSessionRequest=void 0,this.firstFileReceived=!1,this.firstFileProceeded=!1,this.podsSentNumber=0,this.sessionUpdateInterval=t.SESSION_UPDATE_INTERVAL,this.positionHistory=[]}return i=t,e=[{key:"initBkYouSession",value:function(t,i,e,n,r){this.baseURL=t,this.sessionToken=i,this.bkYouSession=!0,void 0!==n&&(this.adPalSession=n,this.nonce=r),this.parseAdPods(e),c.g.d(x,"BkYou session initialized",this.handler.id)}},{key:"updateBkYouSession",value:function(){var t=this;if(!0!==this.handler.stopped&&!0===this.bkYouSession){c.g.d(x,"Updating ad tracking file...",this.handler.id);var i=this.baseURL,e={userAgent:this.handler.smartLib.getParameters().userAgent};p.A.getInstance().adTracking(this.handler,e,i,!0).then((function(i){if(!0!==t.handler.stopped)if(void 0!==t.updateSessionJob&&v.A.getInstance().cancel(t.updateSessionJob),i.httpStatus>=200&&i.httpStatus<300){var e;try{e=JSON.parse(i.content)}catch(i){return c.g.d(x,"Ad tracking updated file unreadable",t.handler.id),void(!0===t.firstFileReceived&&(t.updateSessionJob=v.A.getInstance().asyncDelay(t.sessionUpdateInterval,(function(){t.updateSessionJob=void 0,t.updateBkYouSession()}))))}t.firstFileReceived=!0,t.parseAdPods(e),t.isLive()?t.updateSessionJob=v.A.getInstance().asyncDelay(t.sessionUpdateInterval,(function(){t.updateSessionJob=void 0,t.updateBkYouSession()})):c.g.d(x,"Stopping ad tracking file update (VOD stream)...",t.handler.id)}else c.g.d(x,"Stopping ad tracking file update (status code "+i.httpStatus+")",t.handler.id)}))}}},{key:"fixAdBreak",value:function(t){var i;t.ads.forEach((function(e,n){var r=t.ads[n+1];void 0!==r&&r.position<e.position+e.duration&&(r.position=e.position+e.duration,r.events.filter((function(t){return t.position<r.position})).forEach((function(t){t.position=r.position}))),i=e})),void 0!==i&&(t.duration=i.position+i.duration-t.position)}},{key:"parseAdPods",value:function(i){var e=this,n=i.sessiontoken||"",r=i.timereference_ms||0,a=i.refresh_delay_ms||t.SESSION_UPDATE_INTERVAL;a>=2e3&&a<=t.SESSION_UPDATE_INTERVAL?(this.sessionUpdateInterval=a,c.g.d(x,"Setting refresh delay to "+this.sessionUpdateInterval+"ms",this.handler.id)):c.g.d(x,"Setting refresh delay to "+t.SESSION_UPDATE_INTERVAL+"ms (default value)",this.handler.id);var s=new O(this,n,r),o=i.adpods;Array.isArray(o)&&(o.forEach((function(t){var i=t.id||"",n=t.starttime_ms+r,a=t.duration_ms||0,o=t.ads,d=new L(s,i,n,a,e.isLive());Array.isArray(o)&&o.forEach((function(t,i){var e=t.starttime_ms+r,n=t.duration_ms,a=t.trackingevents,s=!0;if(Array.isArray(a)&&a.length>0&&(s=e>0&&a[0].time_ms>0||0===e),void 0!==e&&void 0!==n&&!0===s){var o,u,h,l=_.eQ.getAdType(t.adtype),c=t.skippable_ms+r||0,f=0!==c&&null!=c,v=t.creativeid||"",p=t.adid+"-"+e||"",k={uri:(null===(o=t.videoclicks)||void 0===o?void 0:o.clickthroughurl)||"",trackers:(null===(u=t.videoclicks)||void 0===u?void 0:u.clicktracking)||[],customClick:(null===(h=t.videoclicks)||void 0===h?void 0:h.customclick)||[]},y=t.adverifications||[],g=[];y.forEach((function(t){g.push({vendor:t.vendor||"",javascriptResources:t.javascriptresources||[],executableResources:t.executableresources||[],trackingEvents:t.trackingevents||[],verificationParameters:t.verificationparameters||""})}));var A=t.nonlinearinfo||[],b=[];A.forEach((function(t){b.push({staticResource:t.staticresource||"",iframeResource:t.iframeresource||"",adParameters:t.adparameters||"",trackingEvents:t.trackingevents||[]})}));var m=t.errorurl||"",S=new R(l,d,i,e,n,f,c,v,p,k,g,b,m);d.ads.push(S),Array.isArray(a)&&a.forEach((function(t){var i=t.callbackurl;if(void 0!==i){var n=t.type,a=t.offset_ms,s=t.time_ms+r||e,o=new M(S,n,i,a,s);S.events.push(o)}}))}})),d.ads.length>0&&s.adBreaks.push(d)})),s.adBreaks.forEach((function(t){e.fixAdBreak(t)})));var d=this.mergeEvents(s);this.adList=this.adData.adBreaks.map((function(t){return t.toData()})),this.notifyAdDataListener(d)}},{key:"start",value:function(){var i=this;void 0===this.updatePositionJob&&(this.updatePositionJob=v.A.getInstance().asyncDelay(t.POSITION_UPDATE_INTERVAL,(function(){i.updatePositionJob=void 0,i.onPositionUpdated(i.playerAdapter.getPosition())})))}},{key:"stop",value:function(){void 0!==this.updatePositionJob&&(c.g.d(x,"Ad tracking paused (player event)",this.handler.id),v.A.getInstance().cancel(this.updatePositionJob),this.updatePositionJob=void 0)}},{key:"isLive",value:function(){return void 0!==this.firstImageDate&&this.playerAdapter.getDuration()<=0}},{key:"mergeEvents",value:function(t){var i=this,e=!1;if(void 0===this.adData)this.adData=t,c.g.d(x,t.adBreaks.length+" ad break(s) parsed",this.handler.id),e=!0;else{var n=0,r=0;this.adData.sessionToken=t.sessionToken,this.adData.timeReference=t.timeReference;var a=t.adBreaks.map((function(t){return t.id}));this.adData.adBreaks.forEach((function(t,n,s){var o;a.includes(t.id)||(null===(o=i.currentAdTracker)||void 0===o?void 0:o.adBreak.id)===t.id||(s.splice(n,1),r++,e=!0)})),t.adBreaks.forEach((function(t,r){t.adData=i.adData;var a=i.adData.adBreaks.find((function(i){return i.id===t.id}));if(void 0!==a){t.ads.filter((function(t){return void 0===a.ads.find((function(i){return i.adId===t.adId}))})).forEach((function(t){var i=a.ads.findIndex((function(i){return i.position>t.position}));-1===i?a.ads.push(t):a.ads.splice(i,0,t),n++,e=!0}));var s=a.duration;i.fixAdBreak(a),s!==a.duration&&c.g.d(x,"Ad break "+(r+1)+"/"+i.adData.adBreaks.length+": updated duration from "+s+" to "+a.duration,i.handler.id)}else i.adData.adBreaks.push(t),n+=t.ads.length,e=!0})),c.g.d(x,this.adData.adBreaks.length+" ad break(s) in total, "+t.adBreaks.length+" ad break(s) parsed, "+n+" new ad(s), "+r+" deleted ad(s)",this.handler.id)}if(this.notifyAdsUpdated(this.adData),this.started&&!this.paused&&!this.buffering){var s=this.playerAdapter.getPosition();void 0===this.updatePositionJob&&this.adData.hasRemainingAdBreaks(s)>0&&(c.g.d(x,"Ad tracking resumed",this.handler.id),this.lastPosition=s),this.checkStart(),this.isLive()&&this.checkAdBreakEnded(s)}return e}},{key:"onPositionUpdated",value:function(i){var e=this,n=this.lastPosition!==i?this.lastPosition:i-1,r=i;if(!0===this.firstFileReceived&&!1===this.firstFileProceeded&&(this.firstFileProceeded=!0,c.g.d(x,"Processing all events since first image...",this.handler.id),void 0===this.positionHistory[this.positionHistory.length-1].end&&(this.positionHistory[this.positionHistory.length-1].end=i),this.positionHistory.forEach((function(i){c.g.d(x,"Between "+i.start+" and "+i.end,e.handler.id),e.lastPosition=i.start;for(var n=i.start;n<=i.end+t.POSITION_UPDATE_INTERVAL;n+=t.POSITION_UPDATE_INTERVAL){var r=Math.min(n,i.end);e.onPositionUpdated(r),e.lastPosition=r}})),c.g.d(x,"Tracking catch-up finished",this.handler.id)),n<r&&r-n<t.POSITION_SEEK_ERROR_DELTA){var a,s,o,d=null===(a=this.adData)||void 0===a?void 0:a.adBreaks.find((function(t){return t.position<=r&&r<t.position+t.duration})),u=null===(s=this.adData)||void 0===s?void 0:s.adBreaks.find((function(i){return i.position<=r+t.POSITION_PREPARE_DELTA&&r+t.POSITION_PREPARE_DELTA<i.position+i.duration})),h=null==d?void 0:d.ads.find((function(t){return t.position<=r&&r<t.position+t.duration})),l=null==u?void 0:u.ads.find((function(i){return i.position<=r+t.POSITION_PREPARE_DELTA&&r+t.POSITION_PREPARE_DELTA<i.position+i.duration}));if(null==u||u.processPrepare(),null==l||l.processPrepare(),void 0!==h){if(void 0===this.currentAdTracker){c.g.d(x,"Entering ad "+h.adId+"...",this.handler.id);var f=n-h.position>=t.POSITION_SEEK_ERROR_DELTA;f||(c.g.d(x,"Update position start from "+n+" to "+h.position,this.handler.id),n=h.position),this.currentAdData=h.toData(),this.currentAdBreakData=d.toData(),d.processBegin(),h.processBegin(),h.updateProgression(n,r),f&&(c.g.d(x,"Ad skipped (previous position was "+t.POSITION_SEEK_ERROR_DELTA+"ms after ad start)",this.handler.id),this.notifyAdSkipped(this.adData.sessionToken,h))}else this.currentAdTracker===h?h.updateProgression(n,r):this.currentAdTracker!==h&&(c.g.d(x,"Changing from ad "+this.currentAdTracker.adId+" to "+h.adId+"...",this.handler.id),h.adBreak.id===this.currentAdTracker.adBreak.id&&this.currentAdTracker.updateProgression(n,this.currentAdTracker.position+this.currentAdTracker.duration),this.currentAdTracker.progression<1&&(c.g.d(x,"Ad skipped (progression not complete)",this.handler.id),this.notifyAdSkipped(this.adData.sessionToken,this.currentAdTracker)),this.currentAdTracker.processEnd(),h.adBreak.id!==this.currentAdTracker.adBreak.id?(this.currentAdTracker.adBreak.processEnd(),this.currentAdData=h.toData(),this.currentAdBreakData=d.toData(),d.processBegin()):this.currentAdData=h.toData(),h.processBegin(),r-h.position>=t.POSITION_SEEK_ERROR_DELTA?(c.g.d(x,"Ad skipped (new position is "+t.POSITION_SEEK_ERROR_DELTA+"ms after ad start)",this.handler.id),this.notifyAdSkipped(this.adData.sessionToken,h)):h.updateProgression(h.position,r));this.currentAdTracker=h,this.currentAdBreakTracker=d}else void 0!==this.currentAdTracker&&(c.g.d(x,"Exiting ad "+this.currentAdTracker.adId+"...",this.handler.id),r-(this.currentAdTracker.position+this.currentAdTracker.duration)<t.POSITION_UPDATE_INTERVAL&&(r=this.currentAdTracker.position+this.currentAdTracker.duration),n>=this.currentAdTracker.position&&this.currentAdTracker.updateProgression(n,r),this.currentAdTracker.progression<1&&(c.g.d(x,"Ad skipped (progression not complete)",this.handler.id),this.notifyAdSkipped(this.adData.sessionToken,this.currentAdTracker)),this.currentAdTracker.processEnd(),void 0!==d||this.isLive()||(this.currentAdBreakTracker.processEnd(),this.currentAdBreakTracker=void 0,this.currentAdBreakData=void 0),this.currentAdTracker=void 0,this.currentAdData=void 0);this.lastPosition=i,null!==(o=this.adData)&&void 0!==o&&o.hasRemainingAdBreaks(r)?this.paused||this.buffering?c.g.d(x,"Ad tracking paused (playback paused, onPositionUpdated)",this.handler.id):this.start():c.g.d(x,"Ad tracking paused (no more event, onPositionUpdated)",this.handler.id)}else{var v;c.g.d(x,"Processing trackers from "+n+"ms to "+r+"ms, resuming tracking...",this.handler.id),null!==(v=this.adData)&&void 0!==v&&v.hasRemainingAdBreaks(r)&&(this.paused||this.buffering||this.start())}}},{key:"checkStart",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.playerAdapter.getPosition();(null===(t=this.adData)||void 0===t?void 0:t.hasRemainingAdBreaks(i))>0?this.onPositionUpdated(i):c.g.d(x,"Ad tracking paused (no more event, checkStart)",this.handler.id)}},{key:"checkAdBreakEnded",value:function(i){var e=this.lastPosition!==i?this.lastPosition:i-1,n=i;if(e<n&&n-e<t.POSITION_SEEK_ERROR_DELTA){var r,a=null===(r=this.adData)||void 0===r?void 0:r.adBreaks.find((function(t){return t.position<=n&&n<t.position+t.duration}));void 0!==this.currentAdBreakTracker&&(void 0===a?(void 0!==this.currentAdTracker&&this.currentAdTracker.position+this.currentAdTracker.duration-n<t.POSITION_SEEK_ERROR_DELTA&&(this.currentAdTracker.updateProgression(this.currentAdTracker.position,this.currentAdTracker.position+this.currentAdTracker.duration),this.currentAdTracker.processEnd(),this.currentAdTracker=void 0,this.currentAdData=void 0),this.currentAdBreakTracker.processEnd(),this.currentAdBreakTracker=void 0,this.currentAdBreakData=void 0,c.g.d(x,"Ad break end detected",this.handler.id)):c.g.d(x,"Ad break not yet ended",this.handler.id))}}},{key:"adUserInteraction",value:function(t){var i,e=this;null===(i=this.currentAdTracker)||void 0===i||null===(i=i.clickable)||void 0===i||i.trackers.forEach((function(t){c.g.d(x,"Requesting click tracker "+t.clickurl,e.handler.id),p.A.getInstance().adEvent(e.handler,t.clickurl)}))}},{key:"getCurrentAd",value:function(){return this.currentAdData}},{key:"getCurrentAdBreak",value:function(){return this.currentAdBreakData}},{key:"getPositionForBookmark",value:function(){if(this.playerAdapter.getDuration()>0){var t=this.playerAdapter.getPosition(),i=this.adList.find((function(i){return i.startPosition<t&&t<=i.startPosition+i.duration}));return void 0!==i&&(t=i.startPosition),this.adList.filter((function(i){return i.startPosition+i.duration<t})).forEach((function(i){t-=i.duration})),t}return-1}},{key:"getPositionForPlayback",value:function(t,i){for(var e,n=t,r=this.adList.sort((function(t,i){return t.startPosition-i.startPosition})),a=0;a<r.length;a++){var s=r[a];if(s.startPosition>n)break;n+=s.duration,e=s}return!0===i&&void 0!==e&&n===e.startPosition+e.duration?e.startPosition:n}},{key:"onFirstImage",value:function(t,i){var e,n=this;this.started=!0,this.paused=!1,this.buffering=!1,this.lastPosition=i,this.firstImageDate=Date.now(),this.positionHistory.push({start:i}),c.g.d(x,"Ad tracking enabled (live:"+this.isLive()+")",this.handler.id),void 0!==this.adData&&(this.adList=this.adData.adBreaks.map((function(t){return t.live=n.isLive(),t.toData()}))),this.checkStart(i),this.updateBkYouSession(),this.isLive()&&this.playerAdapter.getPosition()<12623004e5&&c.g.e(x,"The player position does not return a position as a timestamp in millis. The ad tracking might not work.",this.handler.id),null===(e=this.adPalSession)||void 0===e||e.sendPlaybackStart()}},{key:"onPause",value:function(){var t=this.playerAdapter.getPosition();this.buffering||this.firstFileProceeded||(this.positionHistory[this.positionHistory.length-1].end=t),this.paused=!0,this.stop(),this.lastPosition!==t?this.onPositionUpdated(t):c.g.d(x,"Ignoring player position "+t+", already proceeded...",this.handler.id),this.lastPosition=t,this.lastPositionBeforePause=this.lastPosition}},{key:"onResume",value:function(){this.paused=!1,this.buffering||(this.lastPosition=this.playerAdapter.getPosition(),!1===this.firstFileProceeded&&this.positionHistory.push({start:this.lastPosition}),Math.abs(this.lastPosition-this.lastPositionBeforePause)<1e3&&(c.g.d(x,"Reverting position because of bad position when resuming...",this.handler.id),this.lastPosition=this.lastPositionBeforePause,this.lastPositionBeforePause=0),this.checkStart())}},{key:"onBufferingStart",value:function(){var t=this.playerAdapter.getPosition();!1===this.buffering&&!1===this.firstFileProceeded&&(this.positionHistory[this.positionHistory.length-1].end=t),this.buffering=!0,this.stop(),this.lastPosition!==t?this.onPositionUpdated(t):c.g.d(x,"Ignoring player position "+t+", already proceeded...",this.handler.id),this.lastPosition=t}},{key:"onBufferingEnd",value:function(t){if(this.buffering=!1,!this.paused){var i=this.playerAdapter.getPosition();!1===this.firstFileProceeded&&(this.positionHistory.length>0&&void 0===this.positionHistory[this.positionHistory.length-1].end&&(this.positionHistory[this.positionHistory.length-1].end=this.lastPosition),this.positionHistory.push({start:i})),this.lastPosition!==i&&(c.g.d(x,"Position updated during buffering, period switch ?",this.handler.id),this.onPositionUpdated(i)),Math.abs(this.lastPosition-this.lastPositionAfterSeek)<1e3&&(c.g.d(x,"Reverting position because of seek...",this.handler.id),this.lastPosition=this.lastPositionAfterSeek,this.lastPositionAfterSeek=0),this.checkStart()}}},{key:"onSeek",value:function(i,e){var n,r;if(!1===this.firstFileProceeded&&!1===this.buffering&&(this.positionHistory[this.positionHistory.length-1].end=i,this.positionHistory.push({start:e})),i<this.lastPosition&&this.lastPosition-i<t.POSITION_SEEK_ERROR_DELTA&&(c.g.d(x,"Updating seek start position from "+i+" to "+this.lastPosition,this.handler.id),i=this.lastPosition),this.buffering?(this.lastPositionAfterSeek=e,r=this.lastPosition):(Math.abs(this.lastPosition-i)<t.POSITION_SEEK_ERROR_DELTA&&(this.onPositionUpdated(i),this.lastPosition=i),r=i,this.lastPositionAfterSeek=0),this.lastPosition=e,Math.abs(e-i)<t.POSITION_SEEK_ERROR_DELTA)if(e<i){var a;if(i-e<2e3)return c.g.d(x,"Ignoring seek...",this.handler.id),this.lastPosition=i,void this.onPositionUpdated(i);c.g.d(x,"Reset ad trackers with position "+e,this.handler.id),null===(a=this.adData)||void 0===a||a.resetProgression(e)}else{c.g.d(x,"Small seek detected, proceeding events from "+r+" to "+e,this.handler.id);for(var s=r;s<=e;s+=t.POSITION_UPDATE_INTERVAL){var o=Math.min(s+t.POSITION_UPDATE_INTERVAL,e);c.g.d(x,"Between "+s+" and "+o,this.handler.id),this.lastPosition=s,this.onPositionUpdated(o)}}else void 0!==this.currentAdTracker&&this.notifyAdSkipped(this.adData.sessionToken,this.currentAdTracker),this.onPositionUpdated(e),c.g.d(x,"Reset ad trackers with position "+e,this.handler.id),null===(n=this.adData)||void 0===n||n.resetProgression(e)}},{key:"onStop",value:function(t){var i;this.stop(),this.lastPosition=this.playerAdapter.getPosition(),this.onPositionUpdated(this.lastPosition),this.stop(),void 0!==this.updateSessionJob&&v.A.getInstance().cancel(this.updateSessionJob),null===(i=this.adPalSession)||void 0===i||i.sendPlaybackEnd()}},{key:"addListener",value:function(t){void 0===t||this.listeners.includes(t)||this.listeners.push(t)}},{key:"removeListener",value:function(t){var i=this.listeners.indexOf(t);-1!==i&&this.listeners.splice(i,1)}},{key:"notifyEvent",value:function(t,i,e,n,r,a){"function"==typeof t[i]&&t[i](e,n,r,a)}},{key:"notifyAdBreakData",value:function(t){var i=this;this.listeners.forEach((function(e){i.notifyEvent(e,"onAdBreakData",t)}))}},{key:"notifyAdBreakBegin",value:function(t){var i=this;this.listeners.forEach((function(e){i.notifyEvent(e,"onAdBreakBegin",t)}))}},{key:"notifyAdData",value:function(t){var i=this;this.listeners.forEach((function(e){i.notifyEvent(e,"onAdData",t)}))}},{key:"notifyAdBegin",value:function(t,i){var e,n=this;this.listeners.forEach((function(e){n.notifyEvent(e,"onAdBegin",t,i.creativeId,i.adId)})),null===(e=this.adPalSession)||void 0===e||e.sendAdImpression()}},{key:"notifyAdSkippable",value:function(t){var i=this;this.listeners.forEach((function(e){i.notifyEvent(e,"onAdSkippable",t)}))}},{key:"notifyAdProgress",value:function(t,i,e){var n=this;this.listeners.forEach((function(r){n.notifyEvent(r,"onAdProgress",t,i.creativeId,i.adId,e)}))}},{key:"notifyAdSkipped",value:function(t,i){var e=this,n=[];i.adBreak.ads.forEach((function(t){t.position>i.position&&e.lastPosition>=t.position+t.duration&&n.push(t.adId)})),this.listeners.forEach((function(r){e.notifyEvent(r,"onAdSkipped",t,i.creativeId,i.adId,n)}))}},{key:"notifyAdEnd",value:function(t,i){var e=this;this.isLive()&&(void 0!==this.updateSessionJob&&v.A.getInstance().cancel(this.updateSessionJob),this.updateBkYouSession()),this.listeners.forEach((function(n){e.notifyEvent(n,"onAdEnd",t,i.creativeId,i.adId)}))}},{key:"notifyAdBreakEnd",value:function(t){var i=this;this.listeners.forEach((function(e){i.notifyEvent(e,"onAdBreakEnd",t)}))}},{key:"notifyAdsUpdated",value:function(t){var i=this;this.listeners.forEach((function(e){i.notifyEvent(e,"onAdsUpdated",t)}))}},{key:"notifyAdDataListener",value:function(i){var e,n=this.firstImageDate||Date.now(),r=0===this.podsSentNumber&&!1===this.firstFileProceeded&&Date.now()-n<=t.POSITION_START_DELTA;c.g.d(x,"On ad data (firstData: "+r+", dataUpdated: "+i+")",this.handler.id),(!0===r||!0===i)&&(this.podsSentNumber=this.adList.length,c.g.d(x,"On ad data (length: "+this.podsSentNumber+")",this.handler.id),null===(e=this.handler.adSession)||void 0===e||null===(e=e.adDataListener)||void 0===e||e.onAdData(this.adList))}}],e&&U(i.prototype,e),n&&U(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,e,n}();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function V(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,K(n.key),n)}}function J(t,i,e){return(i=K(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function K(t){var i=function(t,i){if("object"!=C(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,i||"default");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==C(i)?i:i+""}j(H,"POSITION_UPDATE_INTERVAL",1e3),j(H,"POSITION_START_DELTA",4e3),j(H,"POSITION_SEEK_ERROR_DELTA",6e3),j(H,"POSITION_PREPARE_DELTA",3e3),j(H,"SESSION_UPDATE_INTERVAL",5e3);var q="BpkAdMetricsMgr",Y=function(){return t=function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),J(this,"handler",void 0),J(this,"timeline",void 0),J(this,"builder",void 0),J(this,"adMetrics",void 0),J(this,"firstImageDate",void 0),J(this,"lastLayerBitrate",void 0),J(this,"adBreakPlaying",void 0),J(this,"adPlaying",void 0),J(this,"adSkipped",void 0),J(this,"adLastLayerSwitchDate",void 0),J(this,"adLastBufferingStartDate",void 0),J(this,"adBreakPosition",void 0),this.handler=i,this.timeline=this.handler.sessionReport.timeline,this.builder=new l,this.adMetrics={}},(i=[{key:"onStart",value:function(){this.adMetrics={},this.adLastLayerSwitchDate=0,this.firstImageDate=0,this.lastLayerBitrate=0,this.adLastBufferingStartDate=-1,this.adBreakPlaying=!1,this.adPlaying=!1,this.adSkipped=!1,this.adBreakPosition="midroll"}},{key:"onFirstImage",value:function(t,i){this.lastLayerBitrate=t,this.adLastLayerSwitchDate=Date.now(),this.firstImageDate=Date.now()}},{key:"onLayerSwitch",value:function(t){this.adBreakPlaying&&this.firstImageDate>0&&(this.builder.addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate),this.adLastLayerSwitchDate=Date.now(),this.lastLayerBitrate!==t&&this.builder.addLayerSwitch()),this.lastLayerBitrate=t}},{key:"onBufferingStart",value:function(){this.adBreakPlaying&&(this.adLastBufferingStartDate=Date.now())}},{key:"onStallEnd",value:function(){this.adBreakPlaying&&this.adLastBufferingStartDate>=0&&this.builder.addStall(Date.now()-this.adLastBufferingStartDate),this.adLastBufferingStartDate=-1}},{key:"onRebufferingEnd",value:function(){this.adLastBufferingStartDate=-1}},{key:"onSeek",value:function(t,i){var e,r,a;this.adBreakPlaying&&(c.g.d(q,"Ad seeked from "+n.A.formatTime(t)+" to "+n.A.formatTime(i),null===(e=this.handler)||void 0===e?void 0:e.id),Math.abs(i-t)<H.POSITION_SEEK_ERROR_DELTA?c.g.d(q,"Ignoring seek < "+H.POSITION_SEEK_ERROR_DELTA+"ms",null===(r=this.handler)||void 0===r?void 0:r.id):(c.g.d(q,"Ad skipped (above seek threshold)",null===(a=this.handler)||void 0===a?void 0:a.id),this.adSkipped=!0))}},{key:"onStop",value:function(t){this.adBreakPlaying&&(this.handleAdEnd(),this.adBreakPlaying=!1)}},{key:"onAdBreakData",value:function(t){var i,e,n;Math.abs(t.position+t.duration-(null===(i=this.handler.playerAdapter)||void 0===i?void 0:i.getDuration()))<1e4?this.adBreakPosition="postroll":Date.now()-this.firstImageDate<H.POSITION_START_DELTA?this.adBreakPosition="preroll":this.adBreakPosition="midroll",c.g.d(q,"Ad break position is "+this.adBreakPosition,null===(e=this.handler)||void 0===e?void 0:e.id),this.adBreakPlaying=!0,void 0!==this.timeline&&this.timeline.pushEvent(null===(n=f.A.analyticsModule)||void 0===n?void 0:n.SessionTrackerEvents.AdBreakStart)}},{key:"onAdData",value:function(t){this.builder.isInitialized()&&this.adSkipped&&this.handleAdEnd();var i=!0===t.adBreak.live?-1:t.adBreak.ads.length;this.builder.reset().import(this.adMetrics[t.adId]).setCreativeId(t.creativeId).setAdId(t.adId).init(this.adBreakPosition,t.index,i),this.adSkipped=!1,this.adLastLayerSwitchDate=Date.now(),this.adPlaying=!0}},{key:"onAdSkippable",value:function(t){this.builder.setAdSkippable(!0)}},{key:"onAdSkipped",value:function(t,i,e,n){var r=this;if(this.adSkipped=!0,n.length>0){var a;c.g.d(q,"Ad break skipped",null===(a=this.handler)||void 0===a?void 0:a.id);var s=1;n.forEach((function(t){r.adMetrics[t].forEach((function(t){if(t.impressionDate<=0){t.adSkipped=!0,t.adProgress=0,t.impressionDate=Date.now();var i=r.builder.adMetrics;t.adIndex=i.adIndex+s,t.adCount=i.adCount,t.adFormat=i.adFormat,s++}}))}))}}},{key:"onAdProgress",value:function(t,i,e,n){var r;this.builder.addProgress(n),n>0&&void 0===this.builder.quartiles[n-25]&&(c.g.d(q,"Ad skipped (no previous progress)",null===(r=this.handler)||void 0===r?void 0:r.id),this.adSkipped=!0)}},{key:"onAdEnd",value:function(t,i,e){this.handleAdEnd(),this.adPlaying=!1}},{key:"onAdBreakEnd",value:function(t){var i;!0===this.adPlaying&&(this.builder.setAdSkipped(!0),this.handleAdEnd()),this.adBreakPlaying=!1,void 0!==this.timeline&&this.timeline.pushEventProgress(null===(i=f.A.analyticsModule)||void 0===i?void 0:i.SessionTrackerEvents.AdBreakStop,0)}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(t){if(this.adBreakPlaying){var i=this.builder.clone().addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);this.adLastBufferingStartDate>=0&&i.addStall(Date.now()-this.adLastBufferingStartDate);var e=i.build();e.adId.length>0&&this.storeMetrics(e)}t.adMetrics=this.generateMetrics()}},{key:"onEndSessionReportUpdateRequested",value:function(t){t.adMetrics=this.generateMetrics()}},{key:"storeMetrics",value:function(t){var i=t.adId;void 0===this.adMetrics[i]&&(this.adMetrics[i]=[]);var e=this.adMetrics[i].findIndex((function(i){return i.impressionDate===t.impressionDate}));-1===e?this.adMetrics[i].push(t):this.adMetrics[i][e]=t}},{key:"generateMetrics",value:function(){var t=[];return Object.values(this.adMetrics).forEach((function(i){i.forEach((function(i){return t.push(i)}))})),t}},{key:"handleAdEnd",value:function(){var t;this.builder.setAdSkipped(this.adSkipped).addTimeSpentPerLayer(this.lastLayerBitrate,Date.now()-this.adLastLayerSwitchDate);var i=this.builder.build();i.adId.length>0&&this.storeMetrics(i),c.g.d(q,"Ad metrics : "+i.toString(),null===(t=this.handler)||void 0===t?void 0:t.id),this.builder.reset(),this.adSkipped=!1}},{key:"onAdsUpdated",value:function(t){var i=this;t.adBreaks.forEach((function(t){t.ads.forEach((function(t){if(void 0===i.adMetrics[t.adId]){var e,n=(new l).setCreativeId(t.creativeId).setAdId(t.adId).build();i.adMetrics[t.adId]=[n],c.g.d(q,"Adding ad metrics report for ad id "+t.adId,null===(e=i.handler)||void 0===e?void 0:e.id)}}))}))}}])&&V(t.prototype,i),e&&V(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,e}(),z=e(1942),Q=e(6578);function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function X(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function $(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Z(n.key),n)}}function G(t,i,e){return i&&$(t.prototype,i),e&&$(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Z(t){var i=function(t,i){if("object"!=W(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,i||"default");if("object"!=W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==W(i)?i:i+""}var tt="BpkOMSDKMgr",it=function(){function t(){var i,e,n;X(this,t),i=this,n=void 0,(e=Z(e="smartLib"))in i?Object.defineProperty(i,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[e]=n}return G(t,[{key:"init",value:function(){c.g.d(tt,"Initializing OM SDK manager...")}},{key:"release",value:function(){}},{key:"attachInstance",value:function(t){this.smartLib=t}},{key:"attachHandler",value:function(t){c.g.d(tt,"Attaching OM SDK handler..."),this.omsdkHandler=t}},{key:"isEnabled",value:function(){return void 0!==this.omsdkHandler&&null!==this.omsdkHandler}}],[{key:"getInstance",value:function(){return et._||(et._=new t),et._}}])}(),et={_:void 0};e(3418),e(7495),e(906);function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function rt(t){return function(t){if(Array.isArray(t))return at(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,i){if(t){if("string"==typeof t)return at(t,i);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?at(t,i):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function at(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=Array(i);e<i;e++)n[e]=t[e];return n}function st(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dt(n.key),n)}}function ot(t,i,e){return(i=dt(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function dt(t){var i=function(t,i){if("object"!=nt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,i||"default");if("object"!=nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==nt(i)?i:i+""}var ut="BpkOMSessionHandler",ht=function(){return t=function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),ot(this,"handler",void 0),ot(this,"adSession",void 0),ot(this,"playerAdapter",void 0),ot(this,"internalAdManager",void 0),ot(this,"omsdkHandler",void 0),ot(this,"omAdSession",void 0),ot(this,"firstImageDate",void 0),ot(this,"adBreakPosition",void 0),ot(this,"pause",void 0),ot(this,"buffering",void 0),this.handler=i,this.adSession=i.adSession,this.playerAdapter=e,this.internalAdManager=this.handler.smartLib.internalAdManager,this.omsdkHandler=it.getInstance().omsdkHandler,this.firstImageDate=0,this.adBreakPosition="midroll",this.pause=!1,this.buffering=!1},(i=[{key:"onStart",value:function(){}},{key:"onRedirectionEnd",value:function(){}},{key:"onFirstImage",value:function(t,i){this.firstImageDate=Date.now()}},{key:"onLayerSwitch",value:function(t){}},{key:"onPause",value:function(){var t;!1===this.pause&&(null===(t=this.omAdSession)||void 0===t||t.pause()),this.pause=!0}},{key:"onResume",value:function(){var t;!0===this.pause&&(null===(t=this.omAdSession)||void 0===t||t.resume()),this.pause=!1}},{key:"onBufferingStart",value:function(){var t;!1===this.buffering&&(null===(t=this.omAdSession)||void 0===t||t.bufferStart()),this.buffering=!0}},{key:"onBufferingEnd",value:function(t){var i;!0===this.buffering&&(null===(i=this.omAdSession)||void 0===i||i.bufferFinish()),this.buffering=!1}},{key:"onStallEnd",value:function(){}},{key:"onRebufferingEnd",value:function(){}},{key:"onSeek",value:function(t,i){var e;void 0!==this.adData&&Math.abs(i-t)>=1e3&&(i>=this.adData.position+this.adData.duration||i<this.adData.position)&&(null===(e=this.omAdSession)||void 0===e||e.skipped())}},{key:"onStop",value:function(t){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onStartSessionReportUpdateRequested",value:function(t){}},{key:"onKeepaliveSessionReportUpdateRequested",value:function(t){}},{key:"onEndSessionReportUpdateRequested",value:function(t){}},{key:"onAdBreakData",value:function(t){Math.abs(t.position+t.duration-this.playerAdapter.getDuration())<1e4?this.adBreakPosition="postroll":Date.now()-this.firstImageDate<H.POSITION_START_DELTA?this.adBreakPosition="preroll":this.adBreakPosition="midroll",c.g.d(ut,"Ad break position is "+this.adBreakPosition,this.handler.id)}},{key:"onPrepareAdBreak",value:function(t){}},{key:"onAdBreakBegin",value:function(t){}},{key:"startAdSession",value:function(t,i){var e,n,r,a=this;this.omAdSession=t,void 0!==(null===(e=this.adSession)||void 0===e?void 0:e.adView)&&this.omAdSession.setAdView(this.adSession.adView),(null===(n=this.adSession)||void 0===n?void 0:n.adFriendlyObstructionViews.length)>0&&this.adSession.adFriendlyObstructionViews.forEach((function(t){a.omAdSession.registerAdFriendlyObstructionView(t.view,t.purpose,t.reason)})),this.omAdSession.start(),void 0!==(null===(r=this.adSession)||void 0===r?void 0:r.adViewState)&&this.omAdSession.setAdViewState(this.adSession.adViewState),!0===i.skippable?this.omAdSession.loaded(i.skippablePosition-i.position,i.duration,this.adBreakPosition,this.playerAdapter.getVolume()):this.omAdSession.loaded(-1,i.duration,this.adBreakPosition,this.playerAdapter.getVolume()),c.g.d(ut,"OM ad session loaded",this.handler.id)}},{key:"onAdData",value:function(t){var i,e,n,r,a=this;void 0!==this.adData&&(null===(n=this.omAdSession)||void 0===n||n.finish(),this.omAdSession=void 0),this.adData=t,r=void 0!==(null===(i=this.adSession)||void 0===i?void 0:i.adVerificationData)?rt(this.adSession.adVerificationData):[],this.adData.verifications.forEach((function(t){var i=t.javascriptResources.find((function(t){return"omid"===t.apiframework}));r.push({verificationVendor:t.vendor,verificationURL:i.url,verificationParameters:t.verificationParameters})}));var s=this.omsdkHandler.createOMAdSession(this.internalAdManager.omPartnerName,this.internalAdManager.omPartnerVersion,null===(e=this.adSession)||void 0===e?void 0:e.adCustomReference,r,(function(i){a.startAdSession(i,t)}));void 0!==s&&this.startAdSession(s,t)}},{key:"onPrepareAd",value:function(t,i,e){}},{key:"onAdBegin",value:function(t,i,e){}},{key:"onAdSkippable",value:function(t){}},{key:"onAdProgress",value:function(t,i,e,n){var r;null===(r=this.omAdSession)||void 0===r||r.progress(n)}},{key:"onAdEnd",value:function(t,i,e){var n;this.adData=void 0,null===(n=this.omAdSession)||void 0===n||n.finish(),this.omAdSession=void 0}},{key:"onAdBreakEnd",value:function(t){this.adData=void 0,void 0!==this.omAdSession&&(this.omAdSession.finish(),this.omAdSession=void 0),this.adBreakPosition="midroll"}},{key:"onVolumeChanged",value:function(t){var i;c.g.d(ut,"Volume is now "+t,this.handler.id),null===(i=this.omAdSession)||void 0===i||i.volumeChange(t)}},{key:"onPlayerError",value:function(t,i){var e;c.g.e(ut,"Broadpeak status code "+t,this.handler.id),c.g.e(ut,"Player error code "+i,this.handler.id),null===(e=this.omAdSession)||void 0===e||e.error(t,i)}}])&&st(t.prototype,i),e&&st(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,e}();f.A.adModule={AdMetrics:h,AdMetricsBuilder:l,AdMetricsManager:Y,AdTrackingManager:H,AdDataTracker:O,AdBreakTracker:L,AdTracker:R,AdEventTracker:M,AdManager:_.X2,AdViewState:_.up,AdFriendlyObstructionPurpose:_.D6,AdType:_.eQ,AdSession:z.A,InternalAdManager:Q.A,OMSDKManager:it,OMSessionHandler:ht}},6034:function(t,i,e){var n=e(6518),r=e(2357).values;n({target:"Object",stat:!0},{values:function(t){return r(t)}})},8237:function(t,i,e){var n=e(6518),r=e(2652),a=e(9306),s=e(8551),o=e(1767),d=TypeError;n({target:"Iterator",proto:!0,real:!0},{reduce:function(t){s(this),a(t);var i=o(this),e=arguments.length<2,n=e?void 0:arguments[1],u=0;if(r(i,(function(i){e?(e=!1,n=i):n=t(n,i,u),u++}),{IS_RECORD:!0}),e)throw new d("Reduce of empty iterator with no initial value");return n}})},8872:function(t,i,e){e(8237)},8980:function(t,i,e){var n=e(6518),r=e(9213).findIndex,a=e(6469),s="findIndex",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(s)}},function(t){return t.O(0,[153],(function(){return i=5795,t(t.s=i);var i})),t.O()}])}));