!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("baseSmartLibModule",[],t):"object"==typeof exports?exports.baseSmartLibModule=t():e.baseSmartLibModule=t()}("undefined"!=typeof self?self:global,(function(){return function(){"use strict";var __webpack_modules__={828:function(e,t,s){s.d(t,{f:function(){return E}});var i=s(5690),a=s(8379),n=s(7832),r=s(3121),o=s(2765),d=s(5941),l=s(4943),c=s(1105),h=s(1142);const u="BpkStreamingSession";class E{smartLib;options;customParameters;diversitySession;adSession;id;date;handler;playerAdapter;simidControllerAdapter;stopped;multicastStatusListener;constructor(e,t){this.smartLib=e,this.options=t,this.customParameters={},this.id=l.A.randomIntFromInterval(1e4,99999),this.date=Date.now(),this.stopped=!1}attachPlayer(e,t){void 0!==e?void 0===this.handler?(this.playerAdapter=e,a.g.i(u,"Player "+this.playerAdapter.getName()+" attached",this.id)):a.g.e(u,"Exception: attachPlayer error, you cannot attach a player when a session is running.",this.id):void 0===h.A.analyticsModule?a.g.w(u,"Try to attach a player, but analytics module not loaded",this.id):a.g.w(u,"Try to attach a player, but it is not recognized",this.id)}attachSimidController(e){void 0!==e?void 0===this.handler?(this.simidControllerAdapter=e,a.g.i(u,"SIMID Controller "+this.simidControllerAdapter.getName()+" attached",this.id)):a.g.e(u,"Exception: attachSimidController error, you cannot attach a player when a session is running.",this.id):void 0===h.A.simidModule||void 0===h.A.adModule?a.g.w(u,"Try to attach a SIMID controller, but need simid and ad modules",this.id):a.g.w(u,"Try to attach a SIMID controller, but it is not recognized",this.id)}setOption(e,t){void 0===this.handler?(a.g.d(u,"Setting session option "+n.H.optionToString(e)+" to "+n.H.valueToString(e,t),this.id),this.options.set(e,t)):a.g.e(u,"Exception: setOption error, you cannot set an option when a session is running.",this.id)}setAdEventsListener(e){void 0===this.adSession&&(this.adSession=new c.A),this.adSession.setAdEventsListener(e)}setAdDataListener(e){void 0===this.adSession&&(this.adSession=new c.A),this.adSession.setAdDataListener(e)}activateDiversity(e){void 0!==h.A.diversityModule.DiversitySession?void 0===this.diversitySession&&(this.diversitySession=new h.A.diversityModule.DiversitySession,this.diversitySession.activate(e)):a.g.e(u,"Diversity module not loaded, please import it",this.id)}activateAdvertising(){void 0===this.adSession&&(this.adSession=new c.A),this.adSession.activateAdvertising()}setAdParameter(e,t){void 0===this.adSession&&(this.adSession=new c.A),this.adSession.setAdParameter(e,t)}setAdView(e){void 0===this.adSession&&(this.adSession=new c.A),this.adSession.adView=e,this.handler?.omSessionHandler?.omAdSession?.setAdView(e)}setAdViewState(e){void 0===this.adSession&&(this.adSession=new c.A),!0===i.up.isAdViewState(e)?(this.adSession.adViewState=e,this.handler?.omSessionHandler?.omAdSession?.setAdViewState(e)):a.g.e(u,"Please use a defined state within the AdViewState enum.",this.id)}registerAdFriendlyObstructionView(e,t,s){void 0===this.adSession&&(this.adSession=new c.A),i.D6.isAdFriendlyObstructionPurpose(t)&&"string"==typeof s?(this.adSession.adFriendlyObstructionViews.push({view:e,purpose:t,reason:s}),this.handler?.omSessionHandler?.omAdSession?.registerAdFriendlyObstructionView(e,t,s)):a.g.e(u,"Ad friendly objection view not registered, please check arguments types: purpose -> state within the AdFriendlyObstructionPurpose enum, reason -> string",this.id)}unregisterFriendlyObstruction(e){void 0!==this.adSession&&(this.adSession.adFriendlyObstructionViews=this.adSession.adFriendlyObstructionViews.filter((t=>t.view!==e)),this.handler?.omSessionHandler?.omAdSession?.unregisterFriendlyObstruction(e))}unregisterAllFriendlyObstructions(){void 0!==this.adSession&&(this.adSession.adFriendlyObstructionViews=[],this.handler?.omSessionHandler?.omAdSession?.unregisterAllFriendlyObstructions())}setAdCustomReference(e){void 0===this.adSession&&(this.adSession=new c.A),"string"==typeof e?(this.adSession.adCustomReference=e,void 0!==this.handler?.omSessionHandler?.omAdSession&&a.g.w(u,'An ad is already playing, the ad custom reference "'+e+'" will be set for the next ad',this.id)):a.g.e(u,"Ad custom reference not set, reference argument has to be a string",this.id)}registerAdVerificationData(e,t=void 0,s=void 0){void 0===this.adSession&&(this.adSession=new c.A);const i={verificationVendor:t,verificationURL:e,verificationParameters:s};this.adSession.adVerificationData.push(i),void 0!==this.handler?.omSessionHandler?.omAdSession&&a.g.w(u,'An ad is already playing, the ad verification data "'+JSON.stringify(i)+'" will be set for the next ad',this.id)}adUserInteraction(e){void 0===this.adSession&&(this.adSession=new c.A),"string"==typeof e?(a.g.d(u,"Ad interaction: "+e,this.id),this.handler?.adTrackingManager?.adUserInteraction(e),this.adSession.adPalSession?.sendAdClick(),void 0!==this.handler?.omSessionHandler?.omAdSession&&this.handler.omSessionHandler.omAdSession.adUserInteraction(e)):a.g.e(u,"Ad interaction type not triggered, interactionType argument has to be a string",this.id)}adTouch(e){void 0===this.adSession&&(this.adSession=new c.A),a.g.d(u,"Ad touch",this.id),this.adSession.adPalSession?.sendTouch(e)}setCustomParameter(e,t){"string"==typeof e?this.customParameters[e]=d.A.toBkAString(String(t)):a.g.e(u,"Error: Only string values are accepted for custom parameters",this.id)}setEventCallbackEnabled(e){void 0===this.adSession&&(this.adSession=new c.A),this.adSession.setEventCallbackEnabled(e)}getURL(e){return a.g.i(u,"getURL with "+e,this.id),void 0===this.handler?d.A.typeParameter(e,"string","Error: requestedURL should be a string")&&d.A.stringNonEmpty(e,"Error: requestedURL is empty")?(this.handler=this.smartLib.sessionManager.createSessionHandler(this),this.handler.diversitySession=this.diversitySession,void 0!==this.diversitySession&&(this.diversitySession.handler=this.handler),this.handler.adSession=this.adSession,void 0!==this.adSession&&(this.handler.simidControllerAdapter=this.simidControllerAdapter,this.adSession.handler=this.handler),this.handler.start(e)):Promise.resolve(r.S.error(r.S.RESULT_API_PARAMETER_FORMAT_ERROR)):(a.g.e(u,"Exception: getURL error, the session is already running.",this.id),Promise.resolve(r.S.error(r.S.RESULT_REQUEST_ALREADY_DONE)))}getQuery(){return a.g.i(u,"getQuery",this.id),void 0===this.handler?(this.handler=this.smartLib.sessionManager.createProxySessionHandler(this),this.handler.getQuery()):(a.g.e(u,"Exception: getQuery error, the session is already running.",this.id),"")}precacheEnded(){this.handler?.notifyPrecacheEnded()}startStreamingSession(e,t){return a.g.i(u,"startStreamingSession with "+e+" and "+t,this.id),!(!d.A.typeParameter(e,"string","Error: requestedURL should be a string")||!d.A.typeParameter(t,"string","Error: redirectedURL should be a string"))&&(void 0===this.handler?(a.g.e(u,"Exception: startSteamingSession error, getQuery() should be called prior to startStreamingSession(...)"),!1):this.handler instanceof o.A?(this.handler.start(e,t),!0):(a.g.e(u,"Exception: startSteamingSession error, startStreamingSession(...) cannot be called once getURL(...) has been called"),!1))}stopStreamingSession(e){return void 0!==e?a.g.i(u,"Stopping streaming session with statusCode "+e+"...",this.id):a.g.i(u,"Stopping streaming session...",this.id),void 0!==this.handler&&this.handler.stop(e),void 0!==this.playerAdapter&&this.playerAdapter.detachPlayer(),void 0!==this.simidControllerAdapter&&this.simidControllerAdapter.detachSimidController(),this.stopped=!0,this.handler}isNanoCDNUsed(){return void 0!==this.handler&&this.handler.isNanoCDNUsed()}getVideoMulticastStatus(){return void 0!==this.handler?this.handler.videoMulticastStatus:n.H.MULTICAST_INACTIVE}getAudioMulticastStatus(){return void 0!==this.handler?this.handler.audioMulticastStatus:n.H.MULTICAST_INACTIVE}getDataMulticastStatus(){return void 0!==this.handler?this.handler.dataMulticastStatus:n.H.MULTICAST_INACTIVE}setMulticastStatusListener(e){a.g.d(u,"Multicast status listener "+(void 0!==e?"set":"unset"),this.id),this.multicastStatusListener=e}getAdList(){return this.handler?.adTrackingManager?.adList||[]}getCurrentAd(){return this.handler?.adTrackingManager?.getCurrentAd()}getCurrentAdBreak(){return this.handler?.adTrackingManager?.getCurrentAdBreak()}getPositionForBookmark(){const e=this.handler?.adTrackingManager?.getPositionForBookmark();return void 0!==e?e:-1}getPositionForPlayback(e,t=!1){const s=this.handler?.adTrackingManager?.getPositionForPlayback(Number(e),t);return void 0!==s?s:-1}}},1105:function(e,t,s){s.d(t,{A:function(){return r}});var i=s(8379),a=s(5690);const n="BpkAdSession";class r{handler;adEventsListener;adDataListener;adActivated;adParameters;eventCallbackEnabled;adView;adViewState;adFriendlyObstructionViews;adCustomReference;adVerificationData;adPalSession;constructor(){this.adEventsListener=void 0,this.adActivated=!1,this.adParameters={},this.eventCallbackEnabled=!0,this.adView=void 0,this.adViewState=a.up.NORMAL,this.adFriendlyObstructionViews=[],this.adCustomReference="",this.adVerificationData=[]}setAdEventsListener(e){this.adEventsListener=e,i.g.d(n,"Ad events listener "+(void 0!==e?"set":"unset"),this.handler?.id)}setAdDataListener(e){this.adDataListener=e,i.g.d(n,"Ad data listener "+(void 0!==e?"set":"unset"),this.handler?.id)}activateAdvertising(){!0!==this.adActivated&&(this.adActivated=!0,i.g.d(n,"Ad session activated",this.handler?.id))}setAdParameter(e,t){this.activateAdvertising(),this.adParameters[e]=String(t),i.g.d(n,"Adding parameter "+e+"="+t,this.handler?.id)}setEventCallbackEnabled(e){this.eventCallbackEnabled=e}isAdActivated(){return!0===this.adActivated}getAdAllowedQuery(){const e=["ad_allowed","adallowed"],t=["0","false"];let s=!0;return Object.keys(this.adParameters).forEach((i=>{e.indexOf(i.toLowerCase())>=0&&t.indexOf(this.adParameters[i].toLowerCase())>=0&&(s=!1)})),s}resetAdParameters(){this.adParameters={}}hasAdParameters(){return Object.keys(this.adParameters).length>0}onDashEvent(e){this.isAdActivated()?this.eventCallbackEnabled?i.g.d(n,"Event received but legacy mode has been deprecated",this.handler.id):i.g.d(n,"Event received but callbacks are disabled",this.handler.id):i.g.d(n,"Event received but ad not enabled (advertising not activated)",this.handler.id)}}},1134:function(e,t,s){s.d(t,{A:function(){return o}});var i=s(4943),a=s(1262),n=s(6506);const r="BpkJobMgr";class o{static#e;worker;jobs;static getInstance(){return o.#e||(o.#e=new o),o.#e}constructor(){this.jobs={}}async(e,t,s,i){return this.start(e,0,-1,t,s,i)}asyncGet(e,t,s,i){return this.start("get",0,-1,(()=>{n.A.getInstance().requestHandler.get(e,t,s,i)}),(()=>({url:e,headers:t,timeout:s})),i)}asyncPost(e,t,s,i,a){return this.start("post",0,-1,(()=>{n.A.getInstance().requestHandler.post(e,t,s,i,a)}),(()=>({url:e,headers:t,body:s,timeout:i})),a)}asyncDelay(e,t){let s;const i=this.start("delay",e,-1,(t=>{s=setTimeout(t,e)}),void 0,t);return i.task=s,i}asyncDelayPromise(e){return new Promise(((t,s)=>{o.getInstance().asyncDelay(e,(()=>{t()}))}))}asyncNonce(e,t,s,i=void 0){let n;void 0===i&&(i=()=>{a.gD.d(r,"ios async nonce"),n=setTimeout(s,e)});const o=this.start("waitNonce",0,e,i,void 0,t,s,!0);return o.task=n,o}waitNonce(e,t,s,i=void 0){let n;void 0===i&&(i=()=>{a.gD.d(r,"ios wait nonce"),n=setTimeout(s,e)});const o=this.start("waitNonce",0,e,i,void 0,t,s,!1);return o.task=n,o}start(e,t,s,i,n,o,d=()=>{},l=!0){if(void 0===this.worker&&("function"==typeof CoreWorker?this.worker=new CoreWorker:"object"==typeof CoreWorker&&(this.worker=CoreWorker)),void 0!==this.worker){const i=this.createJob();return i.active=!0,i.command=e,i.startDelay=t,i.timeoutDelay=s,i.requestInfo=n,i.result=o,i.timeout=d,i.async=l,a.gD.v(r,'Starting job "'+e+'" (id: '+i.id+", async: "+i.async+")..."),l?this.worker.async(i.id,i.command,i.startDelay,i.timeoutDelay):this.worker.sync(i.id,i.command,i.startDelay,i.timeoutDelay),i}return i(o),{command:e}}interrupt(e){void 0!==e&&void 0!==this.worker&&(a.gD.v(r,'Interrupting job "'+e.command+'"...'),this.worker.interrupt(e.id))}cancel(e){void 0!==e&&(void 0!==this.worker&&(a.gD.v(r,'Cancelling job "'+e.command+'"...'),e.active=!1,this.worker.cancel(e.id),delete this.jobs[e.id]),void 0!==e.task&&clearTimeout(e.task))}requestInfo(e){const t=this.jobs[e];return void 0!==t&&"function"==typeof t.requestInfo?t.requestInfo():{}}result(e,t){const s=this.jobs[e];void 0!==s&&"function"==typeof s.result&&!0===s.active&&(s.active=!1,s.result(t)),delete this.jobs[e]}timeout(e){const t=this.jobs[e];void 0!==t&&"function"==typeof t.timeout&&!0===t.active&&(a.gD.v(r,'Job "'+t.command+'" timeout...'),t.active=!1,t.timeout()),delete this.jobs[e]}createJob(){let e=i.A.randomIntFromInterval(1e6,9999999);for(;void 0!==this.jobs[e];)e=i.A.randomIntFromInterval(1e6,9999999);return this.jobs[e]={id:e},this.jobs[e]}}},1142:function(e,t,s){s.d(t,{A:function(){return R}});var i=s(8379),a=s(6506),n=s(5866),r=s(5941),o=s(8724),d=s(2765),l=s(7832),c=s(828),h=s(1262),u=s(4943);const E="BpkSessionMgr";class g{static UNSTARTED_SESSION_MAX_DURATION=36e4;smartLib;sessions;init(e){this.smartLib=e,this.sessions=[]}createStreamingSession(e=void 0,t=void 0){this.cleanFinishedSessions();const s=new c.f(this.smartLib,l.H.create(e,t));return this.sessions.push(s),this.sessions.length>10&&h.gD.w(E,"There are "+this.sessions.length+" active sessions. Use session.stopStreamingSession() to free up memory."),s}createAnalyticsSession(e=void 0,t=void 0){this.cleanFinishedSessions();const s=new R.analyticsModule.AnalyticsSession(this.smartLib,l.H.create(e,t));return this.sessions.push(s),this.sessions.length>10&&h.gD.w(E,"There are "+this.sessions.length+" active sessions. Use session.stopStreamingSession() to free up memory."),s}cleanFinishedSessions(){for(let e=this.sessions.length-1;e>=0;e--){let t=this.sessions[e];void 0===t.handler&&Date.now()-t.date>g.UNSTARTED_SESSION_MAX_DURATION?(t.playerAdapter?.detachPlayer(),t.simidControllerAdapter?.detachSimidController(),this.sessions.splice(e,1)):(!0===t.handler?.stopped||!0===t.stopped)&&this.sessions.splice(e,1)}}createSessionHandler(e=void 0){const t=new o.A(this.smartLib,e);return void 0!==e?(t.id=e.id,t.options=e.options,t.playerAdapter=e.playerAdapter):(t.id="main-"+u.A.randomIntFromInterval(10,99),t.options=new l.H),t}createProxySessionHandler(e=void 0){const t=new d.A(this.smartLib,e);return void 0!==e?(t.id=e.id,t.options=e.options,t.playerAdapter=e.playerAdapter):(t.id="main-"+u.A.randomIntFromInterval(10,99),t.options=new l.H),t}release(){this.cleanFinishedSessions(),this.sessions.forEach((e=>{void 0!==R.analyticsModule&&e instanceof R.analyticsModule.AnalyticsSession?e.stopAnalyticsSession():e.stopStreamingSession()})),this.sessions=[]}}var S=s(3473),p=s(5690),_=s(5305),A=s(1105);const N="BpkSmartLib";class R{static#e;static FORCE_TEARDOWN_DISABLED=-1;static FORCE_TEARDOWN_DEFAULT=0;static FORCE_TEARDOWN_ENABLED=1;static BPSessionEndsNormally=200;static BPFormatNotSupportedError=3001;static BPDecodingError=3002;static BPNetworkingError=3003;static BPAccessRightError=3004;static BPUnspecifiedError=3005;static analyticsModule;static adModule;static nanoCDNModule;static diversityModule;static monitoringModule;#t;#s;#i;options;sessionManager;nanoCDNHostManager;adManager;internalAdManager;monitoringManager;handler;nanoCDNReceiver;nanoCDNHttpsEnabled;static getInstance(){return R.#e||(R.#e=new R),R.#e}constructor(){this.#t=!1,this.#s=!1,this.#i={analyticsAddress:"",nanoCDNHost:"",broadpeakDomainNames:"",forceTeardown:R.FORCE_TEARDOWN_DEFAULT,uuid:"",userAgent:void 0,deviceType:"",customParameters:{}},this.options=new l.H,this.sessionManager=new g,this.adManager=new p.X2,this.internalAdManager=new _.A}init(e,t,s,o){return i.g.i(N,"Init SmartLib..."),i.g.i(N,"Version: "+n.A),this.#t||this.#s?(i.g.e(N,"Error: SmartLib already initialized, please use SmartLib.release() before initializing."),!1):void 0!==o?(i.g.e(N,"Error: this init method has been removed, please use SmartLib.init(analyticsAddress, nanoCDNHost, broadpeakDomainNames) instead."),!1):r.A.typeOrNullParameter(e,"string","Error: analyticsAddress should be a string or null")&&r.A.typeOrNullParameter(t,"string","Error: nanoCDNHost should be a string or null")&&r.A.typeOrNullParameter(s,"string","Error: broadpeakDomainNames should be a string or null")?(this.#a(e),this.#n(t),this.#r(s),this.setForceTeardown(R.FORCE_TEARDOWN_DEFAULT),i.g.i(N,"Parameters:analyticsAddress="+e+", nanoCDNHost="+t+", broadpeakDomainNames="+s),void 0!==R.nanoCDNModule&&void 0===this.nanoCDNHostManager&&(this.nanoCDNHostManager=new R.nanoCDNModule.NanoCDNHostManager,void 0!==this.nanoCDNReceiver&&(this.nanoCDNHostManager.registerNanoCDNReceiver(this.nanoCDNReceiver),this.nanoCDNReceiver=void 0),void 0!==this.nanoCDNHttpsEnabled&&(this.nanoCDNHostManager.setNanoCDNHttpsEnabled(this.nanoCDNHttpsEnabled),this.nanoCDNHttpsEnabled=void 0)),this.sessionManager.init(this),this.nanoCDNHostManager?.init(this,t),this.adManager.init(this),this.internalAdManager.init(this),void 0!==R.monitoringModule&&(this.monitoringManager=new R.monitoringModule.RealTimeMonitoringManager(this)),a.A.getInstance().attachInstance(this),R.analyticsModule?.CacheManager.getInstance().attachInstance(this),R.analyticsModule?.PlayerManager.getInstance().attachInstance(this),R.nanoCDNModule?.MdnsManager.getInstance().attachInstance(this),R.diversityModule?.DiversityPluginManager.getInstance().attachInstance(this),R.adModule?.OMSDKManager.getInstance().attachInstance(this),R.simidModule?.SimidControllerManager.getInstance().attachInstance(this),S.A.getInstance().init(this),S.A.getInstance().addListener(this.nanoCDNHostManager),R.analyticsModule?.CacheManager.getInstance().clean(),this.#t=!0,!0):(i.g.e(N,"Error: initialization aborted"),!1)}initAnalytics(e){return i.g.i(N,"Init SmartLib analytics..."),i.g.i(N,"Version: "+n.A),this.#s||this.#t?(i.g.e(N,"Error: SmartLib analytics already initialized, please use SmartLib.release() before initializing."),!1):void 0===R.analyticsModule?(i.g.e(N,"Error: Analytics module not loaded, please import it."),!1):r.A.typeOrNullParameter(e,"string","Error: analyticsAddress should be a string or null")?(this.#a(e),this.options=new l.H,i.g.i(N,"Parameters:analyticsAddress="+e),this.sessionManager.init(this),this.adManager.init(this),this.internalAdManager.init(this),void 0!==R.monitoringModule&&(this.monitoringManager=new R.monitoringModule.RealTimeMonitoringManager(this)),a.A.getInstance().attachInstance(this),R.analyticsModule?.CacheManager.getInstance().attachInstance(this),R.analyticsModule?.PlayerManager.getInstance().attachInstance(this),R.adModule?.OMSDKManager.getInstance().attachInstance(this),R.simidModule?.SimidControllerManager.getInstance().attachInstance(this),S.A.getInstance().init(this),R.analyticsModule?.CacheManager.getInstance().clean(),this.#s=!0,!0):(i.g.e(N,"Error: initialization aborted"),!1)}getURL(e,t){return void 0!==this.handler&&(i.g.e(N,"Exception: A session is already running, please use SmartLib.stopStreamingSession(...) before. Stopping the current one...",this.handler.id),this.stopStreamingSession()),i.g.i(N,"getURL with "+e,this.handler?.id),void 0===t&&(t=()=>{}),r.A.typeParameter(t,"function","Error: callback should be a function")?this.#t?r.A.typeParameter(e,"string","Error: requestedURL should be a string")&&r.A.stringNonEmpty(e,"Error: requestedURL is empty")?(this.handler=this.sessionManager.createSessionHandler(),this.handler.options=l.H.create(this.options),this.handler.playerAdapter=R.analyticsModule?.PlayerManager.getInstance().getPlayerAdapter(),this.handler.adSession=this.internalAdManager.adSession,void 0!==this.internalAdManager.adSession&&(this.internalAdManager.adSession.handler=this.handler),this.internalAdManager.adSession=new A.A,this.internalAdManager.adSession.setEventCallbackEnabled(this.internalAdManager.eventCallbackEnabled),this.internalAdManager.adSession.setAdEventsListener(this.internalAdManager.adEventsListener),this.handler.start(e,t)):(t(""),Promise.resolve("")):(i.g.e(N,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.getURL(...)",this.handler?.id),t(""),Promise.resolve("")):Promise.resolve("")}getQuery(){return void 0!==this.handler&&(i.g.e(N,"Exception: A session is already running, please use SmartLib.stopStreamingSession(...) before. Stopping the current one..."),this.stopStreamingSession()),i.g.i(N,"getQuery"),this.#t?(this.handler=this.sessionManager.createProxySessionHandler(),this.handler.options=l.H.create(this.options),this.handler.playerAdapter=R.analyticsModule?.PlayerManager.getInstance().getPlayerAdapter(),this.handler.getQuery()):(i.g.e(N,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.getQuery(...)"),"")}startStreamingSession(e,t){return i.g.i(N,"startStreamingSession with "+e+" and "+t,this.handler?.id),this.#t?!(!r.A.typeParameter(e,"string","Error: contentURL should be a string")||!r.A.typeParameter(t,"string","Error: redirectedURL should be a string"))&&(void 0===this.handler?(i.g.e(N,"Exception: Implementation error, SmartLib.getQuery() should be called prior to SmartLib.startStreamingSession(...)",this.handler?.id),!1):this.handler instanceof d.A?(this.handler.start(e,t),!0):(i.g.e(N,"Exception: Implementation error, SmartLib.startStreamingSession(...) cannot be called with SmartLib.getURL(...)",this.handler?.id),!1)):(i.g.e(N,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.startStreamingSession(...)",this.handler?.id),!1)}stopStreamingSession(e){void 0!==e?i.g.i(N,"Stopping streaming session with statusCode "+e+"...",this.handler?.id):i.g.i(N,"Stopping streaming session...",this.handler?.id);let t=this.handler;return void 0!==this.handler?(this.handler.stop(e),this.handler=void 0):i.g.d(N,"Stopping streaming session aborted, no session started"),t}createStreamingSession(e){if(this.#t){const t=void 0===e;t&&(e=this.options);const s=this.sessionManager.createStreamingSession(this.options,e);return t?i.g.i(N,"Creating streaming session...",s.id):(i.g.i(N,"Creating streaming session with options...",s.id),e.printUpdates(N,"",s.id)),s}i.g.e(N,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.createStreamingSession(...)")}createAnalyticsSession(e){if(this.#s){const t=void 0===e;t&&(e=this.options);const s=this.sessionManager.createAnalyticsSession(this.options,e);return t?i.g.i(N,"Creating analytics session...",s.id):(i.g.i(N,"Creating analytics session with options...",s.id),e.printUpdates(N,"",s.id)),s}i.g.e(N,"Exception: Implementation error, SmartLib.initAnalytics(...) should be called prior to SmartLib.createAnalyticsSession(...)")}release(){this.#t&&(i.g.i(N,"Releasing SmartLib..."),this.stopStreamingSession(),this.internalAdManager.release(),this.adManager.release(),this.nanoCDNHostManager?.release(),this.sessionManager.release(),this.monitoringManager?.release(),S.A.getInstance().release(),R.nanoCDNModule?.MdnsManager.getInstance().release(),R.analyticsModule?.PlayerManager.getInstance().release(),R.analyticsModule?.CacheManager.getInstance().release(),a.A.getInstance().release(),R.diversityModule?.DiversityPluginManager.getInstance().release(),R.adModule?.OMSDKManager.getInstance().release(this),R.simidModule?.SimidControllerManager.getInstance().release(),this.#t=!1),this.#s&&(i.g.i(N,"Releasing SmartLib analytics..."),this.stopStreamingSession(),this.internalAdManager.release(),this.adManager.release(),this.sessionManager.release(),this.monitoringManager?.release(),S.A.getInstance().release(),R.analyticsModule?.PlayerManager.getInstance().release(),R.analyticsModule?.CacheManager.getInstance().release(),a.A.getInstance().release(),R.adModule?.OMSDKManager.getInstance().release(this),R.simidModule?.SimidControllerManager.getInstance().release(),this.#s=!1),this.options=new l.H,this.#a(""),this.#n(""),this.#r("")}attachPlayer(e,t){void 0!==e?(R.analyticsModule?.PlayerManager.getInstance().setPlayerAdapter(e),void 0!==this.handler&&i.g.e(N,"Exception: You cannot attach a player when a session is running, this player will be used for the next session.",this.handler.id)):void 0===R.analyticsModule?i.g.w(N,"Try to attach a player, but analytics module not loaded",this.handler?.id):i.g.w(N,"Try to attach a player, but it is not recognized",this.handler?.id)}detachPlayer(){return void 0!==this.handler?(i.g.e(N,"Exception: You cannot detach the player when a session is running",this.handler.id),!1):(R.analyticsModule?.PlayerManager.getInstance().setPlayerAdapter(void 0),!0)}isInitialized(){return this.#t}isAnalyticsInitialized(){return this.#s}getMetricsManager(){if(void 0!==this.handler)return this.handler.metricsManager}getListener(){return R.analyticsModule?.PlayerManager.getInstance().getPlayerAdapter()}getVersion(){return n.A}getParameters(){return this.#i}setUUID(e){r.A.typeParameter(e,"string","Error: uuid should be a string")&&(e.length>36?this.#i.uuid=e.substring(0,36):this.#i.uuid=e)}setUserAgent(e){r.A.typeOrUndefinedParameter(e,"string","Error: userAgent should be a string")&&(this.#i.userAgent=e)}setDeviceType(e){r.A.typeParameter(e,"string","Error: deviceType should be a string")&&(this.#i.deviceType=e,S.A.getInstance().deviceType=e)}setCustomParameter(e,t){"string"==typeof e?this.#i.customParameters[e]=r.A.toBkAString(String(t)):i.g.e(N,"Error: Only string values are accepted for custom parameters")}resetCustomParameters(){this.#i.customParameters={}}setForceTeardown(e){"number"==typeof e?this.#i.forceTeardown=e>=1?R.FORCE_TEARDOWN_ENABLED:e<=-1?R.FORCE_TEARDOWN_DISABLED:R.FORCE_TEARDOWN_DEFAULT:i.g.e(N,"Exception: parameter forceTeardown must be SmartLib.FORCE_TEARDOWN_DISABLED, SmartLib.FORCE_TEARDOWN_DEFAULT or SmartLib.FORCE_TEARDOWN_ENABLED")}setNanoCDNResolvingRetryDelay(e){void 0!==this.nanoCDNHostManager?(i.g.v(N,"Updating nanoCDN resolving retry asyncDelay to "+e+"ms"),this.nanoCDNHostManager?.setNanoCDNResolvingRetryDelay(e)):i.g.e(N,"Exception: Implementation error, SmartLib.init(...) should be called prior to SmartLib.setNanoCDNResolvingRetryDelay(...)")}registerNanoCDNReceiver(e){void 0!==this.nanoCDNHostManager?(this.nanoCDNReceiver=void 0,this.nanoCDNHostManager.registerNanoCDNReceiver(e)):this.nanoCDNReceiver=e}setNanoCDNHttpsEnabled(e){i.g.v(N,"Updating nanoCDN https enabled to "+e),void 0!==this.nanoCDNHostManager?(this.nanoCDNHttpsEnabled=void 0,this.nanoCDNHostManager.setNanoCDNHttpsEnabled(e)):this.nanoCDNHttpsEnabled=e}restartNanoCDNResolving(){this.nanoCDNHostManager?.restartNanoCDNResolving()}setOption(e,t){i.g.d(N,"Setting global option "+l.H.optionToString(e)+" to "+l.H.valueToString(e,t)),this.options.set(e,t)}#a=e=>{null!=e&&0!==e.length?this.#i.analyticsAddress=e:this.#i.analyticsAddress=""};#n=e=>{null!=e&&0!==e.length?(void 0===R.nanoCDNModule&&i.g.w(N,"Warning: nanoCDNHost is set while the module is not loaded."),this.#i.nanoCDNHost=e.replace(/\s/g,"")):this.#i.nanoCDNHost=""};#r=e=>{null!=e&&0!==e.length?this.#i.broadpeakDomainNames=e.replace(/\s/g,""):this.#i.broadpeakDomainNames=""}}},1262:function(e,t,s){s.d(t,{X2:function(){return o.X2},GM:function(){return l},r2:function(){return h},CE:function(){return r.A},Em:function(){return S.A},$b:function(){return n.$},gD:function(){return n.g},Je:function(){return a.A},x6:function(){return i.A},fF:function(){return u.f},H1:function(){return E.H},Sy:function(){return g.S}});var i=s(1142),a=s(6506),n=s(8379),r=(s(1134),s(3473)),o=s(5690);const d="BpkAdPalMgr";class l{constructor(){}setConsentSettings(e){n.g.e(d,"setConsentSettings not implemented")}registerPalManagerCallback(e){n.g.e(d,"registerPalManagerCallback not implemented")}unregisterPalManagerCallback(){n.g.e(d,"unregisterPalManagerCallback not implemented")}generateAdPalSession(e){n.g.e(d,"generateAdPalSession not implemented")}reset(){n.g.e(d,"reset not implemented")}release(){}setValue(e,t,s){n.g.e(d,"setValue not implemented")}setDescriptionURL(e){this.setValue("setDescriptionURL",e)}setOmidPartner(e,t){this.setValue("setOmidPartner",e,t)}setOmidVersion(e){this.setValue("setOmidVersion",e)}setPlayerType(e){this.setValue("setPlayerType",e)}setPlayerVersion(e){this.setValue("setPlayerVersion",e)}setPpid(e){this.setValue("setPpid",e)}setVideoPlayerHeight(e){this.setValue("setVideoPlayerHeight",e)}setVideoPlayerWidth(e){this.setValue("setVideoPlayerWidth",e)}setWillAdAutoPlay(e){this.setValue("setWillAdAutoPlay",e)}setWillAdPlayMuted(e){this.setValue("setWillAdPlayMuted",e)}}const c="BpkAdPalSession";class h{getNonce(){return n.g.e(c,"getNonce not implemented"),""}sendAdClick(){n.g.e(c,"sendAdClick not implemented")}sendAdImpression(){n.g.e(c,"sendAdImpression not implemented")}sendPlaybackStart(){n.g.e(c,"sendPlaybackStart not implemented")}sendPlaybackEnd(){n.g.e(c,"sendPlaybackEnd not implemented")}sendTouch(e){n.g.e(c,"sendTouch not implemented")}setAdView(e){}}var u=s(828),E=s(7832),g=s(3121),S=s(3445)},2765:function(e,t,s){s.d(t,{A:function(){return d}});var i=s(8724),a=s(1262),n=s(5866),r=s(1142);const o="BpkProxySessionHandler";class d extends i.A{startCalled;constructor(e,t=void 0){super(e,t),this.startCalled=!1}getQuery(){const e=this.smartLib.nanoCDNHostManager?.getCurrentNanoCDNDescr(),t=void 0!==e?"nanoCDN host: "+e.hostIP:"No nanoCDN found";a.gD.i(o,t+" ("+n.A+")",this.id),this.options.print(o,"",this.id),this.initPlayerAdapter(),this.initManagers(),this.notifyStart();let s="bk-ml=1";return void 0!==e?r.A.nanoCDNModule.NanoCDNRequestManager.getInstance().getQuery(e,this).then((e=>(s+=e,a.gD.i(o,"getQuery result : "+s,this.id),s))):(a.gD.i(o,"getQuery result : "+s,this.id),Promise.resolve(s))}start(e,t){if(this.startCalled)a.gD.e(o,"Implementation error: SmartLib.startStreamingSession(...) already called.",this.id);else{a.gD.i(o,"Starting streaming session...",this.id),this.startCalled=!0,this.sessionReport.startSessionDate=Date.now(),this.sessionReport.requestedURL=e,this.sessionReport.redirectedURL=t,this.sessionReport.precached=this.isPrecached(),this.sessionResult=a.Sy.success(t);const s=this.smartLib.getParameters(),i={broadpeakDomainNames:s.broadpeakDomainNames,forceTeardown:s.forceTeardown};this.handleRedirectedURL(i)}}}},3121:function(e,t,s){s.d(t,{S:function(){return i}});class i{static RESULT_NO_ERROR=0;static RESULT_NO_STREAMING_URL_FOUND=3100;static RESULT_CDN_RESPONSE_UNREADABLE=3101;static RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN=3102;static RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN=3103;static RESULT_REQUESTED_URL_CDN_ERROR=3104;static RESULT_NANOCDN_SESSION_LIMIT_REACHED=3201;static RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL=3202;static RESULT_NANOCDN_SERVICE_UNAVAILABLE=3203;static RESULT_NANOCDN_CHANNEL_UNAVAILABLE=3204;static RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED=3205;static RESULT_NANOCDN_RESPONSE_UNREADABLE=3206;static RESULT_API_PARAMETER_FORMAT_ERROR=3400;static RESULT_API_NOT_INITIALIZED=3401;static RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST=3402;static RESULT_REQUEST_ALREADY_DONE=3403;static RESULT_NO_DETAILED_ERROR=0;static RESULT_DETAILED_ERROR_PARSING_ERROR=-1;url;errorCode;detailedErrorCode;detailedErrorMessage;nanoCDNUsed;nanoCDNDescr;constructor(e,t,s=""){this.url=e,this.errorCode=t,this.detailedErrorMessage=s.trim();const a=s.match("^([0-9]+).*");null!==a&&void 0!==a[1]?this.detailedErrorCode=parseInt(a[1],10):""===this.detailedErrorMessage?this.detailedErrorCode=i.RESULT_NO_DETAILED_ERROR:this.detailedErrorCode=i.RESULT_DETAILED_ERROR_PARSING_ERROR,this.nanoCDNUsed=!1,this.nanoCDNDescr=void 0}static success(e){return new i(e,i.RESULT_NO_ERROR)}static error(e,t=""){return new i("",e,t)}getURL(){return this.url}isError(){return this.errorCode!==i.RESULT_NO_ERROR}getErrorCode(){return this.errorCode}getErrorMessage(){return i.getErrorMessage(this.errorCode)}getDetailedErrorCode(){return this.detailedErrorCode}getDetailedErrorMessage(){return this.detailedErrorMessage}isNanoCDNUsed(){return this.nanoCDNUsed}static getErrorMessage(e){switch(e){case i.RESULT_NO_ERROR:return"Result success. The session has been created.";case i.RESULT_NO_STREAMING_URL_FOUND:return"Request error. No streaming URL has been found. Default error when requesting the CDN (BkM/uCDN).";case i.RESULT_CDN_RESPONSE_UNREADABLE:return"Request error. The CDN response is unreadable (timeout error, CORS error, connection error).";case i.RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN:return"Request error. Content not found on the CDN (error 4XX).";case i.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN:return"Request error. Content not found on the nanoCDN (error 404, timeout error, CORS error or connection error).";case i.RESULT_REQUESTED_URL_CDN_ERROR:return"Request error. The CDN returned an unknown error (error 5XX).";case i.RESULT_NANOCDN_SESSION_LIMIT_REACHED:return"nanoCDN error. All nanoCDN on the network responded with session limit reached error.";case i.RESULT_NANOCDN_SESSION_LIMIT_REACHED_ON_REQUESTED_CHANNEL:return"nanoCDN error. All nanoCDN on the network responded with session limit reached error for the requested channel.";case i.RESULT_NANOCDN_SERVICE_UNAVAILABLE:return"nanoCDN error. All nanoCDN on the network have their service unavailable.";case i.RESULT_NANOCDN_CHANNEL_UNAVAILABLE:return"nanoCDN error. The requested channel is unavailable on all nanoCDN of the network.";case i.RESULT_NANOCDN_REQUEST_LOCAL_IF_CONNECTED_TO_WIFI_NOT_ALLOWED:return"nanoCDN error. A nanoCDN on 127.0.0.1 has been found and is connected to Wi-Fi but it is not allowed.";case i.RESULT_API_PARAMETER_FORMAT_ERROR:return"Api error. A method parameter does not have the right format.";case i.RESULT_API_NOT_INITIALIZED:return"Api error. SmartLib init not called";case i.RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST:return"Workflow error. The session has been stopped during request.";case i.RESULT_REQUEST_ALREADY_DONE:return"Workflow error. The request has already been done for that session."}return"No error message for the error code "+e}}},3445:function(e,t,s){s.d(t,{A:function(){return i}});class i{static formatDate(e=new Date){let t="";e<0&&(e*=-1,t="-");const s=e.getDate()<=9?"0"+e.getDate():e.getDate(),i=e.getMonth()+1<=9?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getHours()<=9?"0"+e.getHours():e.getHours(),n=e.getMinutes()<=9?"0"+e.getMinutes():e.getMinutes(),r=e.getSeconds()<=9?"0"+e.getSeconds():e.getSeconds();let o=String(e.getMilliseconds());return 1===o.length?o="00"+o:2===o.length&&(o="0"+o),t+i+"-"+s+" "+a+":"+n+":"+r+"."+o}static formatTime(e){let t="";e<0&&(e*=-1,t="-");const s=e%1e3,i=Math.floor(e/1e3%60),a=Math.floor(e/6e4%60),n=Math.floor(e/36e5%24),r=n<=9?"0"+n:n,o=a<=9?"0"+a:a,d=i<=9?"0"+i:i;let l=String(s);return 1===l.length?l="00"+l:2===l.length&&(l="0"+l),t+r+":"+o+":"+d+"."+l}}},3473:function(e,t,s){s.d(t,{A:function(){return n}});var i=s(1262);const a="BpkAppStateMgr";class n{static#e;smartLib;listeners;bound;networkAvailable;appInBackground;networkType=99;mute=0;osName="";osVersion="";deviceType="";static getInstance(){return n.#e||(n.#e=new n),n.#e}constructor(){this.bound=!1,this.release()}init(e){i.gD.d(a,"Initializing core app state manager..."),this.smartLib=e,!1===this.bound?(this.networkAvailable=!0,this.appInBackground=!1):i.gD.d(a,"Core app state manager is bound to the target, skipping default values..."),this.release()}release(){this.listeners=[]}setDeviceInfo(e,t,s){this.osName=e,this.osVersion=t,this.deviceType=s}bind(){i.gD.i(a,"Device:osName="+this.osName+", osVersion="+this.osVersion),i.gD.i(a,"Device:type="+this.deviceType),this.bound=!0}isConnectedToWifi(){return this.networkType>=10&&this.networkType<=12}addListener(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}removeListener(e){let t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}notifyEvent(e,t,s,i){"function"==typeof e[t]&&e[t](s,i)}notifyForeground(){i.gD.d(a,"App is in foreground"),this.appInBackground=!1,this.listeners.forEach((e=>{this.notifyEvent(e,"onForeground")}))}notifyBackground(){i.gD.d(a,"App is in background"),this.appInBackground=!0,this.listeners.forEach((e=>{this.notifyEvent(e,"onBackground")}))}notifyNetworkAvailable(e){void 0===e?(i.gD.d(a,"Network is available (networkType:"+e+")"),this.networkAvailable=!0,this.listeners.forEach((e=>{this.notifyEvent(e,"onNetworkAvailable",99)}))):this.networkType!==e&&(i.gD.d(a,"Network is available (networkType:"+e+")"),this.networkAvailable=!0,this.networkType=e,this.listeners.forEach((t=>{this.notifyEvent(t,"onNetworkAvailable",e)})))}notifyNetworkLost(){!1!==this.networkAvailable&&(i.gD.d(a,"Network is unavailable"),this.networkAvailable=!1,this.networkType=0,this.listeners.forEach((e=>{this.notifyEvent(e,"onNetworkLost")})))}notifyMute(){i.gD.d(a,"Volume is muted"),this.mute=1,this.listeners.forEach((e=>{this.notifyEvent(e,"onMute")}))}notifyUnmute(){i.gD.d(a,"Volume is unmuted"),this.mute=0,this.listeners.forEach((e=>{this.notifyEvent(e,"onUnmute")}))}}},4623:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){function nativeRequire(lib){return eval("require")(lib)}function nativeMainRequire(lib){return eval("require").main.require(lib)}__webpack_require__.d(__webpack_exports__,{C:function(){return nativeMainRequire},t:function(){return nativeRequire}})},4943:function(e,t,s){s.d(t,{A:function(){return i}});class i{static randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static bufferToBase64Lookup(e){return e<26?String.fromCharCode(e+"A".charCodeAt(0)):e<52?String.fromCharCode(e-26+"a".charCodeAt(0)):e<62?String.fromCharCode(e-52+"0".charCodeAt(0)):62===e?"-":63===e?"_":""}static bufferToBase64(e){let t;const s=e.data(),a=e.length();let n="";for(t=0;t<a;t+=3){let e=[void 0,void 0,void 0,void 0];e[0]=s[t]>>2,e[1]=(3&s[t])<<4,a>t+1&&(e[1]|=s[t+1]>>4,e[2]=(15&s[t+1])<<2),a>t+2&&(e[2]|=s[t+2]>>6,e[3]=63&s[t+2]);for(let t=0;t<e.length;t++)void 0===e[t]||(n+=i.bufferToBase64Lookup(e[t]))}return n}static BASE64_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static stringToBase64(e){let t="",s="",a=e.length%3;if(a>0)for(;a<3;a++)s+="=",e+="\0";for(a=0;a<e.length;a+=3){let s=(e.charCodeAt(a)<<16)+(e.charCodeAt(a+1)<<8)+e.charCodeAt(a+2);s=[s>>>18&63,s>>>12&63,s>>>6&63,63&s],t+=i.BASE64_CHARS[s[0]]+i.BASE64_CHARS[s[1]]+i.BASE64_CHARS[s[2]]+i.BASE64_CHARS[s[3]]}return t.substring(0,t.length-s.length)+s}static base64ToString(e){const t="="===(e=e.replace(new RegExp("[^"+i.BASE64_CHARS.split("")+"=]","g"),"")).charAt(e.length-1)?"="===e.charAt(e.length-2)?"AA":"A":"";let s="";e=e.substr(0,e.length-t.length)+t;for(let t=0;t<e.length;t+=4){const a=(i.BASE64_CHARS.indexOf(e.charAt(t))<<18)+(i.BASE64_CHARS.indexOf(e.charAt(t+1))<<12)+(i.BASE64_CHARS.indexOf(e.charAt(t+2))<<6)+i.BASE64_CHARS.indexOf(e.charAt(t+3));s+=String.fromCharCode(a>>>16&255,a>>>8&255,255&a)}return s.substring(0,s.length-t.length)}static floor(e){return e>>>0}static bufferToString(e,t=e.length){let s="[0x";for(let i=0;i<t;i++){const a=e[i];s+=("00"+Number(a).toString(16)).slice(-2),i<t-1&&(s+=",0x")}return s+="] (capacity:"+e.length+")",s}}},5305:function(e,t,s){s.d(t,{A:function(){return l}});var i=s(8379),a=s(1134);const n="BpkAdPalSessionRequest";class r{static TIMEOUT_DELAY=5e3;active;timeout;adPalManager;adPalSession;generating;waitNonceResolveCallback;constructor(e){this.active=!0,this.timeout=!1,this.adPalManager=e,this.generating=!1}setAdPalSession(e){this.adPalSession=e,this.active=!1}generateAdPalSession(){const e=()=>{i.g.d(n,"Nonce generation timeout"),this.timeout=!0,void 0!==this.waitNonceResolveCallback&&(this.setAdPalSession(void 0),this.waitNonceResolveCallback(void 0))};this.generating=!0,a.A.getInstance().asyncNonce(r.TIMEOUT_DELAY,(e=>{const t=e.adPalSession;i.g.d(n,"AdPalSession async nonce="+t?.getNonce()),this.setAdPalSession(t)}),e,(()=>{const t=setTimeout(e,r.TIMEOUT_DELAY);this.adPalManager.generateAdPalSession((e=>{clearTimeout(t),i.g.d(n,"AdPalSession nonce="+e?.getNonce()),this.setAdPalSession(e),void 0!==this.waitNonceResolveCallback&&!1===this.timeout?this.waitNonceResolveCallback(e):void 0!==this.waitNonceResolveCallback&&!0===this.timeout&&this.waitNonceResolveCallback(void 0)}))}))}getAdPalSession(){return void 0===this.adPalSession&&!0===this.active?new Promise(((e,t)=>{a.A.getInstance().waitNonce(r.TIMEOUT_DELAY,(t=>{const s=t.adPalSession;i.g.d(n,"AdPalSession nonce="+s?.getNonce()),this.setAdPalSession(s),e(this.adPalSession)}),(()=>{this.active=!1,this.timeout=!0,this.waitNonceResolveCallback=void 0,e(this.adPalSession)}),(()=>{!0===this.generating?this.waitNonceResolveCallback=e:(this.waitNonceResolveCallback=e,this.generateAdPalSession())}))})):new Promise(((e,t)=>{e(this.adPalSession)}))}}var o=s(1105);const d="BpkInternalAdMgr";class l{static AD_NONCE_QUERY_PARAMETER="paln";smartLib;initialized;adPalManager;omPartnerName;omPartnerVersion;firstAdPalSessionRequest;palSessionEnabled=!1;adSession;eventCallbackEnabled;adEventsListener;constructor(){this.initialized=!1,this.palSessionEnabled=!1,this.adSession=new o.A,this.eventCallbackEnabled=!0,this.adEventsListener=void 0}init(e){this.smartLib=e,this.initialized||(this.initialized=!0,this.adSession=new o.A,this.eventCallbackEnabled=!0,this.adEventsListener=void 0,this.omPartnerName="Broadpeak_tv",this.omPartnerVersion=e.adManager.getVersion(),i.g.d(d,"Ad manager version: "+this.omPartnerVersion),i.g.d(d,"Ad manager loaded"))}setPalManager(e){i.g.d(d,"Native PAL manager registered"),this.adPalManager=e}requestAdPalSession(){let e=this.firstAdPalSessionRequest;return void 0!==e&&void 0===e.adPalSession&&!0===e.active&&!1===e.timeout?(i.g.d(d,"Using first nonce request..."),this.firstAdPalSessionRequest=void 0,e):(this.firstAdPalSessionRequest=void 0,e=new r(this.adPalManager),this.initialized&&this.palSessionEnabled?(i.g.d(d,"Generating nonce..."),e.generateAdPalSession(),void 0===this.adPalManager&&e.setAdPalSession(void 0)):e.setAdPalSession(void 0),e)}release(){this.initialized=!1,this.palSessionEnabled=!1,this.adSession=new o.A,this.eventCallbackEnabled=!0,this.adEventsListener=void 0,void 0!==this.firstAdPalSessionRequest&&(this.firstAdPalSessionRequest.setAdPalSession(void 0),this.firstAdPalSessionRequest=void 0),void 0!==this.adPalManager&&this.adPalManager.reset()}setConsentSettings(e){this.adPalManager?.setConsentSettings(e)}setPalParameters(e,t,s,a,n,o,l,c,h,u,E){void 0!==this.adPalManager&&(void 0!==e&&this.adPalManager.setDescriptionURL(e),void 0!==t&&void 0!==s&&this.adPalManager.setOmidPartner(t,s),void 0!==a&&this.adPalManager.setOmidVersion(a),void 0!==n&&this.adPalManager.setPlayerType(n),void 0!==o&&this.adPalManager.setPlayerVersion(o),void 0!==l&&this.adPalManager.setPpid(l),0!==c&&this.adPalManager.setVideoPlayerHeight(c),0!==h&&this.adPalManager.setVideoPlayerWidth(h),this.adPalManager.setWillAdAutoPlay(u),this.adPalManager.setWillAdPlayMuted(E),this.palSessionEnabled||(this.palSessionEnabled=!0,i.g.d(d,"Generating first nonce..."),this.firstAdPalSessionRequest=new r(this.adPalManager),this.firstAdPalSessionRequest.generateAdPalSession()))}}},5690:function(e,t,s){s.d(t,{D6:function(){return r},X2:function(){return l},eQ:function(){return o},up:function(){return n}});var i=s(1142),a=s(8379);class n{static MINIMIZED="minimized";static COLLAPSED="collapsed";static NORMAL="normal";static EXPANDED="expanded";static FULLSCREEN="fullscreen";static isAdViewState(e){switch(e){case n.MINIMIZED:case n.COLLAPSED:case n.NORMAL:case n.EXPANDED:case n.FULLSCREEN:return!0}return!1}}class r{static VIDEO_CONTROLS=0;static CLOSE_AD=1;static NOT_VISIBLE=2;static OTHER=3;static isAdFriendlyObstructionPurpose(e){return e>=0&&e<=3}}class o{static AD_LINEAR="linear";static AD_NON_LINEAR="nonlinear";static AD_LINEAR_AND_NON_LINEAR="linear_and_nonlinear";static UNSUPPORTED="unsupported";static getAdType(e){switch(e){case this.AD_LINEAR:case this.AD_NON_LINEAR:case this.AD_LINEAR_AND_NON_LINEAR:return e;case void 0:return this.AD_LINEAR;default:return this.UNSUPPORTED}}}const d="BpkAdMgr";class l{smartLib;palSDK;static getInstance(){return i.A.getInstance().adManager}constructor(){}init(e){this.smartLib=e}release(){}getVersion(){return"04.05.00"}attachPALSDK(e){"object"==typeof e.pal?(a.g.d(d,"PAL SDK attached"),this.palSDK=e):a.g.e(d,"Try to attach PAL SDK, but it is not recognized")}setConsentSettings(e){this.smartLib.internalAdManager.setConsentSettings(e)}setPalParameters(e,t,s,i,a,n,r,o,d,l,c){this.smartLib.internalAdManager.setPalParameters(e,t,s,i,a,n,r,o,d,l,c)}activateAdvertising(){this.smartLib.internalAdManager.adSession.activateAdvertising()}setAdParameter(e,t){this.smartLib.internalAdManager.adSession.setAdParameter(e,t)}setEventCallbackEnabled(e){this.smartLib.internalAdManager.eventCallbackEnabled=e,this.smartLib.internalAdManager.adSession.setEventCallbackEnabled(e)}setAdEventsListener(e){this.smartLib.internalAdManager.adEventsListener=e,this.smartLib.internalAdManager.adSession.setAdEventsListener(e)}}},5866:function(e,t){t.A="05.01.03.66cccb4"},5941:function(e,t,s){s.d(t,{A:function(){return n}});var i=s(8379);const a="BpkValidator";class n{static typeParameter(e,t,s){return typeof e===t||(i.g.e(a,s),!1)}static typeOrUndefinedParameter(e,t,s){return typeof e===t||void 0===e||(i.g.e(a,s),!1)}static typeOrNullParameter(e,t,s){return typeof e===t||null===e||(i.g.e(a,s),!1)}static stringNonEmpty(e,t){return"string"==typeof e&&e.length>0||(i.g.e(a,t),!1)}static toBkAString(e){return void 0!==e&&"string"==typeof e?e.replace(/\n/g,"").replace(/\t/g,"").replace(/\r/g,""):e}}},6506:function(e,t,s){s.d(t,{A:function(){return u}});var i=s(8379),a=s(7964),n=s(5866),r=s(1134),o=s(1262),d=s(5305),l=s(1142);const c="BpkRequestMgr";class h{static get(e,t,s,i){i({body:void 0,headers:void 0,statusCode:-1,message:"",responseURL:""})}static post(e,t,s,i,a){a({body:void 0,headers:void 0,statusCode:-1,message:"",responseURL:""})}}class u{static TEARDOWN_PATH="teardown/";static TEARDOWN_METRICS_QUERY="metrics=";static TEARDOWN_TIMELINE_QUERY="metricsTL=";static KEEPALIVE_PATH="keepalive";static QUERY_PARAMETER_SESSION_ID="bk-session_id";static QUERY_PARAMETER_SESSION_CREATED="bk-session";static HEADER_CDN_DETAILED_ERROR_CODE="x-bpk-error";static HEADER_CDN_TIMING="x-bpk-timing";static CDN_REQUEST_TIMEOUT=2e4;static BKS_REQUEST_TIMEOUT=5e3;static KEEPALIVE_REQUEST_INTERVAL=5e3;static#e;requestHandler=h;smartLib;static getInstance(){return u.#e||(u.#e=new u),u.#e}constructor(){}init(e){this.requestHandler=e}attachInstance(e){this.smartLib=e}release(){}getHeaders(e=this.smartLib.getParameters()){let t={};return void 0!==e.userAgent&&(t["User-Agent"]=e.userAgent),t}async getURL(e,t,s){const h=s.options,E=void 0!==t.nanoCDNDescr&&!0===h.get(o.H1.REQUEST_NANO_CDN),g=u.isBroadpeakDomainName(e,t.broadpeakDomainNames)&&!0===h.get(o.H1.REQUEST_BROADPEAK_CDN),S=!0===h.get(o.H1.MULTICAST_ONLY)||!0===h.get(o.H1.LEGACY_MULTICAST_ONLY);let p,_,A;if(E?"*"===t.broadpeakDomainNames?i.g.i(c,"Workflow 5.2 (v"+n.A+")",s.id):""===t.broadpeakDomainNames?i.g.i(c,"Workflow 5.4 (v"+n.A+")",s.id):g?i.g.i(c,"Workflow 5.6 => 5.2 (v"+n.A+")",s.id):i.g.i(c,"Workflow 5.6 => 5.4 (v"+n.A+")",s.id):"*"===t.broadpeakDomainNames?i.g.i(c,"Workflow 5.1 (v"+n.A+")",s.id):""===t.broadpeakDomainNames?i.g.i(c,"Workflow 5.3 (v"+n.A+")",s.id):g?i.g.i(c,"Workflow 5.5 => 5.1 (v"+n.A+")",s.id):i.g.i(c,"Workflow 5.5 => 5.3 (v"+n.A+")",s.id),i.g.i(c,"   Parameters",s.id),i.g.i(c,"      analyticsAddress="+t.analyticsAddress,s.id),i.g.i(c,"      nanoCDNHost="+(void 0===t.nanoCDNDescr?"":t.nanoCDNDescr.hostIP),s.id),i.g.i(c,"      broadpeakDomainNames="+t.broadpeakDomainNames,s.id),h.print(c,"   ",s.id),E){if(void 0===l.A.nanoCDNModule)return i.g.e(c,"Error: detected nanoCDN session but nanoCDNModule not loaded."),o.Sy.error(o.Sy.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN);if(p=await l.A.nanoCDNModule.NanoCDNRequestManager.getInstance().requestNanoCDNSession(e,t,s),p.result.isError())if(g)i.g.d(c,"nanoCDN responded an error, requesting the BkM (using nanoCDN: "+p.nanoCDNHostIP+")",s.id);else{if(!0===S)return p.noFallbackResult;p.result=o.Sy.success(e)}}else if(!0===S)return i.g.e(c,"Error: multicast only option enabled but session is not using nanoCDN."),o.Sy.error(o.Sy.RESULT_REQUESTED_URL_NOT_FOUND_ON_NANOCDN);if(void 0===p?.nanoCDNHostIP&&!0===s.adSession?.getAdAllowedQuery()&&(_=this.smartLib.internalAdManager.requestAdPalSession()),(!S||!E||p?.result.isError())&&(A=await this.requestBkM(e,t,p?.nanoCDNHostIP,s),A.isError()))return A;if(void 0===p||p.result.isError()||(void 0!==A&&!0===g&&!1===S?-1!==A.url.indexOf("://"+p.nanoCDNHostIP+":")&&(A.nanoCDNUsed=!0,A.nanoCDNDescr=p.nanoCDNDescr,!0===s.options.get(o.H1.ULTRA_LOW_LATENCY_SUPPORT)&&(A.url=a.A.addOrReplaceParam(A.url,"ulls","1"))):A=p.result),void 0!==A&&!1===A.nanoCDNUsed&&void 0!==s.adSession&&s.adSession.isAdActivated()){const e=s.adSession.adParameters;for(let t in e)A.url=a.A.addOrReplaceParam(A.url,t,encodeURIComponent(e[t]));let i;void 0!==_&&(!0!==_.generating||g||await r.A.getInstance().asyncDelayPromise(80),i=await _.getAdPalSession(),void 0!==i&&(A.url=a.A.addOrReplaceParam(A.url,d.A.AD_NONCE_QUERY_PARAMETER,i.getNonce()),s.adSession.adPalSession=i,i.setAdView(s.adSession.adView))),await this.requestBkYou(A,t,s,g,i)}return void 0===A?o.Sy.error(o.Sy.RESULT_NO_STREAMING_URL_FOUND):A}requestBkM(e,t,s,n){let r=e;const d=n.options;if(u.isBroadpeakDomainName(e,t.broadpeakDomainNames)&&!0===d.get(o.H1.REQUEST_BROADPEAK_CDN)||!0===d.get(o.H1.REQUEST_REDIRECT_THIRD_PARTY_CDN)){r=a.A.addOrReplaceParam(r,"response","200"),r=a.A.addOrReplaceParam(r,"bk-ml","1"),"string"==typeof s&&0!==s.length&&(r=a.A.addOrReplaceParam(r,"nanocdnhost",s)),!0===d.get(o.H1.SESSION_PRECACHE)&&(r=a.A.addOrReplaceParam(r,"bk-precache","1"));let h=null;return!0===n.diversitySession?.activated?h=l.A.diversityModule.DiversityRequestManager.getInstance().requestDiversitySession(e,u.CDN_REQUEST_TIMEOUT,t,n):(u.isBroadpeakDomainName(e,t.broadpeakDomainNames)?i.g.d(c,"Sending request to the BkM/umbrella: "+r,n.id):i.g.d(c,"Sending request to third party CDN: "+r,n.id),h=this.getRedirectionLocation(r,u.CDN_REQUEST_TIMEOUT,t,n)),h.then((s=>(u.isBroadpeakDomainName(e,t.broadpeakDomainNames)?i.g.d(c,"BkM/umbrella responded with status code "+s.httpStatus,n.id):i.g.d(c,"Third party CDN responded with status code "+s.httpStatus,n.id),this.parseCDNTiming(s,n),n.sessionReport.cdnStatusCode=s.httpStatus,s.httpStatus>=200&&s.httpStatus<400?""!==s.redirectedURL?o.Sy.success(s.redirectedURL):o.Sy.error(o.Sy.RESULT_CDN_RESPONSE_UNREADABLE,this.getBkMDetailedErrorMessage(s,n)):s.httpStatus<=0?o.Sy.error(o.Sy.RESULT_CDN_RESPONSE_UNREADABLE):s.httpStatus>=400&&s.httpStatus<500?o.Sy.error(o.Sy.RESULT_REQUESTED_URL_NOT_FOUND_ON_CDN,this.getBkMDetailedErrorMessage(s,n)):s.httpStatus>=500&&s.httpStatus<600?o.Sy.error(o.Sy.RESULT_REQUESTED_URL_CDN_ERROR,this.getBkMDetailedErrorMessage(s,n)):o.Sy.error(o.Sy.RESULT_NO_STREAMING_URL_FOUND,this.getBkMDetailedErrorMessage(s,n))))).then((e=>(e.isError()&&(n.sessionReport.cdnStatusCode=e.getDetailedErrorCode()),e)))}return Promise.resolve(o.Sy.success(r))}parseCDNTiming(e,t){const s=e.headers[u.HEADER_CDN_TIMING];if(void 0!==s&&"string"==typeof s)for(const e of s.split(";"))if(e.startsWith("bpkhttpserver,")){let s=e;try{let s=parseInt(e.split(",")[1],10);if(!isNaN(s))return i.g.d(c,"bpkhttpserver response timing: "+s+"ms",t.id),void(t.sessionReport.bpkhttpserverTiming=s)}catch(e){}return void i.g.e(c,"BkM/umbrella is providing a bpkhttpserver response timing but it cannot be parsed ("+s+")",t.id)}i.g.d(c,"BkM/umbrella is not providing a response timing",t.id)}getBkMDetailedErrorMessage(e,t){if(!0===e.headers.hasOwnProperty(u.HEADER_CDN_DETAILED_ERROR_CODE)){const s=e.headers[u.HEADER_CDN_DETAILED_ERROR_CODE];return i.g.d(c,"Reading detailed error code from header: "+s,t.id),s}return i.g.d(c,"Reading detailed error code from http status: "+e.httpStatus+" "+e.httpMessage,t.id),String(e.httpStatus+" "+e.httpMessage)}requestBkYou(e,t,s,n,r){s.simidControllerAdapter?.attachSession(s);const d=void 0!==s.adSession?.adDataListener;let l=a.A.addOrReplaceParam(e.url,"bk-ml","1.0");if(!1===s.options.get(o.H1.REQUEST_BKYOU_IF_BROADPEAK_CDN)&&n&&!d)return s.adTrackingManager?.initBkYouSession(l,void 0,{},r,r?.getNonce()),e;let h=a.A.addOrReplaceParam(e.url,"bk-ml",d?"2.0":"1.0");return this.adTracking(s,t,h,!1).then((t=>{if(!(t.httpStatus>=200&&t.httpStatus<300))return i.g.d(c,"BkYou response unreadable (status code), falling back to legacy mode",s.id),s.adTrackingManager?.notifyAdDataListener(!0),e;{let o;!n&&t.responseURL&&(i.g.d(c,"Using BkYou redirection: "+t.responseURL,s.id),e.url=t.responseURL);try{o=JSON.parse(t.content)}catch(t){return i.g.d(c,"BkYou file unreadable (parsing), falling back to legacy mode",s.id),s.adTrackingManager?.notifyAdDataListener(!0),e}const d=o.sessiontoken;if(void 0===d)return e;i.g.d(c,"BkYou session token: "+d,s.id);const h=o.playbackqueries;Array.isArray(h)&&h.forEach((t=>{if(-1!==t.indexOf("=")){const s=t.split("=");e.url=a.A.addOrReplaceParam(e.url,s[0],s[1]),l=a.A.addOrReplaceParam(l,s[0],s[1])}})),s.adTrackingManager?.initBkYouSession(l,d,o,r,r?.getNonce())}return e}))}getRedirectionLocation(e,t,s,n){return new Promise(((o,d)=>{let l=this.getHeaders(s);l.Connection="close";let h=r.A.getInstance().asyncGet(e,l,t,(t=>{let s=0,r="";void 0!==t.statusCode&&(s=parseInt(t.statusCode,10)),void 0!==t.headers&&void 0!==t.headers.location?r=t.headers.location:s>=200&&s<400&&i.g.e(c,'Location header cannot be read, please ensure "Access-Control-Expose-Headers: Location" is configured.',n.id),a.A.isValidUrl(r)&&a.A.isRelativeUrl(r)&&(i.g.i(c,"Redirected URL is relative, patching to absolute URL",n.id),r=a.A.patchRelativeUrl(r,e)),o({httpStatus:s,httpMessage:t.message,headers:t.headers,redirectedURL:r})}));n.jobs.push(h)}))}requestSession(e,t,s,a){const n=t.sessionReport;let d=n.redirectedURL;const l=d.indexOf("?");l>0&&(d=d.substring(0,l)),d.endsWith("/")||(d+="/"),d+=e;const h=t.options.get(o.H1.SESSION_REPORTING_MODE),E=h===o.H1.SESSION_REPORTING_MODE_DEFAULT||h===o.H1.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN;return!0===E?(d+="?",void 0!==n.timeline&&n.gdpr!==o.H1.GDPR_DELETE&&(d+=u.TEARDOWN_TIMELINE_QUERY+n.timeline.data().base64()+"&"),d+=u.TEARDOWN_METRICS_QUERY+n.toQuery(),!0===t.isPrecached()&&(d+="&precache="+(!0===t.sessionReport.precacheEnded?0:1)),i.g.i(c,"Sending session request using method "+a+" with metrics to "+d,t.id)):i.g.i(c,"Sending session request using method "+a+" without metrics to "+d,t.id),new Promise(((o,l)=>{let h=this.getHeaders(s);const g=n=>{i.g.i(c,"Send session request ends with status code: "+n.statusCode,t.id);let r="";void 0!==n.body&&(r=n.body),"POST"===a&&(n.statusCode<200||n.statusCode>=300)?this.requestSession(e,t,s,"GET").then((e=>{o({httpStatus:e.httpStatus,body:e.body,method:"GET"})})):o({httpStatus:n.statusCode,body:r,method:a})};if("GET"===a)r.A.getInstance().asyncGet(d,h,u.BKS_REQUEST_TIMEOUT,g);else if("POST"===a){h["Content-Type"]="application/json";let e="";!0===E&&(e=JSON.stringify({Player:n.toEndSessionJSON()})),i.g.v(c,"Executing POST request with body: "+e),r.A.getInstance().asyncPost(d,h,e,u.BKS_REQUEST_TIMEOUT,g)}}))}keepalive(e,t,s){return this.requestSession(u.KEEPALIVE_PATH,e,t,s)}teardown(e,t,s){const i=u.TEARDOWN_PATH+e.sessionReport.statusCode;return this.requestSession(i,e,t,s)}adEvent(e,t){let s=this.getHeaders();const a=e.options.get(o.H1.USERAGENT_AD_EVENT);void 0!==a&&(s["User-Agent"]=a),r.A.getInstance().asyncGet(t,s,2e4,(t=>{i.g.i(c,"Ad event request ends with status code: "+t.statusCode,e.id)}))}adTracking(e,t,s,a=!1){return i.g.d(c,"Sending request to the BkYou (async:"+a+"): "+s,e.id),new Promise(((t,n)=>{let o=this.getHeaders();if(!1===a){let a=r.A.getInstance().asyncGet(s,o,u.BKS_REQUEST_TIMEOUT,(s=>{i.g.d(c,"BkYou responded with status code "+s.statusCode,e.id),t({httpStatus:s.statusCode,content:s.body,responseURL:s.responseURL})}));e.jobs.push(a)}else r.A.getInstance().asyncGet(s,o,u.BKS_REQUEST_TIMEOUT,(s=>{i.g.d(c,"BkYou responded with status code "+s.statusCode,e.id),t({httpStatus:s.statusCode,content:s.body,responseURL:s.responseURL})}))}))}static isBroadpeakDomainName(e,t){if(null===t||""===t)return!1;if("*"===t)return!0;const s=a.A.parseURL(e);if(null!==s&&null!==s.hostname){return t.split(",").indexOf(s.hostname)>=0}return!1}}},7418:function(e,t,s){s.d(t,{E:function(){return d},q:function(){return l}});var i=s(6506),a=s(8379),n=s(1134),r=s(7832);const o="BpkKeepAliveMgr";class d{handler;active;delay;job;constructor(e){this.handler=e,this.active=!0,this.delay=e.options.get(r.H.SESSION_KEEPALIVE_FREQUENCY)}start(){this.job=n.A.getInstance().asyncDelay(this.delay,(()=>{this.process()}))}callback(e,t=!0){a.g.e(o,"callback method should be overridden")}process(e=!0){if(this.active){this.handler.notifyKeepaliveSessionReportRequested(this.handler.sessionReport),this.handler.sessionReport.keepaliveRequestDate=Date.now();const t={userAgent:this.handler.smartLib.getParameters().userAgent};this.callback(t,e)}}next(e=!0){this.job=n.A.getInstance().asyncDelay(this.delay,(()=>{this.process()}))}stop(){this.active=!1,n.A.getInstance().cancel(this.job)}isActive(){return this.active}}class l extends d{method;constructor(e){super(e),this.method="POST",a.g.d(o,"Using Broadpeak CDN keepalive manager...",this.handler.id)}callback(e,t=!0){i.A.getInstance().keepalive(this.handler,e,this.method).then((e=>{if(this.method=e.method,e.httpStatus>0&&(e.httpStatus<200||e.httpStatus>=300))a.g.d(o,"Stopping keepalive...",this.handler.id),this.stop();else{let s="";try{s=JSON.parse(e.body.trim())}catch(t){s=e.body.trim()}this.handler.notifyKeepaliveRequestEnded(e.httpStatus,s),!0===t&&this.next()}}))}}},7832:function(e,t,s){s.d(t,{H:function(){return r}});var i=s(8379),a=s(6506);const n="BpkStreamingSessionOptions";class r{static MULTICAST_ONLY=0;static ULTRA_LOW_LATENCY_SUPPORT=1;static PIP_SESSION=2;static GDPR_PREFERENCE=3;static REQUEST_REDIRECT_THIRD_PARTY_CDN=100;static REQUEST_DIVERSITY=101;static REQUEST_NANO_CDN=102;static REQUEST_BROADPEAK_CDN=103;static REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI=104;static REQUEST_NANO_CDN_DURING_GET_QUERY=106;static REQUEST_BKYOU_IF_BROADPEAK_CDN=107;static REQUEST_NANO_CDN_PRIORITY=108;static SESSION_KEEPALIVE=200;static SESSION_TEARDOWN=201;static SESSION_REPORTING_MODE=202;static SESSION_KEEPALIVE_FREQUENCY=203;static SESSION_PRECACHE=204;static USERAGENT_AD_EVENT=300;static TIMEOUT_NANO_CDN_REQUEST_ROUTER=500;static TIMEOUT_NANO_CDN_STATIC_RESOLVING=501;static TIMEOUT_NANO_CDN_DISCOVER_RESOLVING=502;static PRIORITY_NANO_CDN_CONF=600;static PRIORITY_APP_CONF=601;static PRIORITY_LOAD_BALANCING=602;static EXPERIMENTAL_METRICS_LATENCY=900;static LEGACY_MULTICAST_ONLY=1e3;static SESSION_DISABLED=-1;static SESSION_ENABLED_IF_BROADPEAK_DOMAIN=0;static SESSION_ENABLED=1;static SESSION_REPORTING_MODE_DEFAULT=0;static SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN=1;static SESSION_REPORTING_MODE_METRICS_RECEIVER=2;static SESSION_REPORTING_MODE_DISABLED=-1;static MULTICAST_UNKNOWN=-1;static MULTICAST_INACTIVE=0;static MULTICAST_INACTIVE_WAS_ACTIVE=1;static MULTICAST_ACTIVE=2;static GDPR_DELETE=1;static GDPR_ANONYMIZED=2;static GDPR_ENCRYPTED=3;static GDPR_CLEAR=4;options;updates;constructor(){this.options={},this.options[r.MULTICAST_ONLY]=!1,this.options[r.ULTRA_LOW_LATENCY_SUPPORT]=!1,this.options[r.PIP_SESSION]=!1,this.options[r.GDPR_PREFERENCE]=r.GDPR_CLEAR,this.options[r.REQUEST_REDIRECT_THIRD_PARTY_CDN]=!1,this.options[r.REQUEST_DIVERSITY]=!1,this.options[r.REQUEST_NANO_CDN]=!0,this.options[r.REQUEST_BROADPEAK_CDN]=!0,this.options[r.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI]=!0,this.options[r.REQUEST_NANO_CDN_DURING_GET_QUERY]=!0,this.options[r.REQUEST_BKYOU_IF_BROADPEAK_CDN]=!1,this.options[r.REQUEST_NANO_CDN_PRIORITY]=r.PRIORITY_NANO_CDN_CONF,this.options[r.SESSION_KEEPALIVE]=r.SESSION_ENABLED_IF_BROADPEAK_DOMAIN,this.options[r.SESSION_TEARDOWN]=r.SESSION_ENABLED_IF_BROADPEAK_DOMAIN,this.options[r.SESSION_REPORTING_MODE]=r.SESSION_REPORTING_MODE_DEFAULT,this.options[r.SESSION_KEEPALIVE_FREQUENCY]=a.A.KEEPALIVE_REQUEST_INTERVAL,this.options[r.SESSION_PRECACHE]=!1,this.options[r.USERAGENT_AD_EVENT]=void 0,this.options[r.TIMEOUT_NANO_CDN_REQUEST_ROUTER]=2e3,this.options[r.TIMEOUT_NANO_CDN_STATIC_RESOLVING]=3e3,this.options[r.TIMEOUT_NANO_CDN_DISCOVER_RESOLVING]=3e3,this.options[r.EXPERIMENTAL_METRICS_LATENCY]=!1,this.options[r.LEGACY_MULTICAST_ONLY]=!1,this.updates=[]}static create(e=void 0,t=void 0){const s=new r;return e instanceof r&&(s.options={...e.options}),void 0!==t&&t.updates.forEach((e=>{s.options[e]=t.options[e]})),s}option(e,t){return this.validate(e,t)&&(this.options[e]=t,e===r.PIP_SESSION&&!0===t&&this.option(r.REQUEST_NANO_CDN,!1),-1===this.updates.indexOf(e)&&this.updates.push(e)),this}get(e){const t=[r.USERAGENT_AD_EVENT];return void 0===this.options[e]&&-1===t.indexOf(e)&&i.g.w(n,"Warning: get option "+e+" not found"),this.options[e]}set(e,t){this.option(e,t)}validate(e,t){if(e===r.SESSION_REPORTING_MODE)return t===r.SESSION_REPORTING_MODE_DEFAULT||t===r.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN||t===r.SESSION_REPORTING_MODE_METRICS_RECEIVER||t===r.SESSION_REPORTING_MODE_DISABLED||(i.g.e(n,"Error: SESSION_REPORTING_MODE should be SESSION_REPORTING_MODE_DEFAULT, SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN, SESSION_REPORTING_MODE_METRICS_RECEIVER or SESSION_REPORTING_MODE_DISABLED"),!1);if(e===r.SESSION_KEEPALIVE||e===r.SESSION_TEARDOWN)return t===r.SESSION_DISABLED||t===r.SESSION_ENABLED_IF_BROADPEAK_DOMAIN||t===r.SESSION_ENABLED||(i.g.e(n,"Error: "+r.optionToString(e)+" value should be SESSION_ENABLED_IF_BROADPEAK_DOMAIN, SESSION_DISABLED or SESSION_ENABLED"),!1);if(e===r.SESSION_KEEPALIVE_FREQUENCY)return"number"==typeof t&&t>=5e3&&t<=6e4||(i.g.e(n,"Error: "+r.optionToString(e)+" value should be a number within 5000ms and 60000ms"),!1);if(e===r.USERAGENT_AD_EVENT)return"string"==typeof t||void 0===t||(i.g.e(n,"Error: "+r.optionToString(e)+" value should be a string or undefined"),!1);if(e===r.GDPR_PREFERENCE)return"number"==typeof t&&t>=1&&t<=4||(i.g.e(n,"Error: "+r.optionToString(e)+" value should be a number within 1 and 4"),!1);if(e>=r.TIMEOUT_NANO_CDN_REQUEST_ROUTER&&e<=r.TIMEOUT_NANO_CDN_DISCOVER_RESOLVING)return"number"==typeof t||(i.g.e(n,"Error: "+r.optionToString(e)+" value should be a number"),!1);if(e===r.REQUEST_NANO_CDN_PRIORITY)return t>=r.PRIORITY_NANO_CDN_CONF&&t<=r.PRIORITY_LOAD_BALANCING||(i.g.e(n,"Error: "+r.optionToString(e)+" value should be PRIORITY_NANO_CDN_CONF, PRIORITY_APP_CONF or PRIORITY_LOAD_BALANCING"),!1);if(void 0===e)return i.g.e(n,"Error: option should not be undefined"),!1;const s="boolean"==typeof t;return s||i.g.e(n,"Error: "+r.optionToString(e)+" value should be a boolean"),s}print(e=n,t="",s){i.g.i(e,t+"Options",s),i.g.i(e,t+"   MULTICAST_ONLY="+this.get(r.MULTICAST_ONLY),s),i.g.i(e,t+"   LEGACY_MULTICAST_ONLY="+this.get(r.LEGACY_MULTICAST_ONLY),s),i.g.i(e,t+"   REQUEST_REDIRECT_THIRD_PARTY_CDN="+this.get(r.REQUEST_REDIRECT_THIRD_PARTY_CDN),s),i.g.i(e,t+"   REQUEST_DIVERSITY="+this.get(r.REQUEST_DIVERSITY),s),i.g.i(e,t+"   REQUEST_NANO_CDN="+this.get(r.REQUEST_NANO_CDN),s),i.g.i(e,t+"   REQUEST_NANO_CDN_DURING_GET_QUERY="+this.get(r.REQUEST_NANO_CDN_DURING_GET_QUERY),s),i.g.i(e,t+"   REQUEST_BROADPEAK_CDN="+this.get(r.REQUEST_BROADPEAK_CDN),s),i.g.i(e,t+"   REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI="+this.get(r.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI),s),i.g.i(e,t+"   REQUEST_BKYOU_IF_BROADPEAK_CDN="+this.get(r.REQUEST_BKYOU_IF_BROADPEAK_CDN),s),i.g.i(e,t+"   REQUEST_NANO_CDN_PRIORITY="+r.nanoCDNPriorityToString(this.get(r.REQUEST_NANO_CDN_PRIORITY)),s),i.g.i(e,t+"   SESSION_KEEPALIVE="+r.stateToString(this.get(r.SESSION_KEEPALIVE)),s),i.g.i(e,t+"   SESSION_KEEPALIVE_FREQUENCY="+this.get(r.SESSION_KEEPALIVE_FREQUENCY)+"ms",s),i.g.i(e,t+"   SESSION_TEARDOWN="+r.stateToString(this.get(r.SESSION_TEARDOWN)),s),i.g.i(e,t+"   SESSION_REPORTING_MODE="+r.reportingModeToString(this.get(r.SESSION_REPORTING_MODE)),s),i.g.i(e,t+"   SESSION_PRECACHE="+this.get(r.SESSION_PRECACHE),s),i.g.i(e,t+"   TIMEOUT_NANO_CDN_REQUEST_ROUTER="+this.get(r.TIMEOUT_NANO_CDN_REQUEST_ROUTER)+"ms",s),void 0!==this.get(r.USERAGENT_AD_EVENT)&&i.g.i(e,t+"   USERAGENT_AD_EVENT="+this.get(r.USERAGENT_AD_EVENT),s),i.g.i(e,t+"   PIP_SESSION="+this.get(r.PIP_SESSION),s),i.g.i(e,t+"   ULTRA_LOW_LATENCY_SUPPORT="+this.get(r.ULTRA_LOW_LATENCY_SUPPORT),s),i.g.i(e,t+"   GDPR_PREFERENCE="+this.get(r.GDPR_PREFERENCE),s)}printUpdates(e=n,t="",s){this.updates.forEach((a=>{i.g.i(e,t+"   "+r.optionToString(a)+"="+r.valueToString(a,this.get(a)),s)}))}static optionToString(e){switch(e){case this.MULTICAST_ONLY:return"MULTICAST_ONLY";case this.PIP_SESSION:return"PIP_SESSION";case this.ULTRA_LOW_LATENCY_SUPPORT:return"ULTRA_LOW_LATENCY_SUPPORT";case this.GDPR_PREFERENCE:return"GDPR_PREFERENCE";case this.REQUEST_REDIRECT_THIRD_PARTY_CDN:return"REQUEST_REDIRECT_THIRD_PARTY_CDN";case this.REQUEST_DIVERSITY:return"REQUEST_DIVERSITY";case this.REQUEST_NANO_CDN:return"REQUEST_NANO_CDN";case this.REQUEST_BROADPEAK_CDN:return"REQUEST_BROADPEAK_CDN";case this.REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI:return"REQUEST_LOCAL_NANO_CDN_IF_CONNECTED_TO_WIFI";case this.REQUEST_NANO_CDN_DURING_GET_QUERY:return"REQUEST_NANO_CDN_DURING_GET_QUERY";case this.REQUEST_BKYOU_IF_BROADPEAK_CDN:return"REQUEST_BKYOU_IF_BROADPEAK_CDN";case this.REQUEST_NANO_CDN_PRIORITY:return"REQUEST_NANO_CDN_PRIORITY";case this.SESSION_KEEPALIVE:return"SESSION_KEEPALIVE";case this.SESSION_TEARDOWN:return"SESSION_TEARDOWN";case this.SESSION_REPORTING_MODE:return"SESSION_REPORTING_MODE";case this.SESSION_KEEPALIVE_FREQUENCY:return"SESSION_KEEPALIVE_FREQUENCY";case this.SESSION_PRECACHE:return"SESSION_PRECACHE";case this.USERAGENT_AD_EVENT:return"USERAGENT_AD_EVENT";case this.TIMEOUT_NANO_CDN_REQUEST_ROUTER:return"TIMEOUT_NANO_CDN_REQUEST_ROUTER";case this.TIMEOUT_NANO_CDN_STATIC_RESOLVING:return"TIMEOUT_NANO_CDN_STATIC_RESOLVING";case this.TIMEOUT_NANO_CDN_DISCOVER_RESOLVING:return"TIMEOUT_NANO_CDN_DISCOVER_RESOLVING";case this.PRIORITY_NANO_CDN_CONF:return"PRIORITY_NANO_CDN_CONF";case this.PRIORITY_APP_CONF:return"PRIORITY_APP_CONF";case this.PRIORITY_LOAD_BALANCING:return"PRIORITY_LOAD_BALANCING";case this.LEGACY_MULTICAST_ONLY:return"LEGACY_MULTICAST_ONLY"}return"unknown"}static valueToString(e,t){switch(e){case this.SESSION_KEEPALIVE:case this.SESSION_TEARDOWN:return this.stateToString(t);case this.SESSION_REPORTING_MODE:return this.reportingModeToString(t);case this.REQUEST_NANO_CDN_PRIORITY:return this.nanoCDNPriorityToString(t)}return String(t)}static stateToString(e){switch(e){case r.SESSION_DISABLED:return"disabled";case r.SESSION_ENABLED_IF_BROADPEAK_DOMAIN:return"enabled if broadpeak domain name";case r.SESSION_ENABLED:return"enabled"}return"unknown"}static reportingModeToString(e){switch(e){case r.SESSION_REPORTING_MODE_DEFAULT:return"default";case r.SESSION_REPORTING_MODE_KEEPALIVE_TEARDOWN:return"keepalive/teardown";case r.SESSION_REPORTING_MODE_METRICS_RECEIVER:return"metricsReceiver";case r.SESSION_REPORTING_MODE_DISABLED:return"disabled"}return"unknown"}static nanoCDNPriorityToString(e){switch(e){case r.PRIORITY_NANO_CDN_CONF:return"nanoCDN conf";case r.PRIORITY_APP_CONF:return"init order";case r.PRIORITY_LOAD_BALANCING:return"load balancing"}return"unknown"}}},7964:function(e,t,s){s.d(t,{A:function(){return i}});class i{static REGEX_IP="^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}(:[0-9]+)?$";static REGEX_HOSTNAME="^([A-Za-z0-9\\_\\-\\.]+)(:[0-9]+)?$";static REGEX_TICKET="^[0-5a-z]{30,50}$";static REGEX_TICKET_TRANSCODED="^.*@[0-5a-z]{30,50}$";static parseURL(e){if(!this.isValidUrl(e))return null;const t=e.match("^(https?)\\:\\/\\/(([^:\\/?#]*)(?:\\:([0-9]+))?)([\\/]{0,1}[^?#]*)(\\?[^#]*|)(#.*|)$"),s=t&&{href:e,protocol:t[1],host:t[2],hostname:t[3],port:t[4],path:t[5],query:t[6],hash:t[7]};return null!==s&&null!==s.query&&s.query.length>0&&(s.query=s.query.substring(1)),s}static getParam(e,t){if(!this.isValidUrl(e))return"";t=t.replace(/[\[\]]/g,"\\$&");const s=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return s&&s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):""}static addOrReplaceParam(e,t,s){let i=e.indexOf("?"+t+"=");if(i<0&&(i=e.indexOf("&"+t+"=")),i>=0){const i=e.substring(0,e.indexOf(t));let a=e.substring(e.indexOf(t));return a=a.indexOf("&")>=0?a.substring(a.indexOf("&")):"",i+t+"="+s+a}return(e.indexOf("?")<0?e+"?":e+"&")+t+"="+s}static extractHostnamePort(e){let t;return this.isValidUrl(e)?(t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t=t.split("?")[0],t):""}static extractProtocol(e){return this.isValidUrl(e)?e.split("://")[0]:""}static isValidUrl(e){return null!==e&&""!==e&&void 0!==e}static isRelativeUrl(e){return e.startsWith("/")||e.startsWith("../")}static patchRelativeUrl(e,t){const s=this.parseURL(t);let i=s.path;if(e.startsWith("../")){i=i.slice(0,i.lastIndexOf("/")+1)+e;let t=[];i.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,(function(e){"/.."===e?t.pop():t.push(e)})),i=t.join("").replace(/^\//,"/")}else i=e;return s.protocol+"://"+s.host+i}static replaceHostnameAndPort(e,t,s=void 0){return e.replace(/^(https?:\/\/)([^:/]+)(:\d+)?/,((e,i,a,n)=>`${i}${t}${s?`:${s}`:""}`))}}},8100:function(e,t,s){s.d(t,{A:function(){return R}});var i=s(1262);class a{log(e,t,s){const a=i.Em.formatDate();switch(e){case 0:console.log(a+" V/"+t+": "+s);break;case 1:console.log(a+" D/"+t+": "+s);break;case 2:console.log(a+" I/"+t+": "+s);break;case 3:console.log(a+" W/"+t+": "+s);break;case 4:console.log(a+" E/"+t+": "+s);break;default:console.log(a+" ?/"+t+": "+s)}}}const n="BpkRequestHandler";class r{get(e,t,s,a){const r=new XMLHttpRequest;let o=!1,d={};r.onreadystatechange=function(){if(r.readyState===r.DONE){const e=r.getAllResponseHeaders()?.trim().split(/[\r\n]+/);e?.forEach((function(e){let t=e.split(": "),s=t.shift().toLowerCase();d[s]=t.join(": ")})),r.status>=200&&r.status<300?a({body:r.responseText,headers:d,statusCode:r.status,message:r.statusText,responseURL:r.responseURL}):0!==r.status&&a({body:"",headers:d,statusCode:r.status,message:r.statusText})}},r.onerror=function(){o||(r.status<=0&&i.gD.e(n,"Request ended with error (CORS error, connection error...)"),a({body:"",headers:d,statusCode:r.status,message:r.statusText}))},r.ontimeout=function(){i.gD.d(n,"Request ended with timeout (xhr)"),a({body:"",headers:d,statusCode:r.status,message:r.statusText})},r.open("GET",e,!0),r.timeout=s,this.deleteUnsafeHeaders(t);for(let e in t)r.setRequestHeader(e,t[e]);r.send(),setTimeout((()=>{r.readyState!==r.DONE&&(o=!0,r.abort(),i.gD.d(n,"Request ended with timeout (setTimeout)"),a({body:"",headers:d,statusCode:r.status,message:r.statusText}))}),s+100)}post(e,t,s,a,r){const o=new XMLHttpRequest;let d=!1,l={};o.onreadystatechange=function(){if(o.readyState===o.DONE){const e=o.getAllResponseHeaders()?.trim().split(/[\r\n]+/);e?.forEach((function(e){let t=e.split(": "),s=t.shift().toLowerCase();l[s]=t.join(": ")})),o.status>=200&&o.status<300?r({body:o.responseText,headers:l,statusCode:o.status,message:o.statusText,responseURL:o.responseURL}):0!==o.status&&r({body:"",headers:l,statusCode:o.status,message:o.statusText})}},o.onerror=function(){d||(o.status<=0&&i.gD.e(n,"Request ended with error (CORS error, connection error...)"),r({body:"",headers:l,statusCode:o.status,message:o.statusText}))},o.ontimeout=function(){i.gD.d(n,"Request ended with timeout (xhr)"),r({body:"",headers:l,statusCode:o.status,message:o.statusText})},o.open("POST",e,!0),o.timeout=a,this.deleteUnsafeHeaders(t);for(let e in t)o.setRequestHeader(e,t[e]);o.send(s),setTimeout((()=>{o.readyState!==o.DONE&&(d=!0,o.abort(),i.gD.d(n,"Request ended with timeout (setTimeout)"),r({body:"",headers:l,statusCode:o.status,message:o.statusText}))}),a+100)}deleteUnsafeHeaders(e){"object"!=typeof window&&"function"!=typeof XMLHttpRequest||(delete e["User-Agent"],delete e["Accept-Charset"],delete e["Accept-Encoding"],delete e["Access-Control-Request-Headers"],delete e["Access-Control-Request-Method"],delete e.Connection,delete e["Content-Length"],delete e.Cookie,delete e.Cookie2,delete e.Date,delete e.DNT,delete e.Expect,delete e.Host,delete e["Keep-Alive"],delete e.Origin,delete e.Referer,delete e.TE,delete e.Trailer,delete e["Transfer-Encoding"],delete e.Upgrade,delete e.Via)}}var o=s(4623);const d="BpkBrowserAppStateMgr";class l{initialized;listeners;init(){i.gD.d(d,"Initializing browser app state manager..."),this.initialized||(i.CE.getInstance().setDeviceInfo(this.getOSName(),this.getOSVersion(),this.getDeviceType()),i.CE.getInstance().bind(),this.listeners={},"undefined"!=typeof window&&void 0===window.addEventListener&&i.gD.w(d,"Are you running a React Native app? If yes, please import module '@broadpeak/smartlib-react-native'"),this.registerNetworkObserver(),this.initialized=!0)}getOSName(){return"undefined"!=typeof device&&void 0!==device.platform?device.platform:"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.platform?window.navigator.platform:"NA"}getOSVersion(){let e;"undefined"!=typeof device&&void 0!==device.version?e=device.version:"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.appVersion&&(e=window.navigator.appVersion),void 0===e&&(e="");let t=e.replace(/ /g,"_").replace(/;/g,"_");return t.length>=30?t.substring(0,30):0===t.length?"NA":t}getDeviceType(){return"undefined"!=typeof cast&&void 0!==cast.receiver?"chromecast":"browser"}release(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}registerNetworkObserver(){this.listeners[0]=this.onNetworkOnline.bind(this),this.listeners[1]=this.onNetworkOffline.bind(this),"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.onLine&&(!0===window.navigator.onLine?i.CE.getInstance().notifyNetworkAvailable(1):i.CE.getInstance().notifyNetworkLost()),window.addEventListener("online",this.listeners[0]),window.addEventListener("offline",this.listeners[1])}unregisterNetworkObserver(){window.removeEventListener("online",this.listeners[0]),window.removeEventListener("offline",this.listeners[1]),this.listeners[0]=void 0,this.listeners[1]=void 0}onNetworkOnline(){i.CE.getInstance().notifyNetworkAvailable(1)}onNetworkOffline(){i.CE.getInstance().notifyNetworkLost()}registerLifecycleEvents(){this.listeners[2]=this.onMoveToForeground.bind(this),this.listeners[3]=this.onMoveToBackground.bind(this),window.addEventListener("focus",this.listeners[2]),window.addEventListener("blur",this.listeners[3])}unregisterLifecycleEvents(){window.removeEventListener("focus",this.listeners[2]),window.removeEventListener("blur",this.listeners[3]),this.listeners[2]=void 0,this.listeners[3]=void 0}onMoveToForeground(){i.CE.getInstance().notifyForeground()}onMoveToBackground(){i.CE.getInstance().notifyBackground()}}const c="BpkWebOSAppStateMgr";class h{initialized;subscriptionHandle;webOSVersion;init(){i.gD.d(c,"Initializing webOS app state manager..."),this.initialized||(this.webOSVersion="",webOS.deviceInfo((e=>{this.webOSVersion=e.sdkVersion,void 0!==this.webOSVersion?(i.gD.d(c,"Receiving sdk version through deviceInfo: "+this.webOSVersion),this.registerNetworkObserver(),i.CE.getInstance().setDeviceInfo("webOS",this.webOSVersion,"tv"),i.CE.getInstance().bind()):webOS.service.request("luna://com.webos.service.tv.systemproperty",{method:"getSystemInfo",parameters:{keys:["sdkVersion"]},onSuccess:e=>{void 0!==e.sdkVersion&&(this.webOSVersion=e.sdkVersion,i.gD.d(c,"Receiving sdk version through luna API: "+this.webOSVersion),this.registerNetworkObserver(),i.CE.getInstance().setDeviceInfo("webOS",this.webOSVersion,"tv"),i.CE.getInstance().bind())},onFailure:e=>{i.gD.d(c,"Error while receiving webOS version ("+JSON.stringify(e)+")")}})})),this.initialized=!0)}release(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}updateNetworkState(e){let t="yes"===e.wifi?.onInternet;!0===("yes"===e.wired?.onInternet)?i.CE.getInstance().notifyNetworkAvailable(30):!0===t?i.CE.getInstance().notifyNetworkAvailable(10):i.CE.getInstance().notifyNetworkLost()}registerNetworkObserver(){let e=this.webOSVersion.startsWith("3")?"luna://com.webos.service.connectionmanager":"luna://com.palm.connectionmanager";const t=this;webOS.service.request(e,{method:"getStatus",onSuccess:function(e){t.updateNetworkState(e)},onFailure:function(e){i.gD.e(c,"Failed to get network state"),i.gD.e(c,"["+e.errorCode+"]: "+e.errorText)}}),this.subscriptionHandle=webOS.service.request(e,{method:"getStatus",parameters:{subscribe:!0},onSuccess:function(e){void 0===e.subscribed||e.subscribed?t.updateNetworkState(e):i.gD.e(c,"Failed to subscribe network state")},onFailure:function(e){i.gD.e(c,"Failed to get network state"),i.gD.e(c,"["+e.errorCode+"]: "+e.errorText)}})}unregisterNetworkObserver(){void 0!==this.subscriptionHandle&&(this.subscriptionHandle.cancel(),this.subscriptionHandle=void 0)}}const u="BpkTizenAppStateMgr";class E{initialized;networkInitializer;networkInitializerNumber;listeners;init(){i.gD.d(u,"Initializing tizen app state manager..."),this.initialized||(i.CE.getInstance().setDeviceInfo("Tizen",this.getOSVersion(),"tv"),i.CE.getInstance().bind(),this.listeners={},this.startNetworkInitializer(),this.initialized=!0)}getOSVersion(){return"undefined"!=typeof tizen&&void 0!==tizen.systeminfo?tizen.systeminfo.getCapability("http://tizen.org/feature/platform.version"):"NA"}release(){this.initialized&&(this.unregisterNetworkObserver(),this.initialized=!1)}onNetworkChange(e){let t=null;try{t=webapis.network.getActiveConnectionType()}catch(e){i.gD.e(u,"getActiveConnectionType exception ["+e.code+"] message: "+e.message)}if(null!=t){switch(t){case webapis.network.NetworkActiveConnectionType.DISCONNECTED:i.CE.getInstance().notifyNetworkLost();break;case webapis.network.NetworkActiveConnectionType.WIFI:i.CE.getInstance().notifyNetworkAvailable(10);break;case webapis.network.NetworkActiveConnectionType.ETHERNET:i.CE.getInstance().notifyNetworkAvailable(30)}i.gD.d(u,"Active connection type: "+t)}}startNetworkInitializer(){void 0!==this.networkInitializer&&clearInterval(this.networkInitializer),this.networkInitializerNumber=0,this.networkInitializer=setInterval((()=>{void 0!==webapis.network?(i.gD.d(u,"Network API is now available"),clearInterval(this.networkInitializer),this.networkInitializer=void 0,this.registerNetworkObserver()):this.networkInitializerNumber>30?(i.gD.e(u,"The webapis.js script is required in order to get the network type."),clearInterval(this.networkInitializer),this.networkInitializer=void 0):this.networkInitializerNumber++}),100)}registerNetworkObserver(){void 0===webapis.network&&i.gD.e(u,"The webapis.js script is required in order to get the network type."),this.onNetworkChange(void 0);try{this.listeners[0]=webapis.network.addNetworkStateChangeListener(this.onNetworkChange)}catch(e){i.gD.e(u,"addNetworkStateChangeListener exception ["+e.code+"] name: "+e.name+" message: "+e.message)}}unregisterNetworkObserver(){try{webapis.network.removeNetworkStateChangeListener(this.listeners[0])}catch(e){i.gD.e(u,"removeNetworkStateChangeListener exception ["+e.code+"] name: "+e.name+" message: "+e.message)}this.listeners[0]=void 0}}class g extends i.r2{nonceManager;constructor(e){super(),this.nonceManager=e}getNonce(){return this.nonceManager.getNonce()}sendAdClick(){"function"==typeof this.nonceManager.sendAdClick&&this.nonceManager.sendAdClick()}sendAdImpression(){"function"==typeof this.nonceManager.sendAdImpression&&this.nonceManager.sendAdImpression()}sendPlaybackStart(){"function"==typeof this.nonceManager.sendPlaybackStart&&this.nonceManager.sendPlaybackStart()}sendPlaybackEnd(){"function"==typeof this.nonceManager.sendPlaybackEnd&&this.nonceManager.sendPlaybackEnd()}sendTouch(e){"function"==typeof this.nonceManager.sendAdTouch&&this.nonceManager.sendAdTouch(e)}}const S="BpkBrowserAdPalManager";class p extends i.GM{palSDK;consentSettings;nonceLoader;descriptionURL;partnerName;partnerVersion;omidVersion;playerType;playerVersion;ppid;videoPlayerHeight;videoPlayerWidth;willAdAutoPlay;willAdPlayMuted;constructor(){super()}loadPALSDK(){this.palSDK=i.X2.getInstance().palSDK}setConsentSettings(e){this.loadPALSDK(),void 0!==this.palSDK?(this.consentSettings=e,this.nonceLoader=new this.palSDK.pal.NonceLoader(e)):i.gD.e(S,"PAL SDK not attached, please set it through AdManager.getInstance().attachPALSDK(...)")}generateAdPalSession(e){if(void 0===this.nonceLoader||void 0===this.consentSettings)return i.gD.e(S,"Cannot generate a nonce, please set a ConsentSettings through AdManager.getInstance().setConsentSettings(...)"),void e(void 0);const t=new this.palSDK.pal.NonceRequest;void 0!==this.descriptionURL&&(t.descriptionUrl=this.descriptionURL),void 0!==this.partnerName&&(t.omidPartnerName=this.partnerName),void 0!==this.partnerVersion&&(t.omidPartnerVersion=this.partnerVersion),void 0!==this.omidVersion&&(t.omidVersion=this.omidVersion),void 0!==this.playerType&&(t.playerType=this.playerType),void 0!==this.playerVersion&&(t.playerVersion=this.playerVersion),void 0!==this.ppid&&(t.ppid=this.ppid),void 0!==this.videoPlayerHeight&&(t.videoHeight=this.videoPlayerHeight),void 0!==this.videoPlayerWidth&&(t.videoWidth=this.videoPlayerWidth),void 0!==this.willAdAutoPlay&&(t.adWillAutoPlay=this.willAdAutoPlay),void 0!==this.willAdPlayMuted&&(t.adWillPlayMuted=this.willAdPlayMuted),this.nonceLoader.loadNonceManager(t).then((t=>{const s=new g(t);e(s)})).catch((t=>{i.gD.e(S,"Error when generating the nonce"),console.log(t),e(void 0)}))}reset(){}release(){this.consentSettings=void 0,this.nonceLoader=void 0}setDescriptionURL(e){this.descriptionURL=e}setOmidPartner(e,t){this.partnerName=e,this.partnerVersion=t}setOmidVersion(e){this.omidVersion=e}setPlayerType(e){this.playerType=e}setPlayerVersion(e){this.playerVersion=e}setPpid(e){this.ppid=e}setVideoPlayerHeight(e){this.videoPlayerHeight=e}setVideoPlayerWidth(e){this.videoPlayerWidth=e}setWillAdAutoPlay(e){this.willAdAutoPlay=e}setWillAdPlayMuted(e){this.willAdPlayMuted=e}}class _{initialized;init(){i.gD.d("BpkNodeAppStateMgr","Initializing Node.js app state manager..."),this.initialized||(i.CE.getInstance().setDeviceInfo(this.getOSName(),this.getOSVersion(),this.getDeviceType()),i.CE.getInstance().bind(),this.initialized=!0)}getOSName(){return"undefined"!=typeof process?process.platform:"NA"}getOSVersion(){const e=(0,o.t)("os");return void 0!==e?e.release():"NA"}getDeviceType(){return"nodejs"}release(){this.initialized&&(this.initialized=!1)}}class A{static CLICK="click";static INVITATION_ACCEPTED="invitationAccept"}const N="BpkCoreEngine";class R{static#e;static modular=!0;static analyticsModule;static reactNativeModule;static omsdkModule;static simidModule;static shakaModule;static dashjsModule;static html5Module;static avplayModule;static diw387Module;static hbbtv1Module;static kalturaModule;static connectplayerModule;static rxplayerModule;static hlsjsModule;static bitmovinModule;static theoplayerModule;static videojsModule;static voplayerModule;static reactnativeconnectplayerModule;static reactnativetheoplayerModule;static chromecastModule;#t;#o;#d;#l;#c;#h;#u;#E;#g;#S;#p;static getInstance(){return R.#e||(R.#e=new R),R.#e}constructor(){this.#t=!1,this.#o=void 0,this.#d=new a}init(){if(!this.#t){this.#t=!0;const e=Date.now();this.log(i.$b.VERBOSE,N,"Loading engine..."),this.log(i.$b.VERBOSE,N,"Version: 66cccb4"),this.registerSystemFunctions(),"object"==typeof window?this.registerSmartLibFunctions(window):(this.registerSmartLibFunctions(),"undefined"==typeof XMLHttpRequest&&(s.g.XMLHttpRequest=(0,o.t)("xmlhttprequest").XMLHttpRequest)),this.log(i.$b.VERBOSE,N,"Took "+(Date.now()-e)+"ms to load")}}registerSystemFunctions(){this.log(i.$b.VERBOSE,N,"Registering system functions..."),i.gD.getInstance().init(this.#d),i.Je.getInstance().init(new r),i.x6.getInstance().internalAdManager.setPalManager(new p)}registerPlayerAdapters(){void 0!==R.analyticsModule&&(this.#l=new R.analyticsModule.PlayerManagerHandler,"object"==typeof window&&(window.PlayerEventListener=R.analyticsModule.PlayerEventListener,window.GenericPlayerApi=R.analyticsModule.GenericPlayerApi))}registerSimidControllerAdapters(){"object"==typeof window&&(window.GenericSimidControllerApi=R.simidModule.GenericSimidControllerApi)}loadModules(){"object"==typeof window?(i.x6.analyticsModule=this.getBrowserModule("analyticsSmartLibModule","Analytics",i.x6.analyticsModule),i.x6.adModule=this.getBrowserModule("adSmartLibModule","Ad",i.x6.adModule),i.x6.nanoCDNModule=this.getBrowserModule("nanocdnSmartLibModule","nanoCDN",i.x6.nanoCDNModule),i.x6.diversityModule=this.getBrowserModule("diversitySmartLibModule","Diversity",i.x6.diversityModule),i.x6.monitoringModule=this.getBrowserModule("monitoringSmartLibModule","Monitoring",i.x6.monitoringModule),R.reactNativeModule=this.getBrowserModule("reactnativeSmartLibModule","React Native",R.reactNativeModule),R.omsdkModule=this.getBrowserModule("omsdkModuleSmartLibModule","OMSDK",R.omsdkModule),void 0!==R.omsdkModule&&(window.OMSDKHandler=R.omsdkModule.OMSDKHandler),R.simidModule=this.getBrowserModule("simidSmartLibModule","SIMID",R.simidModule),R.shakaModule=this.getBrowserModule("shakaSmartLibModule","Shaka Player",R.shakaModule),void 0!==R.shakaModule&&(window.ShakaPlayerAdapter=R.shakaModule.ShakaPlayerAdapter),R.dashjsModule=this.getBrowserModule("dashjsSmartLibModule","Dash.js",R.dashjsModule),void 0!==R.dashjsModule&&(window.DashJsPlayerAdapter=R.dashjsModule.DashJsPlayerAdapter),R.html5Module=this.getBrowserModule("html5SmartLibModule","HTML5 player",R.html5Module),R.avplayModule=this.getBrowserModule("avplaySmartLibModule","AVPlay",R.avplayModule),R.diw387Module=this.getBrowserModule("diw387SmartLibModule","Sagemcom",R.diw387Module),R.hbbtv1Module=this.getBrowserModule("hbbtv1SmartLibModule","HbbTV1",R.hbbtv1Module),R.kalturaModule=this.getBrowserModule("kalturaSmartLibModule","Kaltura",R.kalturaModule),R.connectplayerModule=this.getBrowserModule("connectplayerSmartLibModule","CONNECT Player",R.connectplayerModule),void 0!==R.connectplayerModule&&(window.ConnectPlayerAdapter=R.connectplayerModule.ConnectPlayerAdapter),R.rxplayerModule=this.getBrowserModule("rxplayerSmartLibModule","RxPlayer",R.rxplayerModule),R.hlsjsModule=this.getBrowserModule("hlsjsModule","HLS.js",R.hlsjsModule),R.bitmovinModule=this.getBrowserModule("bitmovinModule","Bitmovin",R.bitmovinModule),R.theoplayerModule=this.getBrowserModule("theoplayerModule","THEOplayer",R.theoplayerModule),void 0!==R.theoplayerModule&&(window.THEOPlayerAdapter=R.theoplayerModule.THEOPlayerAdapter),R.videojsModule=this.getBrowserModule("videojsSmartLibModule","Video.js",R.videojsModule),void 0!==R.videojsModule&&(window.VideoJsPlayerAdapter=R.videojsModule.VideoJsPlayerAdapter),R.voplayerModule=this.getBrowserModule("voplayerModule","VOPlayer",R.voplayerModule),R.reactnativeconnectplayerModule=this.getBrowserModule("reactnativeconnectplayerModule","React Native CONNECT Player",R.reactnativeconnectplayerModule),R.reactnativetheoplayerModule=this.getBrowserModule("reactnativetheoplayerModule","React Native THEOplayer",R.reactnativetheoplayerModule),R.chromecastModule=this.getBrowserModule("chromecastModule","Chromecast",R.chromecastModule)):!0===R.modular&&(i.x6.analyticsModule=this.getNodeModule("analytics","Analytics"),i.x6.adModule=this.getNodeModule("ad","Ad"),i.x6.nanoCDNModule=this.getNodeModule("nanocdn","nanoCDN"),i.x6.diversityModule=this.getNodeModule("diversity","Diversity"),i.x6.monitoringModule=this.getNodeModule("monitoring","Monitoring"),R.reactNativeModule=this.getNodeModule("reactnative","React Native"),R.omsdkModule=this.getNodeModule("omsdkModule","OMSDK"),R.simidModule=this.getNodeModule("simid","SIMID"),R.shakaModule=this.getNodeModule("shaka","Shaka Player"),R.dashjsModule=this.getNodeModule("dashjs","Dash.js"),R.html5Module=this.getNodeModule("html5","HTML5 player"),R.avplayModule=this.getNodeModule("avplay","AVPlay"),R.diw387Module=this.getNodeModule("diw387","Sagemcom"),R.hbbtv1Module=this.getNodeModule("hbbtv1","HbbTV1"),R.kalturaModule=this.getNodeModule("kaltura","Kaltura"),R.connectplayerModule=this.getNodeModule("connectplayer","CONNECT Player"),R.rxplayerModule=this.getNodeModule("rxplayer","RxPlayer"),R.hlsjsModule=this.getNodeModule("hlsjs","HLS.js"),R.bitmovinModule=this.getNodeModule("bitmovin","Bitmovin"),R.theoplayerModule=this.getNodeModule("theoplayer","THEOplayer"),R.videojsModule=this.getNodeModule("videojs","Video.js"),R.voplayerModule=this.getNodeModule("voplayer","VOPlayer"),R.reactnativeconnectplayerModule=this.getNodeModule("reactnativeconnectplayer","React Native CONNECT Player"),R.reactnativetheoplayerModule=this.getNodeModule("reactnativetheoplayer","React Native THEOplayer"),R.chromecastModule=this.getNodeModule("chromecast","Chromecast")),void 0!==this.#o&&void 0!==i.x6.monitoringModule&&(this.#o.RealTimeMonitoringManager=i.x6.monitoringModule.RealTimeMonitoringManager)}getBrowserModule(e,t,s){if(void 0!==s)return i.gD.i(N,t+" module loaded (from index)"),s;i.gD.i(N,t+" module not loaded")}getNodeModule(e,t){try{const s=(0,o.C)("@broadpeak/smartlib-"+e);return i.gD.i(N,t+" module loaded"),s}catch(s){try{const s=nativeRequire("./"+e+".smartlib.browser");return LoggerManager.i(N,t+" module loaded"),s}catch(e){LoggerManager.i(N,t+" module not loaded")}}}registerSmartLibFunctions(e){const t=this;this.#o=e;const s=function(){"undefined"!=typeof webOS?(void 0===t.#E&&(t.#E=new h),t.#E.init()):"undefined"!=typeof tizen&&"undefined"!=typeof webapis?(void 0===t.#g&&(t.#g=new E),t.#g.init()):"undefined"!=typeof sagem||(void 0!==R.reactNativeModule?.ReactNativeAppStateManager.platform?(void 0===t.#p&&(t.#p=new R.reactNativeModule.ReactNativeAppStateManager),t.#p.init()):"undefined"!=typeof window?(void 0===t.#u&&(t.#u=new l),t.#u.init()):"undefined"!=typeof process&&"node"===process.release.name&&(void 0===t.#S&&(t.#S=new _),t.#S.init())),t.loadModules(),void 0!==t.#p?t.#h=new R.reactNativeModule.ReactNativeCacheHandler(R.reactNativeModule.ReactNativeAppStateManager.asyncCache):void 0!==R.analyticsModule&&(t.#h=new R.analyticsModule.CacheHandler),i.x6.analyticsModule?.CacheManager.getInstance().init(t.#h),void 0!==R.omsdkModule&&i.x6.adModule.OMSDKManager.getInstance().attachHandler(new R.omsdkModule.OMSDKHandler),void 0!==R.simidModule&&(t.#c=new R.simidModule.SimidControllerManagerHandler)};i.x6.prototype.defaultInit=i.x6.prototype.init,i.x6.prototype.init=function(e,t,i,a){s(),this.defaultInit(e,t,i,a)},i.x6.prototype.defaultInitAnalytics=i.x6.prototype.initAnalytics,i.x6.prototype.initAnalytics=function(e){s(),this.defaultInitAnalytics(e)},i.x6.prototype.defaultAttachPlayer=i.x6.prototype.attachPlayer,i.x6.prototype.attachPlayer=function(e,s){i.x6.analyticsModule?.PlayerManager.getInstance().init(t.#l);const a=t.#l?.attachPlayer(e,s);this.defaultAttachPlayer(a)},i.x6.prototype.defaultRelease=i.x6.prototype.release,i.x6.prototype.release=function(){this.defaultRelease(),void 0!==t.#u&&(t.#u.release(),t.#u=void 0),void 0!==t.#E&&(t.#E.release(),t.#E=void 0),void 0!==t.#g&&(t.#g.release(),t.#g=void 0),void 0!==t.#S&&(t.#S.release(),t.#S=void 0),void 0!==t.#p&&(t.#p.release(),t.#p=void 0)},i.fF.prototype.defaultAttachPlayer=i.fF.prototype.attachPlayer,i.fF.prototype.attachPlayer=function(e,s){i.x6.analyticsModule?.PlayerManager.getInstance().init(t.#l);const a=t.#l?.attachPlayer(e,s);this.defaultAttachPlayer(a)},i.fF.prototype.defaultAttachSimidController=i.fF.prototype.attachSimidController,i.fF.prototype.attachSimidController=function(e,s){R.simidModule?.SimidControllerManager.getInstance().init(t.#c);const i=t.#c?.attachSimidController(e,s);this.defaultAttachSimidController(i,s)},"object"==typeof e&&(e.SmartLib=Object.assign(i.x6.getInstance(),i.x6),e.SmartLib.getInstance=()=>i.x6.getInstance(),e.LoggerManager=i.gD,e.PlayerEventListener=R.analyticsModule?.PlayerEventListener,e.GenericPlayerApi=R.analyticsModule?.GenericPlayerApi,e.GenericSimidControllerApi=R.simidModule?.GenericSimidControllerApi,e.PlayerApiImp={getVersion:()=>{const e=i.x6.analyticsModule?.PlayerManager.getInstance().getPlayerAdapter();return void 0!==e&&"function"==typeof e.getVersion?e.getVersion():"undefined"},getErrorCode:e=>{const t=i.x6.analyticsModule?.PlayerManager.getInstance().getPlayerAdapter();return void 0!==t&&"function"==typeof t.getErrorCode?t.getErrorCode(e):i.x6.BPUnspecifiedError}},e.StreamingSession=i.fF,e.StreamingSessionOptions=i.H1,e.StreamingSessionResult=i.Sy,e.AdManager=i.X2,e.AdInteractionType=A)}log(e,t,s){this.#d.log(e,t,s)}}},8379:function(e,t,s){s.d(t,{$:function(){return n},g:function(){return o}});var i=s(3445);class a{static log(e,t,s){}}class n{static VERBOSE=0;static DEBUG=1;static INFO=2;static WARN=3;static ERROR=4}class r{static NONE=-1;static BASIC=0;static VERBOSE=1}class o{static instance;#d=a;#_;#A;#N;static getInstance(){return o.instance||(o.instance=new o),o.instance}constructor(){this.#_=[],this.#A=r.VERBOSE}init(e){this.#d=e}release(){this.#d=void 0}printLogs(e,t,s,a){if(this.#_.length>100&&(this.#_=[]),void 0!==a&&(s="["+a+"] "+s),this.#_.push(t+": "+s),void 0!==this.#N){let a=i.A.formatDate()+" ";switch(e){case n.VERBOSE:a+="V/";break;case n.DEBUG:a+="D/";break;case n.INFO:a+="I/";break;case n.WARN:a+="W/";break;case n.ERROR:a+="E/"}a+=t+": "+s,this.#N?.onLog(a)}else this.#d.log(e,t,s,a)}printVerboseLogs(e,t,s){this.#A<r.VERBOSE||this.printLogs(n.VERBOSE,e,t,s)}static v(e,t,s){o.getInstance().printVerboseLogs(e,t,s)}printDebugLogs(e,t,s){this.#A<r.VERBOSE||this.printLogs(n.DEBUG,e,t,s)}static d(e,t,s){o.getInstance().printDebugLogs(e,t,s)}printInfoLogs(e,t,s){this.#A<=r.NONE||this.printLogs(n.INFO,e,t,s)}static i(e,t,s){o.getInstance().printInfoLogs(e,t,s)}printWarnLogs(e,t,s){this.#A<=r.NONE||this.printLogs(n.WARN,e,t,s)}static w(e,t,s){o.getInstance().printWarnLogs(e,t,s)}printErrorLogs(e,t,s){this.#A<=r.NONE||this.printLogs(n.ERROR,e,t,s)}static e(e,t,s){o.getInstance().printErrorLogs(e,t,s)}getLogs(){return this.#_.join("\n")}resetLogs(){this.#_=[]}getLogLevel(e){return this.#A}setLogLevel(e){this.#A=e}setLogRedirectListener(e){this.#N=e}}},8724:function(e,t,s){s.d(t,{A:function(){return A}});var i=s(1142),a=s(8379),n=s(6506),r=s(7964),o=s(4943),d=s(5866),l=s(5305),c=s(5941),h=s(7832),u=s(3121);class E{static SESSION_ID="session_id";static IS_START="start";static STATUS_CODE="status_code";static STARTUP_TIME="startup_time";static REDIRECTION_TIME="redirection_time";static COMPLETION="completion";static PLAYED_TIME="played_time";static DURATION="duration";static PLAYBACK_TYPE="playback_type";static NUMBER_OF_STALLS="cnt_stall";static TOTAL_STALL_TIME="total_stall_time";static MAX_STALL_TIME="max_stall_time";static NUMBER_OF_REBUFFERING="cnt_rebuffering";static TOTAL_REBUFFERING_TIME="total_rebuffering_time";static MAX_REBUFFERING_TIME="max_rebuffering_time";static REDIRECT_URL="redirect_url";static CONTENT_URL="content_url";static MAX_BITRATE="max_bitrate";static MIN_BITRATE="min_bitrate";static AVERAGE_BITRATE="average_bitrate";static NUMBER_OF_LAYER_SWITCH="cnt_layer_switch";static TIME_SPENT_PER_LAYER="time_spent_per_layer";static PLAYER_NAME="player_name";static PLAYER_VERSION="player_version";static DEVICE_OS="device_os";static DEVICE_VERSION="device_version";static DEVICE_TYPE="device_type";static DIVERSITY="diversity";static UUID="uuid";static NANOCDN_STATUS="nano_status";static CUSTOM_PARAMETERS="custom_parameters";static TIMELINE="timeline";static SMARTLIB_VERSION="smartlib_version";static AD_METRICS="ad_metrics";static NETWORK_TYPE="network_type_list";static PLAYER_ERROR_CODE="player_error_code";static CDN_STATUS_CODE="cdn_status_code";static NANOCDN_STATUS_CODE="nanocdn_status_code";static BPKHTTPSERVER_TIMING="bpkhttpserver_timing";static GDPR="gdpr";static PRECACHED="precached";static PRECACHE_ENDED="precache_ended";static PRECACHE_DURATION="precache_duration";requestedURL;redirectedURL;sessionRunning;sessionCreated;sessionId;teardownActivated;smartLibParameters;customParameters;playerName;playerVersion;osName;osVersion;deviceType;smartLibVersion;networkTypeList;nanoCDNStatus;statusCode;cdnStatusCode;nanoCDNStatusCode;nanoCDNErrorCode;bpkhttpserverTiming;playerErrorCode;metrics;adMetrics;timeline;diversity;startSessionDate;endSessionDate;keepaliveRequestDate;teardownRequestDate;endSessionRequestDate;precached;precacheEnded;precacheDuration;constructor(){this.requestedURL="",this.redirectedURL="",this.sessionRunning=!1,this.sessionCreated=!1,this.sessionId="",this.teardownActivated=!1,this.smartLibParameters={},this.customParameters={},this.playerName="",this.playerVersion="",this.osName="",this.osVersion="",this.deviceType="",this.smartLibVersion=d.A,this.networkTypeList=[],this.nanoCDNStatus=A.NANOCDN_STATUS_UNAVAILABLE,this.statusCode=i.A.BPSessionEndsNormally,this.cdnStatusCode=-1,this.nanoCDNStatusCode=-1,this.nanoCDNErrorCode=u.S.RESULT_NO_ERROR,this.bpkhttpserverTiming=-1,this.playerErrorCode="",this.gdpr=h.H.GDPR_CLEAR,void 0!==i.A.analyticsModule&&(this.timeline=new i.A.analyticsModule.SessionTrackerTimeline),this.startSessionDate=0,this.endSessionDate=0,this.keepaliveRequestDate=0,this.teardownRequestDate=0,this.endSessionRequestDate=0,this.precached=!1,this.precacheEnded=!1,this.precacheDuration=0}toQuery(){const e=""===this.playerName?"Generic":this.playerName;let t,s=this.customParameters.pre_startup_time;if(this.gdpr===h.H.GDPR_DELETE)return"+++++++++++++++++++++++++++++++++++++++1";if(t=void 0===this.metrics?"-1+"+encodeURIComponent(e)+"+"+encodeURIComponent(this.playerVersion)+"+"+encodeURIComponent(this.osName)+"+"+encodeURIComponent(this.osVersion)+"+"+(""!==this.smartLibParameters.deviceType?encodeURIComponent(this.smartLibParameters.deviceType):encodeURIComponent(this.deviceType))+"+-1+-1+-1++-1+-1+-1+-1+-1+-1+-1+-1+-1+-1+-1++":this.metrics.redirectionTime+"+"+encodeURIComponent(e)+"+"+encodeURIComponent(this.playerVersion)+"+"+encodeURIComponent(this.osName)+"+"+encodeURIComponent(this.osVersion)+"+"+(""!==this.smartLibParameters.deviceType?encodeURIComponent(this.smartLibParameters.deviceType):encodeURIComponent(this.deviceType))+"+"+this.metrics.startupTime+"+"+this.metrics.completion+"+"+Math.round(this.metrics.playbackDuration/1e3)+"+"+this.metrics.playbackType+"+"+this.metrics.stallsNumber+"+"+this.metrics.maxStallDuration+"+"+this.metrics.totalStallsDuration+"+"+this.metrics.rebufferingsNumber+"+"+this.metrics.maxRebufferingDuration+"+"+this.metrics.totalRebufferingDuration+"+"+Math.round(this.metrics.maxBitrate)+"+"+Math.round(this.metrics.minBitrate)+"+"+Math.round(this.metrics.averageBitrate)+"+"+this.metrics.layerSwitchesNumber+"+"+Math.round(this.metrics.sessionDuration/1e3)+"+"+this.getTimeSpentPerLayerQuery()+"+",t+=encodeURIComponent(this.smartLibParameters.uuid)+"+"+this.nanoCDNStatus+"+"+(void 0!==s?encodeURIComponent(s):"")+"+"+encodeURIComponent(this.smartLibVersion)+"+",void 0!==i.A.adModule&&void 0!==this.adMetrics&&this.adMetrics.length>0){const e=i.A.adModule.AdMetrics.merge(this.adMetrics);t+=(e.adSkippable?1:0)+"+"+(e.adSkipped?1:0)+"+"+(e.adProgress>=0?e.adProgress/25:e.adProgress)+"+"+Math.round(e.adDuration/1e3)+"+"+e.stallsNumber+"+"+Math.round(e.stallsDuration/1e3)+"+"+e.layerSwitchesNumber+"+"+e.averageBitrate}else t+="+++++++";return t+="+"+this.getNetworkTypeListStr()+"+"+encodeURIComponent(this.playerErrorCode),t+="+"+(this.cdnStatusCode>=0?this.cdnStatusCode:"")+"+"+(this.nanoCDNStatusCode>=0?this.nanoCDNStatusCode:"")+"+"+this.bpkhttpserverTiming+"+"+this.gdpr,t}toEndSessionJSON(){let e={};if(e[E.IS_START]=!1,e[E.GDPR]=this.gdpr,this.gdpr===h.H.GDPR_DELETE)return e;if(e[E.SESSION_ID]=this.sessionId,e[E.STATUS_CODE]=this.statusCode,e[E.CONTENT_URL]=c.A.toBkAString(this.requestedURL),this.redirectedURL.includes(l.A.AD_NONCE_QUERY_PARAMETER)?e[E.REDIRECT_URL]=c.A.toBkAString(r.A.addOrReplaceParam(this.redirectedURL,l.A.AD_NONCE_QUERY_PARAMETER,"ignored")):e[E.REDIRECT_URL]=c.A.toBkAString(this.redirectedURL),void 0!==this.metrics?(e[E.REDIRECTION_TIME]=this.metrics.redirectionTime,e[E.STARTUP_TIME]=this.metrics.startupTime,e[E.COMPLETION]=this.metrics.completion,e[E.PLAYED_TIME]=Math.round(this.metrics.playbackDuration/1e3),e[E.DURATION]=Math.round(this.metrics.sessionDuration/1e3),e[E.PLAYBACK_TYPE]=this.metrics.playbackType,e[E.NUMBER_OF_STALLS]=this.metrics.stallsNumber,e[E.MAX_STALL_TIME]=this.metrics.maxStallDuration,e[E.TOTAL_STALL_TIME]=this.metrics.totalStallsDuration,e[E.NUMBER_OF_REBUFFERING]=this.metrics.rebufferingsNumber,e[E.MAX_REBUFFERING_TIME]=this.metrics.maxRebufferingDuration,e[E.TOTAL_REBUFFERING_TIME]=this.metrics.totalRebufferingDuration,e[E.MIN_BITRATE]=Math.round(this.metrics.minBitrate),e[E.MAX_BITRATE]=Math.round(this.metrics.maxBitrate),e[E.AVERAGE_BITRATE]=Math.round(this.metrics.averageBitrate),e[E.NUMBER_OF_LAYER_SWITCH]=this.metrics.layerSwitchesNumber,e[E.TIME_SPENT_PER_LAYER]=this.metrics.timeSpentPerLayer):(e[E.REDIRECTION_TIME]=-1,e[E.STARTUP_TIME]=-1,e[E.COMPLETION]=-1,e[E.PLAYED_TIME]=-1,e[E.DURATION]=-1,e[E.PLAYBACK_TYPE]="",e[E.NUMBER_OF_STALLS]=-1,e[E.MAX_STALL_TIME]=-1,e[E.TOTAL_STALL_TIME]=-1,e[E.NUMBER_OF_REBUFFERING]=-1,e[E.MAX_REBUFFERING_TIME]=-1,e[E.TOTAL_REBUFFERING_TIME]=-1,e[E.MIN_BITRATE]=-1,e[E.MAX_BITRATE]=-1,e[E.AVERAGE_BITRATE]=-1,e[E.NUMBER_OF_LAYER_SWITCH]=-1,e[E.TIME_SPENT_PER_LAYER]={}),e[E.PLAYER_NAME]=c.A.toBkAString(this.playerName),e[E.PLAYER_VERSION]=c.A.toBkAString(this.playerVersion),e[E.DEVICE_OS]=c.A.toBkAString(this.osName),e[E.DEVICE_VERSION]=c.A.toBkAString(this.osVersion),""!==this.smartLibParameters.deviceType?e[E.DEVICE_TYPE]=c.A.toBkAString(this.smartLibParameters.deviceType):e[E.DEVICE_TYPE]=c.A.toBkAString(this.deviceType),e[E.UUID]=c.A.toBkAString(this.smartLibParameters.uuid),e[E.NANOCDN_STATUS]=this.nanoCDNStatus,e[E.CUSTOM_PARAMETERS]=this.customParameters,void 0!==this.timeline?e[E.TIMELINE]=this.timeline.data().base64():e[E.TIMELINE]="",e[E.SMARTLIB_VERSION]=c.A.toBkAString(this.smartLibVersion),e[E.DIVERSITY]=this.diversity,e[E.PLAYER_ERROR_CODE]=c.A.toBkAString(this.playerErrorCode),e[E.AD_METRICS]=[],void 0!==this.adMetrics&&this.adMetrics.length>0)for(let t=0;t<this.adMetrics.length;t++){const s=this.adMetrics[t],i=this.cleanJson({ad_skippable:s.adSkippable?1:0,ad_skipped:s.adSkipped?1:0,ad_progress:s.adProgress>=0?s.adProgress/25:s.adProgress,ad_duration:Math.round(s.adDuration/1e3),stalls_number:s.stallsNumber,stalls_duration:Math.round(s.stallsDuration/1e3),layer_switches_number:s.layerSwitchesNumber,average_bitrate:s.averageBitrate,creative_id:s.creativeId,ad_id:s.adId.slice(0,s.adId.lastIndexOf("-")),ad_index:s.adIndex,ad_count:s.adCount,ad_format:s.adFormat,impression_date:s.impressionDate});e[E.AD_METRICS].push(i)}return e[E.NETWORK_TYPE]=this.getNetworkTypeListStr(),e[E.CDN_STATUS_CODE]=this.cdnStatusCode>=0?this.cdnStatusCode:"",e[E.NANOCDN_STATUS_CODE]=this.nanoCDNStatusCode>=0?this.nanoCDNStatusCode:"",e[E.BPKHTTPSERVER_TIMING]=this.bpkhttpserverTiming,e[E.PRECACHED]=this.precached,e[E.PRECACHE_ENDED]=this.precacheEnded,e[E.PRECACHE_DURATION]=this.precacheDuration,e}cleanJson(e){const t=["ad_progress","ad_index","ad_count"];for(const s in e){const i=e[s];-1===t.indexOf(s)&&(i<=0||""===i)&&delete e[s]}return e}getTimeSpentPerLayerQuery(){let e="";for(let t in this.metrics.timeSpentPerLayer)""!==e&&(e+=","),e+=t+":"+this.metrics.timeSpentPerLayer[t];return e}addNetworkType(e){this.networkTypeList.includes(e)||this.networkTypeList.push(e)}getNetworkTypeListStr(){return this.networkTypeList.length>0?this.networkTypeList.sort().join("-"):""}toString(){return JSON.stringify(this,((e,t)=>"timeline"===e&&void 0!==i.A.analyticsModule&&t instanceof i.A.analyticsModule.SessionTrackerTimeline?t.toString():void 0===t?"undefined":t),"  ")}}var g=s(7418),S=s(1262),p=s(1134);const _="BpkSessionHandler";class A{static NANOCDN_STATUS_UNAVAILABLE=1;static NANOCDN_STATUS_DETECTED_NOT_USED=2;static NANOCDN_STATUS_USED=3;smartLib;streamingSession;analyticsAddress;options;diversitySession;adSession;omSessionHandler;id;listeners;playerAdapterInitialized;playerAdapter;simidControllerAdapter;metricsManager;keepAliveManager;adMetricsManager;adTrackingManager;sessionResult;sessionReport;firstImageCalled;stopped;jobs;deviceInitDate;manifestInitDate;videoMulticastStatus;audioMulticastStatus;dataMulticastStatus;constructor(e,t=void 0){this.smartLib=e,this.streamingSession=t,this.diversitySession=void 0,this.adSession=void 0,this.listeners=[],this.playerAdapterInitialized=!1,this.sessionResult=void 0,this.sessionReport=new E,this.firstImageCalled=!1,this.stopped=!1,this.jobs=[],this.sessionReport.smartLibParameters=e.getParameters(),this.sessionReport.customParameters=this.getCustomParameters(),this.videoMulticastStatus=h.H.MULTICAST_INACTIVE,this.audioMulticastStatus=h.H.MULTICAST_INACTIVE,this.dataMulticastStatus=h.H.MULTICAST_INACTIVE,this.analyticsAddress=this.sessionReport.smartLibParameters.analyticsAddress,this.multicastStatusListener=void 0}initPlayerAdapter(){!1===this.playerAdapterInitialized&&(this.playerAdapterInitialized=!0,void 0!==this.playerAdapter?(a.g.i(_,"Player:name="+this.playerAdapter.getName()+", version="+this.playerAdapter.getVersion(),this.id),a.g.i(_,"Player:capabilities="+JSON.stringify(this.playerAdapter.getCapabilities()),this.id),this.playerAdapter.attachSession(this),this.playerAdapter.initSessionPlayerObjects()):a.g.i(_,"Player:no player attached",this.id))}initManagers(){void 0!==i.A.analyticsModule&&(this.metricsManager=new i.A.analyticsModule.MetricsManager(this,this.playerAdapter),this.addListener(this.sessionReport.timeline),S.CE.getInstance().addListener(this.sessionReport.timeline)),void 0!==i.A.adModule&&(this.adMetricsManager=new i.A.adModule.AdMetricsManager(this),this.adTrackingManager=new i.A.adModule.AdTrackingManager(this,this.playerAdapter),this.addListener(this.adMetricsManager),this.adTrackingManager.addListener(this.adMetricsManager),void 0!==this.simidControllerAdapter&&this.addListener(this.simidControllerAdapter)),void 0!==this.playerAdapter&&(this.addListener(this.metricsManager),this.addListener(this.playerAdapter)),void 0!==this.adSession&&this.adSession.isAdActivated()&&i.A.adModule?.OMSDKManager.getInstance().isEnabled()&&(this.omSessionHandler=new i.A.adModule.OMSessionHandler(this,this.playerAdapter),this.addListener(this.omSessionHandler),this.adTrackingManager?.addListener(this.omSessionHandler)),this.addListener(this),S.CE.getInstance().addListener(this),this.smartLib.monitoringManager?.startSession(this)}start(e,t=()=>{}){a.g.i(_,"Starting session...",this.id),this.sessionReport.startSessionDate=Date.now(),this.sessionReport.requestedURL=e,this.sessionReport.precached=this.isPrecached(),this.initPlayerAdapter(),this.initManagers(),this.notifyStart();const s=this.smartLib.getParameters(),i={analyticsAddress:this.analyticsAddress,nanoCDNDescr:this.smartLib.nanoCDNHostManager?.getCurrentNanoCDNDescr(),nanoCDNDescrConfigured:this.smartLib.nanoCDNHostManager?.getCurrentNanoCDNDescr(),broadpeakDomainNames:s.broadpeakDomainNames,forceTeardown:s.forceTeardown,userAgent:s.userAgent};n.A.isBroadpeakDomainName(e,i.broadpeakDomainNames)&&this.options.get(h.H.REQUEST_BROADPEAK_CDN);return void 0!==i.nanoCDNDescr&&(this.sessionReport.nanoCDNStatus=A.NANOCDN_STATUS_DETECTED_NOT_USED),this.sessionReport.gdpr=this.options.get(h.H.GDPR_PREFERENCE),n.A.getInstance().getURL(e,i,this).then((e=>(this.sessionResult=e,e.isError()&&(this.sessionReport.statusCode=e.getErrorCode()),this.sessionReport.redirectedURL=this.patchBkmResult(e.getURL()),this.handleRedirectedURL(i),e.url=this.sessionReport.redirectedURL,this.stopped?(a.g.d(_,"The session has been stopped while creating it.",this.id),this.stop(),e=S.Sy.error(S.Sy.RESULT_SESSION_HAS_BEEN_STOPPED_DURING_REQUEST),a.g.i(_,"Session error code: "+e.getErrorMessage()+" (code "+e.getErrorCode()+", detail "+e.getDetailedErrorMessage()+")",this.id),a.g.i(_,"Session redirected URL: ",this.id),t(""),e):(a.g.i(_,"Session status: "+e.getErrorMessage()+" (code "+e.getErrorCode()+", detail "+e.getDetailedErrorMessage()+")",this.id),this.sessionReport.redirectedURL.length>0&&a.g.i(_,"Session redirected URL: "+this.sessionReport.redirectedURL,this.id),t(this.sessionReport.redirectedURL),e))))}handleRedirectedURL(e){this.isNanoCDNUsed()&&(this.sessionReport.nanoCDNStatus=A.NANOCDN_STATUS_USED,this.notifyUnicastUsed());const t=this.sessionResult.nanoCDNDescr||this.smartLib.nanoCDNHostManager?.getCurrentNanoCDNDescr(),s=t?.bka100;if(void 0!==s&&(a.g.i(_,"nanoCDN is overwriting the analytics address to "+s,this.id),this.analyticsAddress=s),0!==this.sessionReport.redirectedURL.length){if(!0===this.diversitySession?.activated&&this.diversitySession?.manifest){const e=this.playerAdapter.initDiversitySession(this.diversitySession.options);this.addListener(e),this.playerAdapter.setDiversityManifest(this.diversitySession.manifest)}this.sessionReport.sessionRunning=!0}this.sessionReport.sessionCreated=!0,this.sessionReport.sessionRunning&&(this.sessionReport.teardownActivated=this.isTeardownActivated(e)),this.sessionReport.redirectedURL=this.removeBroadpeakParameters(this.sessionReport.redirectedURL),this.sessionReport.sessionId=this.getTicket(),this.sessionReport.teardownActivated||this.sessionReport.timeline?.encoder.extend(),this.notifyRedirectionEnd(),this.isPrecached()&&this.startKeepalive(),void 0===this.playerAdapter&&this.sessionReport.sessionRunning&&this.notifyFirstImage(0,0),i.A.analyticsModule?.CacheManager.getInstance().clean()}stop(e){if(this.updatePrecacheDuration(),S.CE.getInstance().removeListener(this.sessionReport.timeline),S.CE.getInstance().removeListener(this),void 0===e||isNaN(e)||(this.sessionReport.statusCode=e),this.sessionReport.endSessionDate=Date.now(),this.notifyStop(this.sessionReport.statusCode),void 0!==this.keepAliveManager&&this.keepAliveManager.stop(),this.smartLib.monitoringManager?.stopSession(this),this.sessionReport.sessionCreated){a.g.d(_,"Session ends with status code: "+this.sessionReport.statusCode,this.id);const e=this.smartLib.getParameters();this.sessionReport.sessionRunning=!1,this.sessionReport.sessionCreated=!1,this.sessionReport.smartLibParameters=JSON.parse(JSON.stringify(this.sessionReport.smartLibParameters)),this.sessionReport.customParameters=JSON.parse(JSON.stringify(this.getCustomParameters())),this.notifyEndSessionReportUpdateRequested(this.sessionReport),a.g.d(_,"SessionReport: "+this.sessionReport.toString(),this.id),this.resetCustomParameters();const t={analyticsAddress:this.analyticsAddress,userAgent:e.userAgent},s=this.options.get(h.H.SESSION_TEARDOWN),r=this.options.get(h.H.SESSION_REPORTING_MODE),o=void 0===this.keepAliveManager||"POST"===this.keepAliveManager?.method?"POST":"GET";a.g.d(_,"Keepalive manager method set to "+o,this.id),s===h.H.SESSION_ENABLED?(this.sessionReport.teardownRequestDate=Date.now(),n.A.getInstance().teardown(this,t,o),r===h.H.SESSION_REPORTING_MODE_METRICS_RECEIVER&&(this.sessionReport.endSessionRequestDate=Date.now(),i.A.analyticsModule?.AnalyticsRequestManager.getInstance().endSession(this,t))):s===h.H.SESSION_ENABLED_IF_BROADPEAK_DOMAIN?this.sessionReport.teardownActivated?(this.sessionReport.teardownRequestDate=Date.now(),n.A.getInstance().teardown(this,t,o),r===h.H.SESSION_REPORTING_MODE_METRICS_RECEIVER&&(this.sessionReport.endSessionRequestDate=Date.now(),i.A.analyticsModule?.AnalyticsRequestManager.getInstance().endSession(this,t))):r!==h.H.SESSION_REPORTING_MODE_DEFAULT&&r!==h.H.SESSION_REPORTING_MODE_METRICS_RECEIVER||(this.sessionReport.endSessionRequestDate=Date.now(),i.A.analyticsModule?.AnalyticsRequestManager.getInstance().endSession(this,t)):s===h.H.SESSION_DISABLED&&(r!==h.H.SESSION_REPORTING_MODE_DEFAULT&&r!==h.H.SESSION_REPORTING_MODE_METRICS_RECEIVER||(this.sessionReport.endSessionRequestDate=Date.now(),i.A.analyticsModule?.AnalyticsRequestManager.getInstance().endSession(this,t)))}void 0!==this.playerAdapter&&(!0===this.diversitySession?.activated&&this.playerAdapter.releaseDiversitySession(),this.playerAdapter.releaseSessionPlayerObjects(),this.playerAdapter.detachSession());let t=0;for(let e=0;e<this.jobs.length;e++)!0===this.jobs[e].active&&t++,p.A.getInstance().interrupt(this.jobs[e]);a.g.d(_,t+" active job(s)",this.id),this.jobs=[],this.listeners=[],this.stopped=!0}onFirstImage(e,t){void 0===this.keepAliveManager&&this.startKeepalive()}startKeepalive(){this.notifyStartSessionReportUpdateRequested(this.sessionReport);const e=this.options.get(h.H.SESSION_KEEPALIVE),t=void 0!==i.A.analyticsModule&&this.options.get(h.H.SESSION_REPORTING_MODE)===h.H.SESSION_REPORTING_MODE_METRICS_RECEIVER,s=0===this.smartLib.getParameters().analyticsAddress.length;e===h.H.SESSION_ENABLED?(a.g.i(_,"Keepalive is enabled (SESSION_KEEPALIVE=SESSION_ENABLED)",this.id),this.keepAliveManager=t&&!s?new i.A.analyticsModule.BroadpeakCDNCacheKeepaliveManager(this):new g.q(this)):e===h.H.SESSION_ENABLED_IF_BROADPEAK_DOMAIN?this.sessionReport.teardownActivated?this.keepAliveManager=t&&!s?new i.A.analyticsModule.BroadpeakCDNCacheKeepaliveManager(this):new g.q(this):void 0===i.A.analyticsModule||s||(this.keepAliveManager=new i.A.analyticsModule.CacheKeepaliveManager(this)):e===h.H.SESSION_DISABLED&&(this.sessionReport.teardownActivated&&a.g.i(_,"Keepalive is disabled (SESSION_KEEPALIVE=SESSION_DISABLED)",this.id),void 0===i.A.analyticsModule||s||(this.keepAliveManager=new i.A.analyticsModule.CacheKeepaliveManager(this))),this.keepAliveManager?.start(),void 0!==i.A.monitoringModule&&!0===this.isNanoCDNUsed()&&this.keepAliveManager?.process(!1)}getMulticastStatus(e,t){if(void 0!==e&&"number"==typeof e.status){const s=e.status,i=e.daiperiod||0;if(1===s)return a.g.d(_,"Multicast status: active",this.id),h.H.MULTICAST_ACTIVE;if(0!==i||1!==s)return t!==h.H.MULTICAST_INACTIVE?(a.g.d(_,"Multicast status: inactive was active"+(i>=1?" (playing DAI period)":""),this.id),h.H.MULTICAST_INACTIVE_WAS_ACTIVE):(a.g.d(_,"Multicast status: inactive",this.id),h.H.MULTICAST_INACTIVE)}return a.g.d(_,"Multicast status: unknown (segment:"+JSON.stringify(e)+")",this.id),h.H.MULTICAST_UNKNOWN}onKeepaliveRequestEnded(e,t){if(this.isNanoCDNUsed()){if("object"!=typeof t)return a.g.d(_,"Data is not an object: (data:"+JSON.stringify(t)+")",this.id),this.videoMulticastStatus=h.H.MULTICAST_UNKNOWN,this.audioMulticastStatus=h.H.MULTICAST_UNKNOWN,void(this.dataMulticastStatus=h.H.MULTICAST_UNKNOWN);a.g.d(_,"nanoCDN data: "+JSON.stringify(t)+")",this.id);let e=this.videoMulticastStatus,s=this.audioMulticastStatus,i=this.dataMulticastStatus;a.g.d(_,"Getting multicast status for video",this.id),this.videoMulticastStatus=this.getMulticastStatus(t.last_video_segment,e),a.g.d(_,"Getting multicast status for audio",this.id),this.audioMulticastStatus=this.getMulticastStatus(t.last_audio_segment,s),a.g.d(_,"Getting multicast status for data",this.id),this.dataMulticastStatus=this.getMulticastStatus(t.last_data_segment,i),e!==this.videoMulticastStatus&&(this.streamingSession.multicastStatusListener?.onVideoMulticastStatusChange(this.videoMulticastStatus),this.videoMulticastStatus===h.H.MULTICAST_ACTIVE?this.notifyMulticastUsed():this.notifyUnicastUsed()),s!==this.audioMulticastStatus&&this.streamingSession.multicastStatusListener?.onAudioMulticastStatusChange(this.audioMulticastStatus),i!==this.dataMulticastStatus&&this.streamingSession.multicastStatusListener?.onDataMulticastStatusChange(this.dataMulticastStatus)}}isNanoCDNUsed(){let e=!1;if(void 0===i.A.nanoCDNModule)return!1;if("string"==typeof this.sessionReport.redirectedURL&&0!==this.sessionReport.redirectedURL.length){const t=this.smartLib.nanoCDNHostManager?.getNanoCDNDescrList();t?.forEach((t=>{this.sessionReport.redirectedURL.indexOf(t.hostIP)>0&&(e=!0)}))}return e}patchBkmResult(e){const t=r.A.parseURL(e);if(null!==t){let s=e,i=t.query.split("&");return i.length>=2&&-1===i[0].indexOf("bk-teardown=")&&(s=s.replace("?bk-teardown=","&bk-teardown=")),-1!==s.indexOf("//bpk-token")&&(s=s.replace("//bpk-token","/bpk-token")),s}return e}getTicket(){let e,t="";if(void 0!==this.adTrackingManager&&!0===this.adTrackingManager.bkYouSession&&void 0!==this.adTrackingManager.sessionToken&&this.adTrackingManager.sessionToken.length>0&&(t=this.adTrackingManager.sessionToken),""===t&&(t=r.A.getParam(this.sessionReport.redirectedURL,n.A.QUERY_PARAMETER_SESSION_ID)),""===t&&(t=r.A.getParam(this.sessionReport.redirectedURL,"bpkio_sessionid")),""===t&&(e=this.sessionReport.redirectedURL.split("/"),e.length>=4&&(e[3].match("\\[(.*)\\]")?t=e[3].substring(1,e[3].length-1):e[3].match("\\%5B(.*)\\%5D")&&(t=e[3].substring(3,e[3].length-3)))),""===t){const s=this.sessionReport.redirectedURL.split("//");e=s[s.length-1].split("/"),e.length>=3&&(e[0].match(r.A.REGEX_IP)||e[0].match(r.A.REGEX_HOSTNAME))&&"bpk-token"===e[1]&&(e[2].match(r.A.REGEX_TICKET)||e[2].match(r.A.REGEX_TICKET_TRANSCODED))&&(t=e[2],a.g.v(_,"Ticket detected: "+t,this.id))}if(""===t){const s=this.sessionReport.redirectedURL.split("//");e=s[s.length-1].split("/"),e.length>=2&&(e[0].match(r.A.REGEX_IP)||e[0].match(r.A.REGEX_HOSTNAME))&&(e[1].match(r.A.REGEX_TICKET)||e[1].match(r.A.REGEX_TICKET_TRANSCODED))&&(t=e[1],a.g.v(_,"Ticket detected: "+t,this.id))}return""===t&&(t=this.generateTicket()),""===t&&(a.g.w(_,"Failed getting ticket",this.id),a.g.w(_,"SmartLib won't be able to post metrics",this.id)),t}generateTicket(){const e=Date.now(),t=o.A.randomIntFromInterval(1e6,9999999),s=o.A.randomIntFromInterval(1e6,9999999),i=o.A.stringToBase64(t+""+e+s);return null===i?(a.g.w(_,"Cannot encode base 64 ticket",this.id),""):(a.g.v(_,"Ticket generated: "+i,this.id),i)}getTeardown(){let e=r.A.getParam(this.sessionReport.redirectedURL,"bk-teardown");return e.startsWith("T")||e.startsWith("t")||e.startsWith("1")}isTeardownActivated(e){return e.forceTeardown===i.A.FORCE_TEARDOWN_ENABLED?(a.g.i(_,"Session will start with keepalives/teardown (forceTeardown)",this.id),!0):e.forceTeardown===i.A.FORCE_TEARDOWN_DISABLED?(a.g.i(_,"Session will start without keepalives/teardown (forceTeardown)",this.id),!1):null!==this.sessionReport.redirectedURL&&"0"===r.A.getParam(this.sessionReport.redirectedURL,"bk-teardown")?(a.g.i(_,"Session will start without keepalives/teardown (bk-teardown=0)",this.id),!1):null!==this.sessionReport.redirectedURL&&this.getTeardown()?(a.g.i(_,"Session will start with keepalives/teardown (bk-teardown=1)",this.id),!0):this.sessionReport.nanoCDNStatus===A.NANOCDN_STATUS_USED?(a.g.i(_,"Session will start with keepalives/teardown (nanoCDN used)",this.id),!0):!1===this.options.get(h.H.REQUEST_BROADPEAK_CDN)?(a.g.i(_,"Session will start without keepalives/teardown (REQUEST_BROADPEAK_CDN=false)",this.id),!1):null!==this.sessionReport.requestedURL&&n.A.isBroadpeakDomainName(this.sessionReport.requestedURL,e.broadpeakDomainNames)?(a.g.i(_,"Session will start with keepalives/teardown (in broadpeak domains list)",this.id),!0):(a.g.i(_,"Session will start without keepalives/teardown",this.id),!1)}removeBroadpeakParameters(e){const t=r.A.parseURL(e);if(null!==t){let s="";const i=t.query.split("&");let n=1;for(let e=0;e<i.length;e++){const t=i[e];t.startsWith("bk-")?a.g.d(_,"Remove query parameter '"+t+"' from url",this.id):(n||(s+="&"),s+=t,n=0)}return""===s?e.replace("?"+t.query,""):e.replace(t.query,s)}return e}isSessionCreated(e){if(null===e)return!1;let t=r.A.getParam(e,n.A.QUERY_PARAMETER_SESSION_ID);return 0!==t.length||(t=r.A.getParam(e,n.A.QUERY_PARAMETER_SESSION_CREATED),t.startsWith("T")||t.startsWith("t")||t.startsWith("1"))}isPrecached(){return!0===this.options.get(h.H.SESSION_PRECACHE)}updatePrecacheDuration(){this.isPrecached()&&0===this.sessionReport.precacheDuration&&(this.sessionReport.precacheDuration=Date.now()-this.sessionReport.startSessionDate)}getCustomParameters(){return void 0!==this.streamingSession?this.streamingSession.customParameters:this.smartLib.getParameters().customParameters}resetCustomParameters(){void 0!==this.streamingSession||this.smartLib.resetCustomParameters()}addListener(e){void 0===e||this.listeners.includes(e)||this.listeners.push(e)}removeListener(e){let t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}notifyEvent(e,t,s,i){"function"==typeof e[t]&&e[t](s,i)}notifyLoading(){this.listeners.forEach((e=>{this.notifyEvent(e,"onLoading")}))}notifyStart(){let e,t;e=S.CE.getInstance().networkType,this.sessionReport.addNetworkType(e),t=S.CE.getInstance().mute,this.listeners.forEach((s=>{this.notifyEvent(s,"onStart",e,t)}))}notifyRedirectionEnd(){this.listeners.forEach((e=>{this.notifyEvent(e,"onRedirectionEnd")}))}notifyPrecacheEnded(){this.isPrecached()&&!0!==this.sessionReport.precacheEnded&&(a.g.d(_,"Precache ended",this.id),this.sessionReport.precacheEnded=!0,this.updatePrecacheDuration(),this.listeners.forEach((e=>{this.notifyEvent(e,"onPrecacheEnded")})))}notifyFirstImage(e,t){this.firstImageCalled?a.g.e(_,"Implementation error: PlayerEventListener.onSessionStart() already called. If you don't attach any player, please remove this call, SmartLib is now handling it automatically.",this.id):(this.firstImageCalled=!0,void 0!==this.adSession&&this.adSession.isAdActivated()?void 0!==this.playerAdapter?!0===this.playerAdapter.getCapabilities().adTracking?this.addListener(this.adTrackingManager):a.g.d(_,"Ad tracking disabled (player not compatible)",this.id):a.g.d(_,"Ad tracking disabled (no player attached)",this.id):a.g.d(_,"Ad tracking disabled (advertising not activated)",this.id),this.listeners.forEach((s=>{this.notifyEvent(s,"onFirstImage",e,t)})))}notifyLayerSwitch(e){this.listeners.forEach((t=>{this.notifyEvent(t,"onLayerSwitch",e)}))}notifyPause(){this.listeners.forEach((e=>{this.notifyEvent(e,"onPause")}))}notifyResume(){this.listeners.forEach((e=>{this.notifyEvent(e,"onResume")}))}notifyBufferingStart(){this.listeners.forEach((e=>{this.notifyEvent(e,"onBufferingStart")}))}notifyBufferingEnd(e){this.listeners.forEach((t=>{this.notifyEvent(t,"onBufferingEnd",e)}))}notifyStallEnd(){this.listeners.forEach((e=>{this.notifyEvent(e,"onStallEnd")}))}notifyRebufferingEnd(){this.listeners.forEach((e=>{this.notifyEvent(e,"onRebufferingEnd")}))}notifySeek(e,t){this.listeners.forEach((s=>{this.notifyEvent(s,"onSeek",e,t)}))}notifyStop(e){this.adSession?.adPalSession?.setAdView(void 0),this.listeners.forEach((t=>{this.notifyEvent(t,"onStop",e)}))}notifyClose(e=void 0){this.listeners.forEach((t=>{this.notifyEvent(t,"onClose",e)}))}notifyStartSessionReportUpdateRequested(e){this.listeners.forEach((t=>{this.notifyEvent(t,"onStartSessionReportUpdateRequested",e)}))}notifyKeepaliveSessionReportRequested(e){this.listeners.forEach((t=>{this.notifyEvent(t,"onKeepaliveSessionReportUpdateRequested",e)}))}notifyKeepaliveRequestEnded(e,t){this.listeners.forEach((s=>{this.notifyEvent(s,"onKeepaliveRequestEnded",e,t)}))}notifyEndSessionReportUpdateRequested(e){this.listeners.forEach((t=>{this.notifyEvent(t,"onEndSessionReportUpdateRequested",e)}))}notifyVolumeChanged(e){this.listeners.forEach((t=>{this.notifyEvent(t,"onVolumeChanged",e)}))}notifyPlayerError(e,t){this.listeners.forEach((s=>{this.notifyEvent(s,"onPlayerError",e,t)}))}notifyMulticastUsed(){this.listeners.forEach((e=>{this.notifyEvent(e,"onMulticastUsed")}))}notifyUnicastUsed(){this.listeners.forEach((e=>{this.notifyEvent(e,"onUnicastUsed")}))}notifySimidClickthrough(e){a.g.d(_,"NOTIFY SIMID CLICKTHROUGH IN SESSION HANDLER"),this.listeners.forEach((t=>{this.notifyEvent(t,"onSimidClickthrough",e)}))}notifySimidImpression(){a.g.d(_,"NOTIFY SIMID IMPRESSION IN SESSION HANDLER"),this.listeners.forEach((e=>{this.notifyEvent(e,"onSimidImpression")}))}onNetworkAvailable(e){a.g.v(_,"Received event onNetworkAvailable type:"+e,this.id),this.sessionReport.addNetworkType(e)}}}},__webpack_module_cache__={},deferred;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](s,s.exports,__webpack_require__),s.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=function(e,t,s,i){if(!t){var a=1/0;for(d=0;d<deferred.length;d++){t=deferred[d][0],s=deferred[d][1],i=deferred[d][2];for(var n=!0,r=0;r<t.length;r++)(!1&i||a>=i)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](t[r])}))?t.splice(r--,1):(n=!1,i<a&&(a=i));if(n){deferred.splice(d--,1);var o=s();void 0!==o&&(e=o)}}return e}i=i||0;for(var d=deferred.length;d>0&&deferred[d-1][2]>i;d--)deferred[d]=deferred[d-1];deferred[d]=[t,s,i]},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={152:0};__webpack_require__.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,a,n=s[0],r=s[1],o=s[2],d=0;if(n.some((function(t){return 0!==e[t]}))){for(i in r)__webpack_require__.o(r,i)&&(__webpack_require__.m[i]=r[i]);if(o)var l=o(__webpack_require__)}for(t&&t(s);d<n.length;d++)a=n[d],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(l)},s=("undefined"!=typeof self?self:global).webpackChunkSmartLibModule=("undefined"!=typeof self?self:global).webpackChunkSmartLibModule||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var __webpack_exports__={};__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AdInteractionType:function(){return core__WEBPACK_IMPORTED_MODULE_0__.AdInteractionType},AdManager:function(){return core__WEBPACK_IMPORTED_MODULE_0__.X2},LoggerManager:function(){return core__WEBPACK_IMPORTED_MODULE_0__.gD},RequestManager:function(){return core__WEBPACK_IMPORTED_MODULE_0__.Je},SmartLib:function(){return core__WEBPACK_IMPORTED_MODULE_0__.x6},StreamingSession:function(){return core__WEBPACK_IMPORTED_MODULE_0__.fF},StreamingSessionOptions:function(){return core__WEBPACK_IMPORTED_MODULE_0__.H1},StreamingSessionResult:function(){return core__WEBPACK_IMPORTED_MODULE_0__.Sy}});var core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1262),_engine_CoreEngine__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8100);return _engine_CoreEngine__WEBPACK_IMPORTED_MODULE_1__.A.getInstance().init(),__webpack_exports__=__webpack_require__.O(__webpack_exports__),__webpack_exports__}()}));